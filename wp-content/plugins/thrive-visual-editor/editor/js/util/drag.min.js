/*! Thrive Content Builder - 2017-02-15
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};!function(a){function b(a,b,d,e){var f={x:a.left-b.left,y:a.top-b.top+c.scrollTop()},g=d/e,h=.33*d,i=f.x>f.y*g,j=f.y*g+f.x<d;return n.limit_vertical?f.y<e/2?"top":"bottom":f.x>=h&&f.x<2*h?f.y<e/2?"top":"bottom":i&&j?"top":i&&!j?"right":!i&&j?"left":"bottom"}var c,d,e=".thrv_wrapper, p:not(.thrv_custom_html_shortcode p, .wp-caption p), ul:not(ul.tve_clearfix), ol, h1, h2, h3, h4, h5, h6, address, pre, blockquote,.tve_draggable,.tcb-flex-row",f=".tve_no_drag, .thrive_leads_shortcode *, .thrive_ultimatum_shortcode *, .tve_faqB *, .tve_wp_shortcode *, .thrv_bullets_shortcode ul, .thrv_tw_qs *, .thrv_post_grid *, .thrv_custom_html_shortcode *, .thrv_widget *, .thrv_widget_menu *, .tve_w_menu, .tve_w_menu *, .tve_lg_input_container *, .thrive-shortcode-html *",g=".tve_colm, .tve_colm .tve_grt, .tve_cb .tve_cb_cnt, .tve_faqC, td, th, .fwi, .tve_content_inner, .thrv_content_reveal, .tve_scTC, .cck, .tve_empty_dropzone, .tve-col, #tve_editor",h=".thrv_page_section",i=null,j=null,k="tve_grabbed",l=null,m=!1,n={},o=4,p=a(),q=a(),r=function(a){return a.is(f)?!1:a.is(e)},s=function(a){return a.is(f)},t=function(a){return a.length?"tve-drop-handle"===a[0].id?!0:r(a):!1},u=function(a){return"tve-drop-handle"===a[0].id?!1:t(a)},v=function(a){return a.is(g)},w=function(a,b){return a&&a.className&&a.className.indexOf?-1!==a.className.indexOf(b):!1},x=null,y={init:function(){c=a(document),d=a(document.body),q=jQuery("#tve_static_elements"),e=TVE_Content_Builder.apply_filters("sortable_elements",e),j=this.page_scroll("tcb_lightbox"===tve_path_params.post_type?"#tve-p-scroller":"body"),TCB_Main.on("insertelement",function(a){TVE_Editor_Page.enable(),y.fetch(a,y.get_available_target()),d.removeClass("tve-empty-placeholder")}).on("dragstart",function(a){y.main_drag_start(a)}).on("main-drag-end",function(){y.dragend(!0)}),TCB_Main.on("keydown",this.keydown).on("keyup",this.keyup),c.on("keydown",this.keydown).on("keyup",this.keyup)},keydown:function(a){!m&&a.ctrlKey&&(m=!0)},keyup:function(a){m=!1},body_class:function(){requestAnimationFrame(function(){d.addClass("tve-dragging")})},editorActions:function(){n.page_init(),TVE_Editor_Page.editor.find(e).not(f).addClass("tve_draggable").attr("draggable","true"),TVE_Editor_Page.editor.parent().off().on("dragstart",e,this.dragstart).on("dragend",e,this.dragend).add(n.$el).on("dragenter",this.dragenter).on("dragleave",this.dragleave).on("dragover",this.dragover).on("drop",this.drop),this.refresh()},get_available_target:function(){var b=a(".edit_mode");return n.data("dir","bottom"),0===b.length&&(b=TVE_Editor_Page.editor.find(".tve_editor_main_content").first(),b.length||(b=TVE_Editor_Page.editor),n.data("dir","mid")),n.data("tt",b),b},dragstart:function(b){return TVE_Editor_Page.CPANEL_OPEN||"disabled"==TVE_Editor_Page.STATE?!1:(i=a(this),s(i)?(i=null,!1):(i.addClass("tve-dragged").removeClass("active_delete active_duplicate"),TVE_Content_Builder.loaded_menu&&y.hide_control_panel(),y.body_class(),b.stopPropagation(),b.originalEvent.dataTransfer.setData("text/plain",null),void(i.is(h)&&(n.force_limit_vertical=!0))))},main_drag_start:function(a){y.body_class();var b=this.static_element(a.type);b.length&&b.children().first().is(h)&&(n.force_limit_vertical=!0)},dragend:function(b){d.removeClass("tve-dragging"),a(".tve-dragged").removeClass("tve-dragged"),a(".tve_dragged_over").removeClass("tve_dragged_over"),i=null,x=null,n.reset(),j.hide(),y.show_control_panel(),"undefined"!=typeof b&&b===!0&&TCB_Main.trigger("child-drag-end")},dragenter:function(b){if(i||TCB_Main.dragged_elem){if(n.limit_vertical=n.force_limit_vertical,n.data("append",!1),"tve-drop-handle"===b.target.id)return y.cancel_dragleave=!0,!1;if(x=a(b.target),w(b.target,"tcb-flex-col")&&0!==x.children(e).length&&(x=x.parent(),n.limit_vertical=!0),i&&a.contains(i[0],x[0]))return void(x=null);if(!t(x)){if(v(x)&&0===x.children(e).length)return n.position_mid(x),b.preventDefault(),p.removeClass("tve_dragged_over"),x.addClass("tve_dragged_over"),!1;x.children(e).length<2&&(x=x.parents(e).not(f).first())}return t(x)?(n.last_dir=null,b.preventDefault(),p.removeClass("tve_dragged_over"),p=x,x.addClass("tve_dragged_over"),x.is(h)&&(n.limit_vertical=!0),!1):void(x=null)}},dragover:function(b){return b.preventDefault(),!x||!u(x)||i&&a.contains(i[0],x[0])?void 0:(n.position(x,b),x.addClass("tve_dragged_over"),!1)},dragleave:function(b){if(y.cancel_dragleave)return delete y.cancel_dragleave,!1;var c=a(b.target);return"mid"!==n.data("dir")&&c.removeClass("tve_dragged_over"),n.is(":visible")&&c.removeClass("tve_dragged_over"),n.last_dir=null,!1},drop:function(b){if(b.preventDefault(),!TCB_Main.dragged_elem&&!i)return!1;if(i){var c=TVE_Content_Builder.apply_filters("allow_drop",!0,[i,n]);if(!c)return!1}return i&&a.contains(i[0],n.data("tt")[0])?void 0:(d.removeClass("tve-dragging tve-empty-placeholder"),i&&i.removeClass("tve-dragged"),n.hide(),j.hide(),TCB_Main.dragged_elem?y.fetch(TCB_Main.dragged_elem,n.data("tt")):y.insert(i,n.data("tt")),i=null,y.dragend(),!1)},bind_draggable:function(a){a.add(a.find(e)).not(f).addClass("tve_draggable").attr("draggable","true")},refresh:function(){TVE_Editor_Page.editor.find(e).not(f).each(function(){a(this.parentNode).addClass("tve_empty_dropzone")}),z.bind()},fetch:function(b,c){var d=b.post_data,e=b.data||{},f=e.wpapi?tve_path_params.ajax_url:tve_path_params.shortcodes_dir+b.type+".php";return this.before_fetch(b,c)===!1?!1:this.check_for_static_elements(b.type,c)?!0:-1===a.inArray(b.type+".php",tve_path_params.shortcodes_array)?!1:(e.overlay&&TVE_Editor_Page.overlay(),d.push({name:"colour",value:window.last_colour_used}),d.push({name:"cssdir",value:tve_path_params.editor_dir}),e.wpapi&&(d.push({name:"action",value:"tve_ajax_load"}),d.push({name:"ajax_load",value:b.type})),a.post(f,a.param(d),function(a){y.insert(a,c,!1,!1,!0),TVE_Editor_Page.overlay("close")}),!1)},static_element:function(a){return q.find("[data-elem='"+a+"']")},check_for_static_elements:function(a,b){var c=this.static_element(a);if(c.length<=0)return!1;var d=c.first().clone();return d.find(".tve_red").removeClass("tve_red").addClass(window.last_colour_used),d.find(".tve_countdown_timer_evergreen").attr("data-id","evergreen_"+Math.floor(1e4*Math.random())),y.insert(d.html(),b,!1,!1,!0),!0},before_fetch:function(a,b){return a.data&&a.data.usertpl?(this.load_template(a.data.key,b),!1):!0},after_fetch:function(a){a.hasClass("thrv_content_container_shortcode")?a.parent().addClass("tve_clearfix"):a.hasClass("thrv_countdown_timer")?a.hasClass("tve_countdown_timer_evergreen")?a.tve_countdown_timer_evergreen().update():a.tve_countdown_timer().update():a.find(".tve_vtabs").length?a.tve_tabs().resize():a.hasClass("thrv_lead_generation")?a.tve_lead_generation().applyStyle("thrv_lead_generation_vertical"):a.hasClass("thrv_social_default")&&TVE_Content_Builder.social.onDefaultInsert(a),TVE_Content_Builder.apply_filters("element_drop",a)},insert:function(b,c,d,e,f){d="undefined"==typeof d?!1:d,e="undefined"==typeof e?!1:e,tve_set_window_content_before_action();var g=a(b);return d?(c.html(g),g.hasClass("tve_table")&&(g=g.parent())):e?c.replaceWith(g):this.insert_near(g,c,n.data("dir")),this.bind_draggable(g),"undefined"!=typeof f&&f&&y.after_fetch(g),y.after_drop(g),setTimeout(function(){tve_set_window_content_after_action(),y.refresh()},200),g},after_drop:function(a){var b=a[0];return w(b,"thrv_social_default")?void TVE_Content_Builder.social.onDefaultDrop(a):void 0},insert_near:function(a,b,c){var d,e=a[0]===b[0];switch(i&&(d=a.parent()),c){case"mid":if(e)return;b.append(a);break;case"top":if(e)return;b.before(a);break;case"bottom":if(e)return;b.after(a);break;case"right":case"left":var f,g,h,j=a.parent();if(e&&1===j.children().length)return;if(w(b[0],"tcb-flex-row"))h=b.children(".tcb-flex-col")["right"===c?"last":"first"](),g="right"===c?"after":"before";else if(w(b[0].parentNode,"tcb-flex-col"))h=b.parent(),g="right"===c?"after":"before";else{if(e)return;b.wrap('<div class="thrv_wrapper tcb-flex-row tve_draggable" draggable="true"></div>'),b.wrap('<div class="tcb-flex-col"></div>'),g="right"===c?"append":"prepend",h=b.closest(".tcb-flex-row")}a.wrap('<div class="tcb-flex-col"></div>'),f=b.closest(".tcb-flex-row"),h[g](a.parent()),f.hasClass("tcb-resized")?(f.removeClass("tcb-resized"),f.children().head_css({"max-width":""},"_ALL")):-1!==f[0].className.search("tve-flex-wrap-[d|t|m](?!-)")&&a.parent().head_css_copy(h),f.children().removeClass("c-25 c-33 c-50 c-66 c-75")}a.addClass("tve-dropped"),setTimeout(function(){a.removeClass("tve-dropped")},200),this.remove_empty_column(d),this.row_class(a.parents(".tcb-flex-row").first())},after_clone:function(a,b){this.bind_draggable(b),b.hasClass("thrv_social_default")&&TVE_Content_Builder.social.onDefaultDrop(b),z.bind(b)},after_remove:function(a){y.remove_empty_column(a)},remove_empty_column:function(a){if(a&&a.length&&w(a[0],"tcb-flex-col")&&0===a.children().not(".ui-resizable-handle").length){var b=a.parent();a.remove();var c=b.children(".tcb-flex-col").removeClass("c-25 c-33 c-50 c-66 c-75");0===c.length?b.remove():1===c.length?b.replaceWith(c.children()):w(b[0],"tcb-resized")&&(b.removeClass("tcb-resized"),c.head_css({"max-width":""},"_ALL")),this.row_class(b)}},row_class:function(a){if(a&&a.jquery){var b=a.children().length;a.removeClass(function(a,b){return b.split(" ").filter(function(a){return-1!==a.indexOf("tcb--cols--")}).join(" ")}).addClass("tcb--cols--"+b),b>10&&a.addClass("tcb--cols--high"),this.resize_images(a),a.find(".tve_image_frame")}},resize_images:function(b){b.find(".tve_image_caption").each(function(){var b=parseInt(this.style.width),c=a(this),d=c.width();isNaN(b)||b>d&&(c.css("width",d+"px"),c.find(".tve_image").css("width",d+"px"))})},load_template:function(b,c){var d={action:"tve_load_user_template",template_key:b,security:tve_path_params.tve_ajax_nonce,dataType:"json"};TVE_Editor_Page.overlay(),jQuery.post(tve_path_params.ajax_url,d,function(b){b=JSON.parse(b);var d=a(b.html_code);d=TVE_Content_Builder.apply_filters("tcb_insert_content_template",d),d=tve_process_saved_template(b.css_code,d,b.media_css),TVE_Editor_Page.overlay("close"),y.insert(d,c)}).fail(function(a){tve_add_notification("Something went wrong. Response was: "+a.responseText,!0,7e3),TVE_Editor_Page.overlay("close")})},page_scroll:function(b){function c(b,c){if("undefined"==typeof c&&(c=!1),i.is(":animated"))return!0;var f=i.is("body")?a(window).scrollTop():i.scrollTop();return-1==b?(e.removeClass("tve_scroll_hide"),0===f?d.addClass("tve_scroll_hide").removeClass("tve_drag_hover"):d.removeClass("tve_scroll_hide")):(d.removeClass("tve_scroll_hide"),f+a(window).height()>=a("body").height()-45?e.addClass("tve_scroll_hide").removeClass("tve_drag_hover"):e.removeClass("tve_scroll_hide")),c||i.animate({scrollTop:f+120*b},80,"linear"),!0}"undefined"==typeof b&&(b="body");var d=a('<div id="tve_page_scroller_top" class="tve_window_drag_scroll"><span class="tve_arrow tve_icm tve-ic-caret-up"></span><div class="tve_drag_events"></div></div>').appendTo(b),e=a('<div id="tve_page_scroller_bottom" class="tve_window_drag_scroll"><span class="tve_arrow tve_icm tve-ic-caret-down"></span><div class="tve_drag_events"></div></div>').appendTo(b),f=d.add(e),g=null,h=null,i=a(b);return i.is("body")&&(i=a("body,html")),f.each(function(){var b=a(this).children(".tve_drag_events").first();b.on("dragenter",function(){var b=a(this).parent(),e=b.is(d)?-1:1;clearInterval(h),g=e,h=setInterval(function(){c(e)},20),b.addClass("tve_drag_hover")}),b.on("dragleave",function(){clearInterval(h),a(this).parent().removeClass("tve_drag_hover")})}),c(-1,!0),{show:function(){f.show()},hide:function(){clearInterval(h),f.removeClass("tve_drag_hover tve_scroll_hide")}}},get_selection_type:function(b){var c=!1;return b.length?(b.each(function(){return c===!1?(c=a(this).data("tve-el-type"),!0):c!=a(this).data("tve-el-type")?(c=!1,!1):void 0}),c):!1},hide_control_panel:function(){a("#tve_cpanel_onpage").addClass("tve_menu_force_hide")},show_control_panel:function(){a("#tve_cpanel_onpage").removeClass("tve_menu_force_hide")},get_selected:function(){return TVE_Editor_Page.editor.find("."+k)},clear_selection:function(){this.get_selected().removeClass(k),l=null,TVE_Editor_Page.STATE="enabled"},selection:function(){var a=this.get_selected();return null===l&&(l=this.get_selection_type(a)),{items:a,type:l||!1,has_items:a.length}},convert_old_columns:function(b,c){var d=c.children(),e="tcb-flex-row tcb--cols--"+d.length,f={tve_oth:"c-33",tve_tth:"c-66",tve_foc:"c-25",tve_tfo:"c-75",tve_twc:"c-50"};d.length>=4||2===d.filter(".tve_twc,.tve_oth").length||d.each(function(){var b=this;a.each(f,function(a,c){b.className=b.className.replace(a,c)})}),d.removeClass("tve_colm tve_fic tve_lst tve_foc tve_tfo tve_twc tve_oth tve_tth tve_thc").addClass("tcb-flex-col"),c.removeClass("thrv_columns tve_clearfix").addClass(e),z.bind(c),load_control_panel_menu(c,"columns_flex")}},z={bind:function(b){b=b||TVE_Editor_Page.editor;var c,d,e,f=100,g={},h=null,i=a("<span>",{"class":"ui-resize-left"}),j=a("<span>",{"class":"ui-resize-right"}),k=b.find(".tcb-flex-col");k.find(".ui-resizable-handle").remove(),k.each(function(){var b=a(this);b.data("ui-resizable")&&b.resizable("destroy")}),k.resizable({handles:"e",start:function(b,f){tve_set_window_content_before_action(),TVE_Editor_Page.disable(),d=f.element.parent(),c=d.width();var k=f.element.children(".ui-resizable-handle");e=d.children(".tcb-flex-col"),d.hasClass("tcb-resized")||(e.each(function(){var b=a(this);b.head_css({"max-width":b.outerWidth()/c*100+"%"})}),d.addClass("tcb-resized")),d.addClass("tcb-resizing"),k.before(i),k.after(j),g={elem:f.element.outerWidth()/c*100,next:f.element.next().outerWidth()/c*100},h=null},stop:function(a,b){TVE_Editor_Page.enable(),b.element.head_css({"max-width":h.elem+"%"}),b.element.next().head_css({"max-width":h.next+"%"}),b.element.css("width",""),e.css({"max-width":""}),d.removeClass("tcb-resizing"),b.element.find(".ui-resize-left, .ui-resize-right").remove(),y.resize_images(d),tve_set_window_content_after_action()},resize:function(a,b){var d,e=(100*(15+b.size.width)/c).toFixed(1),k=e-5*Math.floor(e/5),l=e-(h?h.elem:g.elem);return m&&(e=5*parseInt(e/5)),d=(g.next-e+g.elem).toFixed(1),m&&(0===k||l>0&&k>3||0>l&&k>2)?!1:f>=e*c/100||f>=d*c/100?!1:(b.element.css({"max-width":e+"%"}),b.element.next().css({"max-width":d+"%"}),h={elem:e,next:d},i.html(parseFloat(e).toFixed(m?0:1)+"%"),j.html(parseFloat(d).toFixed(m?0:1)+"%"),!1)}})}};n.page_init=function(){this.$el||(this.$el=a('<div id="tve-drop-handle"></div>').appendTo("body"))},n.show=function(){return this.$el.show(),this},n.hide=function(){return this.$el.hide(),this},n.data=function(){return this.$el.data.apply(this.$el,arguments)},n.is=function(){return this.$el.is.apply(this.$el,arguments)},n.reset=function(){this.$el.hide(),this.last_dir=null,this.$el.data("append",null),this.limit_vertical=null,this.force_limit_vertical=null},n.position=function(a,c){var d;w(a[0].parentNode,"tcb-flex-col")&&(d=a.parent());var e,f,g,h,i=a.offset(),j=a.outerWidth(),k=a.outerHeight(),l=b({left:c.clientX,top:c.clientY,limit_vertical:a.limit_vertical},i,j,k);if(this.last_dir===l)return this;switch(!d||"left"!=l&&"right"!=l||(a.removeClass("tve_dragged_over"),d.addClass("tve_dragged_over"),i=d.offset(),k=d.outerHeight(),j=d.outerWidth()),this.data("tt",a),this.last_dir=l,l){case"top":e=j,f=o,g=i.top-o,h=i.left;break;case"right":e=o,f=k,g=i.top,h=i.left+j;break;case"bottom":e=j,f=o,g=i.top+k,h=i.left;break;case"left":e=o,f=k,g=i.top,h=i.left-o}this.$el.css({width:e+"px",height:f+"px",top:g+"px",left:h+"px",opacity:1}).show().data("dir",l)},n.position_mid=function(a){this.$el.data("tt",a),this.last_dir="mid";var b=a.offset();this.$el.css({width:a.outerWidth(),height:o,top:b.top+a.outerHeight()/2,left:b.left}).show().data("dir","mid")},TVE_Content_Builder.drag=y}(jQuery);