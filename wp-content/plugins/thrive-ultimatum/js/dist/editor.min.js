/*! Thrive Ultimatum - 2017-02-15
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};TVE_Content_Builder.ext=TVE_Content_Builder.ext||{};var TU_Editor=TU_Editor||{};!function(a){a(function(){a(".tl-state-minimized").draggable({handle:".multistep-lightbox-heading",stop:function(a,c){"JSON"in window&&b.set_cookie("tve_ult_states_pos",JSON.stringify(c.position))}}),TVE_Content_Builder.add_filter("menu_show",TU_Editor.on_menu_show),tve_ult_page_data.has_content||(TU_Editor.open_template_chooser(),TVE_Content_Builder.add_filter("main_ajax_callback",TU_Editor.open_template_chooser)),TVE_Content_Builder.add_filter("tcb_media_selected",TU_Editor.media_selected),TVE_Content_Builder.add_filter("load_button_values",TU_Editor.load_button_values),a(TVE_Content_Builder).on("menu_show_countdown_timer",TU_Editor.hide_countdown_timer_controls),TVE_Content_Builder.add_filter("tcb_insert_content_template",TU_Editor.pre_process_content_template)}),TU_Editor.pre_process_content_template=function(b){var c=["thrv_ult_bar","thrv_ult_widget"];return a.each(c,function(a,c){return b.hasClass(c)?(b=b.find(".tve_editor_main_content").children(),b.find(".tve-ult-bar-close").remove(),!1):void 0}),b},TU_Editor.open_template_chooser=function(){TVE_Editor_Page.overlay(),TCB_Main.trigger("trigger_action","#tvu-tpl-chooser","click"),setTimeout(function(){a("#tve_lightbox_frame").find(".tve-lightbox-close").hide(),hide_sub_menu()},0)},TU_Editor.media_selected=function(a,b,c){switch(b){case"tu_design_bg":a.tve_ult_design().bgImage(c)}},TU_Editor.on_menu_show=function(a){return a.hasClass("thrv_ult_bar")||a.hasClass("thrv_ult_widget")?(load_control_panel_menu(a,"ult_design"),!0):!1},TU_Editor.load_button_values=function(a,b,c){switch(a){case"ult_design":}var d=c.find(".tu-border-width");if(d.length){var e=parseInt(b.css("borderBottomWidth"));e=isNaN(e)?0:e,d.val(e)}},TU_Editor.hide_countdown_timer_controls=function(a,b,c){c.find(".tve_date_control").remove(),c.find("> ul > li.tve_clear").remove()};var b={tpl_ajax:function(a,b,c){var d={type:"post",dataType:"json",url:tve_ult_page_data.ajaxurl};if("undefined"!=typeof c&&c||TVE_Editor_Page.overlay(),a.action=tve_ult_page_data.tpl_action,a.design_id=a.design_id||tve_ult_page_data.design_id,a.post_id=tve_ult_page_data.post_id,a.security=tve_ult_page_data.security,d.data=a,b)for(var e in b)d[e]=b[e];return jQuery.ajax(d,a)},state_ajax:function(a,b){var c={type:"post",dataType:"json",url:tve_ult_page_data.ajaxurl};if(TVE_Editor_Page.overlay(),a.action=tve_ult_page_data.state_action,a.design_id=a.design_id||tve_ult_page_data.design_id,a.post_id=tve_ult_page_data.post_id,a.security=tve_ult_page_data.security,c.data=a,b)for(var d in b)c[d]=b[d];return jQuery.ajax(c,a)},set_cookie:function(a,b,c,d){d=d||"/",c=c||2592e3;var e,f=new Date;c=parseInt(c),f.setTime(f.getTime()+1e3*c),e=f.toUTCString(),document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+";expires="+e+";path="+d}};TVE_Content_Builder.ext.tve_ult={template:{choose:function(c){var d=a("#tve-ult-tpl").find(".tve_cell_selected:visible");return d.length?tve_ult_page_data.has_content&&"1"===d.find(".multi_step").val()&&!confirm(tve_ult_page_data.L.confirm_multi_step)?!1:(b.tpl_ajax({custom:"choose",tpl:d.find(".lp_code").val()}).done(TVE_Content_Builder.ext.tve_ult.state.insertResponse),TVE_Content_Builder.controls.lb_close(),void a("#tve_lightbox_frame").find(".tve-lightbox-close").show()):(tve_add_notification(tve_ult_page_data.L.alert_choose_tpl,!0),!1)},reset:function(a){return confirm(tve_ult_page_data.L.confirm_tpl_reset)?(b.tpl_ajax({custom:"reset"}).done(TVE_Content_Builder.ext.tve_ult.state.insertResponse),void TVE_Content_Builder.controls.lb_close()):!1},get_saved:function(){a("#tl-saved-templates").html('<p class="tu-tpl-loading">'+tve_ult_page_data.L.fetching_saved_templates+"</p>");var c=a("#tl-user-current-templates:checked").length;return b.tpl_ajax({custom:"get_saved",current_template:c},{dataType:"html"},!0).done(function(b){TVE_Editor_Page.overlay("close"),a("#tl-saved-templates").html(b)}),!1},save:function(c){var d=c.parent().find("input#tve_landing_page_name").val();return d?void b.tpl_ajax({custom:"save",name:c.parent().find("input#tve_landing_page_name").val()}).done(function(b){a("#tve_landing_page_msg").removeClass("tve_warning").addClass("tve_success").html(b.message),a("#tl-saved-templates").html(b.list),TVE_Editor_Page.overlay("close")}):void tve_add_notification(tve_ult_page_data.L.tpl_name_required,!0,5e3)},user_tab_clicked:function(){a("#tl-saved-templates").find(".tu-tpl-loading").length&&setTimeout(this.get_saved,150)},delete_saved:function(){var a=jQuery("#tl-saved-templates").find(".tve_cell_selected:visible");return a.length?confirm(tve_ult_page_data.L.tpl_confirm_delete)?void b.tpl_ajax({custom:"delete",tpl:a.find(".lp_code").val()},{dataType:"html"}).done(function(a){jQuery("#tl-saved-templates").html(a),TVE_Editor_Page.overlay("close"),tve_add_notification(tve_ult_page_data.L.template_deleted,!1,2e3)}):!1:(alert(tve_ult_page_data.L.alert_choose_tpl),!1)}},state:{insertResponse:function(b){function c(){TVE_Content_Builder.controls.lb_close(),TVE_Editor_Page.initEditorActions();try{tve_init_sliders()}catch(a){console.log(a)}setTimeout(function(){TVE_Editor_Page.overlay("close")},1)}function d(a,b){var c=!0;window.tvu_loaded_count=window.tvu_loaded_count||1,window.tvu_loaded_count++,a.each(function(){try{if(!this[e]||!this[e][f]||!this[e][f].length)return c=!1,!1}catch(a){return c=!1,!1}}),c||window.tvu_loaded_count>40?b():setTimeout(function(){d(a,b)},500)}if(!b||b.error)return tve_add_notification("Something went wrong"+(b&&b.error?": "+b.error:""),!0),void setTimeout(function(){TVE_Editor_Page.overlay("close")},1);var e,f,g=document.createElement("link");"sheet"in g?(e="sheet",f="cssRules"):(e="styleSheet",f="rules"),a(".tve_custom_style,.tve_user_custom_style").remove(),TVE_Content_Builder.CSS_Rule_Cache.clear(),b.custom_css.length&&a("head").append(b.custom_css),b.css.thrive_events||a("#thrive_events-css,#tve_lightbox_post-css").remove(),tve_ult_page_data.current_css!=b.tve_ult_page_data.current_css&&a("#"+tve_ult_page_data.current_css+"-css").remove(),tve_path_params=jQuery.extend(tve_path_params,b.tve_path_params,!0),tve_ult_page_data=jQuery.extend(tve_ult_page_data,b.tve_ult_page_data,!0),a("#tu-form-states").html(b.state_bar),a("#tve-ult-editor-replace").replaceWith(a(b.main_page_content));var h=!1,i=a();jQuery.each(b.css,function(b,c){if(!a("link#"+b+"-css").length){h=!0;var d=a("<link />",{rel:"stylesheet",type:"text/css",id:b+"-css",href:c}).appendTo("head");-1===c.indexOf("fonts.googleapis")&&(i=i.add(d))}}),h?d(i,c):c()},toggle_manager:function(c){var d="addClass",e=2592e3,f=a(".multistep-lightbox");c.attr("data-expand")&&(d="removeClass",e=-e),a("body")[d]("tl-state-collapse"),b.set_cookie("tve_ult_state_collapse",1,e,"/"),f.css("display","")},add_edit:function(b,c,d){this.current_state_id=b.attr("data-id")||0;var e=TVE_Content_Builder.controls.lb_open(b,c,d);return a("#tve_lightbox_frame #lb_ult_state_title").val(this.current_state_id?b.parents("li").first().find(".lightbox-step-name").text():""),e},save:function(c){function d(){b.state_ajax({custom:"add",post_title:e}).done(jQuery.proxy(f.insertResponse,f))}var e=a.trim(a("#lb_ult_state_title").val());if(!e)return tve_add_notification(tve_ult_page_data.L.state_name_required,!0),!1;var f=this;return this.current_state_id?void b.state_ajax({custom:"edit_name",post_title:e,id:this.current_state_id}).done(function(b){b.state_bar&&a("#tu-form-states").html(b.state_bar),TVE_Content_Builder.controls.lb_close(),setTimeout(function(){TVE_Editor_Page.overlay("close")},1)}):tve_save_post("true",d)},duplicate:function(a,c,d){var e=this;tve_save_post("true",function(){b.state_ajax({custom:"duplicate",id:a.attr("data-id")}).done(e.insertResponse)}),d.stopPropagation()},state_click:function(a){var b=this;tve_save_post("true",function(){b.display(a.attr("data-id"),!0)})},display:function(a){b.state_ajax({custom:"display",id:a}).done(jQuery.proxy(this.insertResponse,this))},remove:function(a){if(!confirm(tve_ult_page_data.L.confirm_state_delete))return!1;var c=this;b.state_ajax({custom:"delete",id:a.attr("data-id")}).done(jQuery.proxy(c.insertResponse,c)),event.stopPropagation()}},open_bg_media:function(a,b){thrive_open_media(null,"load","tu_design_bg",b)},open_cpanel:function(b,c,d){hide_sub_menu();var e=a(b.data("element-selector"));d.target=e,d.currentTarget=e,tve_editor_init(d,e)},border_width:function(a,b){b.css("border-width",a.val())}},a.fn.tve_ult_design=function(){var a=this;return{bgPattern:function(b){this.clearBgImage().clearBgColor(),a.css({"background-image":"url('"+b.find("input[data-image]").attr("data-image")+"')","background-repeat":"repeat","background-position":""})},clearBgImage:function(){return a.css({"background-image":"","background-repeat":"","background-size":"","background-position":""}),this},clearBgColor:function(){return a.tve_color_selector()&&tve_remove_css_rule(a.tve_color_selector(),"background-color"),a.css("background-color",""),this},bgImage:function(b){this.clearBgImage(),a.css({"background-image":"url('"+b.url+"')","background-repeat":"","background-size":"cover","background-position":"center center"})}}}}(jQuery);