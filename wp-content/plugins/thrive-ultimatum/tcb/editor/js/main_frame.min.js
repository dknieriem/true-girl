/*! Thrive Content Builder - 2017-02-15
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */
!function(a){var b=(Backbone.Model.extend({}),Backbone.View.extend({device:"desktop",responsive:{desktop:{media:"(min-width: 300px)",rule_index:0},tablet:{media:"(max-width: 1023px)",rule_index:1},mobile:{media:"(max-width: 767px)",rule_index:2}},media_query_tpl:function(){return this.responsive[this.device].media},media_rule_index:function(){return this.responsive[this.device].rule_index},all_media:function(){var b=[];return a.each(this.responsive,function(a,c){b.push(c.media)}),b},events:{"click #tve_collapse_editor_btn":"collapse_cpanel","click #tve_flipEditor":"flip_cpanel","click #tve_flipColor":"flip_color","click .tve_click":"forward_click","click .tve-undoredo":"undo_redo","click #tve_update_content":"save",dragstart:"drag_start",dragend:"drag_end","click .cp_draggable":"cpanel_elem_click","click .tcb-preview":"change_preview",keyup:"keyup",keydown:"keydown"},initialize:function(){this.$cpanel=this.$("#tve_cpanel"),this.$loader=this.$("#tve_page_loader"),this.$cpanel.find(".cp_draggable").attr("draggable","true"),this.$container=this.$("#tcb-frame-container"),TVE_Content_Builder.controls.dropdown_menus(),this.admin_bar(),this.custom_events(),this.key_listeners()},keyup:function(a){this.trigger("keyup",a)},keydown:function(a){this.trigger("keydown",a)},custom_events:function(){this.on("editorloaded",this.editor_loaded),this.on("overlayevent",this.overlay),this.on("undoredochange",this.undo_redo_update),this.on("hide_sub_menu",this.hide_sub_menu),this.on("child-drag-end",this.child_drag_end),this.on("lb_opening",function(){this.$el.addClass("frame-maximized")}),this.on("lb_close",function(){this.$el.removeClass("frame-maximized")}),this.on("trigger_action",this.trigger_action)},trigger_action:function(b,c){b instanceof jQuery||(b=a(b)),"function"==typeof b[c]&&b[c]()},admin_bar:function(){var b=a("#wpadminbar"),c=b.length?parseInt(b.height()):0;a(".tve-admin-padding").css("padding-top",c+"px"),a(".tve-admin-position-top").css("top",c+"px")},editor_loaded:function(){this.overlay(!0),this.$("iframe#tve-editor-frame").contents().on("click","a",function(){return a(this).parents("#tve_lightbox_frame, #tve_cpanel_onpage").length?void 0:!1})},overlay:function(a){return a?void this.$loader.removeClass("tve-open"):void this.$loader.addClass("tve-open")},collapse_cpanel:function(a){return this.$el.add(this.$cpanel).toggleClass("tve_editor_collapse"),!1},flip_cpanel:function(b){this.hide_sub_menu(),this.$el.add(this.$cpanel).toggleClass("tve_cpanelFlip");var c=this.$el.hasClass("tve_cpanelFlip")?"left":"right";return a.post(tcb_main_const.ajax_url,{action:"tve_editor_display_config",attribute:"position",value:c,security:tcb_main_const.nonce}),this.trigger("cpanelflip",c),!1},flip_color:function(b){this.hide_sub_menu(),this.$cpanel.toggleClass("tve_is_dark");var c=this.$cpanel.hasClass("tve_is_dark")?"dark":"light";return a.post(tcb_main_const.ajax_url,{action:"tve_editor_display_config",attribute:"color",value:c,security:tcb_main_const.nonce}),this.trigger("cpanelcolorchange",c),!1},hide_sub_menu:function(){this.$(".active_sub_menu").hide()},forward_click:function(a){return this.trigger("clickevent",a),!1},undo_redo:function(b){return this.trigger("undoredo",a(b.target).data("type")),!1},save:function(){return this.trigger("tve_update_content"),!1},undo_redo_update:function(a){a.undo&&this.$("#tve_undo_manager")[a.undo]("tve-disabled"),a.redo&&this.$("#tve_redo_manager")[a.redo]("tve-disabled")},drag_start:function(b){var c=a(b.target);return c.hasClass("cp_draggable")&&"mobile"!=this.device?(b.originalEvent.dataTransfer.setData("text/plain",null),b.target.style.opacity=.6,b.stopPropagation(),this.dragged_elem=this._build_elem_data(c),void this.trigger("dragstart",this.dragged_elem)):!1},drag_end:function(a){a&&(a.target.style.opacity=1),this.dragged_elem=null,this.trigger("main-drag-end")},_build_elem_data:function(a){return{type:a.data("elem"),data:a.data(),post_data:a.find("input").serializeArray()}},cpanel_elem_click:function(b){return this.trigger("insertelement",this._build_elem_data(a(b.currentTarget))),!1},child_drag_end:function(){this.dragged_elem=null},key_listeners:function(){var b=this;a(document).on("keydown",function(a){if(a.ctrlKey&&!a.altKey)switch(a.which){case 83:return b.save();case 89:b.trigger("undoredo","redo");break;case 90:b.trigger("undoredo","undo")}})},change_preview:function(b){var c=a(b.currentTarget),d=this;return requestAnimationFrame(function(){d.$container.removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+c.data("screen"))}),c.siblings().removeClass("selected"),c.addClass("selected"),this.device=c.data("screen"),this.trigger("change_preview",this.device),!1}}));a(function(){window.TCB_Main=new b({el:document.body})})}(jQuery);