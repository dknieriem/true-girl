/*! Thrive Ovation - 2017-02-15
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */
var ThriveOvation=ThriveOvation||{};ThriveOvation.util=ThriveOvation.util||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},function(a){ThriveOvation.util.setLoading=function(a){a.addClass("tvd-disabled"),a.prepend('<span class="tvd-icon-spinner mdi-pulse tvo-small-icon tvd-margin-right-small"></span>')},ThriveOvation.util.removeLoading=function(a){a.removeClass("tvd-disabled"),a.find(".tvd-icon-spinner").remove()},ThriveOvation.util.validateInput=function(a,b,c){var d=a instanceof jQuery?a.val():a,e=!0;return""==d&&(b||(b=ThriveOvation.translations.isRequired),e=!1,a instanceof jQuery&&(a.removeClass("tvd-valid"),a.addClass("tvd-invalid"))),b&&b.length>0&&e===!1&&c&&TVE_Dash.err(b,ThriveOvation["const"].toast_timeout),e},ThriveOvation.util.containsObject=function(a,b){var c;for(c=0;c<b.length;c++)if(b[c].id==a.id)return!0;return!1},ThriveOvation.util.build_mce_init=function(b,c){var d={},e={};return this.hasTinymce()?(d[c]=a.extend(!0,{},b.mce),e[c]=a.extend(!0,{},b.qt),e[c].id=c,d[c].selector="#"+c,d[c].body_class=d[c].body_class.replace("tvo-tinymce-tpl",c),{mce_init:d,qt_init:e}):!1},ThriveOvation.util.clearMCEEditor=function(a){var b=["tvo-testimonial-content-tinymce","tvo-email-template"];b.forEach(function(b){if(a!=b&&"undefined"!=typeof tinymce){var c=tinymce.get(b);c&&c.remove()}})},ThriveOvation.util.getTestimonialContent=function(a){return this.hasTinymce()?tinyMCE.get("tvo-testimonial-content-tinymce").getContent():a.find("#tvo-testimonial-content-tinymce").val()},ThriveOvation.util.hasTinymce=function(){return!!window.tinymce},ThriveOvation.util.validateURL=function(a){var b=a instanceof jQuery?a.val():a,c=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$");return c.test(b)?!0:(a.removeClass("tvd-valid"),a.addClass("tvd-invalid"),!1)},ThriveOvation.util.validateEmail=function(a){var b=a instanceof jQuery?a.val():a,c=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return c.test(b)?!0:(a instanceof jQuery&&(a.removeClass("tvd-valid"),a.addClass("tvd-invalid")),!1)},ThriveOvation.util.bind_wistia=function(){window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes()},ThriveOvation.util.decrementIncrementListCounters=function(a,b){var c;switch(a.get("status")){case ThriveOvation["const"].status.ready_for_display:c=jQuery(".tvo-ready-for-display-c"),c.html(parseInt(c.text())+b);break;case ThriveOvation["const"].status.awaiting_approval:c=jQuery(".tvo-awaiting-approval-c"),c.html(parseInt(c.text())+b);break;case ThriveOvation["const"].status.awaiting_review:c=jQuery(".tvo-awaiting-review-c"),c.html(parseInt(c.text())+b);break;case ThriveOvation["const"].status.rejected:c=jQuery(".tvo-rejected-c"),c.html(parseInt(c.text())+b)}0==a.get("tags").length&&(c=jQuery(".tvo-untagged-c"),c.html(parseInt(c.text())+b)),-1!=a.get("picture_url").indexOf(ThriveOvation.testimonial_image_placeholder)&&(c=jQuery(".tvo-no-picture-c"),c.html(parseInt(c.text())+b))},ThriveOvation.util.incrementDecrementStatusCounters=function(a,b){var c;switch(a){case ThriveOvation["const"].status.ready_for_display:c=jQuery(".tvo-ready-for-display-c");break;case ThriveOvation["const"].status.awaiting_approval:c=jQuery(".tvo-awaiting-approval-c");break;case ThriveOvation["const"].status.awaiting_review:c=jQuery(".tvo-awaiting-review-c");break;case ThriveOvation["const"].status.rejected:c=jQuery(".tvo-rejected-c")}switch(c.html(parseInt(c.text())-1),b){case ThriveOvation["const"].status.ready_for_display:c=jQuery(".tvo-ready-for-display-c");break;case ThriveOvation["const"].status.awaiting_approval:c=jQuery(".tvo-awaiting-approval-c");break;case ThriveOvation["const"].status.awaiting_review:c=jQuery(".tvo-awaiting-review-c");break;case ThriveOvation["const"].status.rejected:c=jQuery(".tvo-rejected-c")}c.html(parseInt(c.text())+1)},ThriveOvation.util.incrementDecrementTagCounters=function(a){var b=jQuery(".tvo-untagged-c");b.html(parseInt(b.text())+a)},ThriveOvation.bindZClip=function(a){function b(){try{a.closest(".tvo-copy-input-content").find("input.tvo-copy").on("click",function(a){this.select(),a.preventDefault(),a.stopPropagation()}),a.zclip({path:ThriveOvation["const"].wp_content+"plugins/thrive-ovation/admin/js/libs/jquery.zclip.1.1.1/ZeroClipboard.swf",copy:function(){return jQuery(this).parents(".tvo-copy-input-content").find("input.tvo-copy").val()},afterCopy:function(){var a=jQuery(this);a.prev().select();var b,c=a.html();a.hasClass("tvd-btn-blue")&&(b="tvd-btn-blue",a.removeClass("tvd-btn-blue").addClass("tvd-btn-green")),a.find(".tvo-copy-text").html('<span class="tvd-icon-check"></span>'),setTimeout(function(){b&&a.removeClass("tvd-btn-green").addClass(b),a.find(".tvo-copy-text").html(c)},3e3),a.parent().prev().select()}})}catch(b){console.error&&console.error("Error embedding zclip - most likely another plugin is messing this up")&&console.error(b)}}setTimeout(b,200)},ThriveOvation.util.CheckCheckboxValue=function(a,b){var c=jQuery(a.currentTarget);1==c.is(":checked")?b.find("."+c.attr("data-hide")).slideDown():b.find("."+c.attr("data-hide")).slideUp()},ThriveOvation.util.setModelWithKeyValue=function(a,b){var c=a.attr("data-key"),d=a.val(),e={};e[c]=d,b.set(e)},ThriveOvation.util.addNewTagInTheSystem=function(a,b){if(a.name=a.text,a.text==a.id){var c=new ThriveOvation.models.Tag(a);c.set("post_id",0),TVE_Dash.showLoader(),c.save(null,{success:function(c,d){b.$el.find('option[value="'+a.id+'"]').remove(),b.$el.find(".tvo-add-tag-autocomplete").append('<option value="'+d.tag.term_id+'" selected>'+d.tag.text+"</option>").trigger("change");var e={id:d.tag.term_id,text:d.tag.text};ThriveOvation.availableTags.push(e),TVE_Dash.hideLoader()},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_added_fail_toast),TVE_Dash.hideLoader()}})}},ThriveOvation.util.addNewTagInTheSystemFromComments=function(a){if(a.name=a.text,a.text==a.id){var b=new ThriveOvation.models.Tag(a);b.set("post_id",0),TVE_Dash.showLoader(),b.save(null,{success:function(b,c){jQuery('option[value="'+a.id+'"]').remove(),jQuery(".tvo-add-tag-autocomplete").append('<option value="'+c.tag.term_id+'" selected>'+c.tag.text+"</option>").trigger("change");var d={id:c.tag.term_id,text:c.tag.text};ThriveOvation.availableTags.push(d),TVE_Dash.hideLoader()},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_added_fail_toast),TVE_Dash.hideLoader()}})}},ThriveOvation.util.Breadcrumbs=function(a,b,c){for(var d in a){var e={title:a[d].title,url:a[d].url},f=[];if(a[d].key==b)return e.url+="undefined"==typeof c?"":"/"+c,[e];if(f=ThriveOvation.util.Breadcrumbs(a[d].kids,b,c),f.length>0)return f.unshift(e),f}return"undefined"==typeof f?[]:f},ThriveOvation.util.incrementDecrementShowHideSpace=function(a,b){var c,d,e;switch(a){case"tvo-show-hide-tags":c=".tvo-show-hide-testimonial-info-container",e="tvd-s3",d="tvd-s6";break;case"tvo-show-hide-status":c=".tvo-show-hide-description-container",e="tvd-s3",d="tvd-s5"}b>0?jQuery(c).removeClass(e).addClass(d):jQuery(c).removeClass(d).addClass(e)}}(jQuery);var ThriveOvation=ThriveOvation||{};ThriveOvation.models=ThriveOvation.models||{},ThriveOvation.collections=ThriveOvation.collections||{},function(a){Backbone.emulateHTTP=!0,ThriveOvation.models.Base=Backbone.Model.extend({idAttribute:"id",sync:function(a,b,c){var d;return c=c||{},c.cache=!1,_.isUndefined(ThriveOvation.nonce)||_.isNull(ThriveOvation.nonce)||(d=c.beforeSend,c.beforeSend=function(a){return a.setRequestHeader("X-WP-Nonce",ThriveOvation.nonce),d?d.apply(this,arguments):void 0}),Backbone.sync(a,b,c)}}),ThriveOvation.collections.Base=Backbone.Collection.extend({sync:function(a,b,c){var d;return c=c||{},c.cache=!1,c.url=this.url(),_.isUndefined(ThriveOvation.nonce)||_.isNull(ThriveOvation.nonce)||(d=c.beforeSend,c.beforeSend=function(a){return a.setRequestHeader("X-WP-Nonce",ThriveOvation.nonce),d?d.apply(this,arguments):void 0}),Backbone.sync(a,b,c)}}),ThriveOvation.models.Settings=ThriveOvation.models.Base.extend({url:ThriveOvation.routes.settings}),ThriveOvation.models.PostMeta=ThriveOvation.models.Base.extend({defaults:{key:"",meta_key:"",meta_value:""},url:function(){return ThriveOvation.routes.postmeta+"/"+this.get("key")}}),ThriveOvation.models.Filters=ThriveOvation.models.Base.extend({defaults:{show_hide_tags:1,show_hide_type:1,show_hide_status:1,testimonial_content:"summary"},url:function(){return ThriveOvation.routes.filters}}),ThriveOvation.models.Testimonial=ThriveOvation.models.Base.extend({defaults:{title:"",name:"",date:"",email:"",role:"",website_url:"",picture_url:"",tags:[],content:"",status:-1,source:"",sent_emails:0},url:function(){var a=ThriveOvation.routes.testimonials;return this.get("id")&&(a+="/"+this.get("id")),a}}),ThriveOvation.models.copyTestimonial=ThriveOvation.models.Base.extend({defaults:{title:"",name:"",date:"",email:"",role:"",website_url:"",picture_url:"",tags:[],content:"",status:-1,source:"",sent_emails:0},url:function(){return ThriveOvation.routes.testimonials+"/copy"}}),ThriveOvation.models.Tag=ThriveOvation.models.Base.extend({idAttribute:"term_id",defaults:{name:"",post_id:""},url:function(){var a=ThriveOvation.routes.tags;return this.get("term_id")&&(a+="/"+this.get("term_id")),a}}),ThriveOvation.models.ActivityLogEntry=ThriveOvation.models.Base.extend({defaults:{id:"",post_id:"",text:"","class":"",date:""}}),ThriveOvation.models.Shortcode=ThriveOvation.models.Base.extend({defaults:{name:"",content:"",type:"",thumbnail:""},url:function(){var a=ThriveOvation.routes.shortcodes;return this.get("id")&&(a+="/"+this.get("id")),a}}),ThriveOvation.collections.Shortcodes=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.Shortcode,url:function(){return ThriveOvation.routes.shortcodes},comparator:function(a){return a.get("id")},parse:function(a){return a.forEach(function(b,c){if(b.config.template&&b.config.template.length>1){var d;"display"==b.config.type?d=b.config.template.split("/",1)[0]:"capture"==b.config.type&&(d="capture"),a[c].thumbnail=ThriveOvation.admin_url+"img/shortcode_"+d+".jpg"}else a[c].thumbnail=""}),a}}),ThriveOvation.models.LandingCombo=ThriveOvation.models.Base.extend({defaults:{id:"",title:""}}),ThriveOvation.collections.LandingCombo=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.LandingCombo}),ThriveOvation.collections.ActivityLog=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.ActivityLogEntry,url:function(){return ThriveOvation.routes.testimonials+"/activity/"}}),ThriveOvation.collections.Testimonials=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.Testimonial,url:function(){return ThriveOvation.routes.testimonials},comparator:function(a){return-a.get("id")}}),ThriveOvation.models.AssetWizardConnection=ThriveOvation.models.Base.extend({idAttribute:"ID",defaults:function(){return{connection:"",active:"",connection_instance:""}}}),ThriveOvation.models.NewConnection=ThriveOvation.models.Base.extend({idAttribute:"ID",defaults:{connected_apis:{}},url:function(){return ThriveOvation.routes.api+"/"+this.get("connection")}}),ThriveOvation.models.LandingPageConfig=ThriveOvation.models.Base.extend({defaults:{approve:"",approve_url:"",approve_post_id:"",approve_post_val:"",not_approve:"",not_approve_url:"",not_approve_post_id:"",not_approve_post_val:""},url:function(){return ThriveOvation.routes.settings+"/landing-page/config"}}),ThriveOvation.models.EmailConfig=ThriveOvation.models.Base.extend({defaults:{subject:"",template:""},url:function(){return ThriveOvation.routes.settings+"/email/config"}}),ThriveOvation.models.ConfirmEmailSend=ThriveOvation.models.Base.extend({defaults:{}}),ThriveOvation.collections.AssetConnection=ThriveOvation.collections.Base.extend({model:ThriveOvation.models.AssetWizardConnection})}(jQuery);var ThriveOvation=ThriveOvation||{};ThriveOvation.views=ThriveOvation.views||{},ThriveOvation.objects=ThriveOvation.objects||{},function(a){a(function(){a(document).keypress(function(a){13!=a.which&&13!=a.keyCode||jQuery("a").is(":focus")||(jQuery("#tvo-delete-testimonial-modal").is(":visible")&&jQuery(".tvo-detele-testimonial-action").focus().click(),jQuery("#tvo-delete-multiple-testimonials-modal").is(":visible")&&jQuery(".tvo-detele-multiple-testimonials-action").focus().click())}),ThriveOvation.views.Base=Backbone.View.extend({modal:function(a,b){return TVE_Dash.modal(a,b)}}),ThriveOvation.views.Breadcrumbs=ThriveOvation.views.Base.extend({render:function(a){var b=this;return this.$el.empty(),_.each(a,function(a){var c=new ThriveOvation.views.BreadcrumbsItem;b.$el.append(c.render(a).el)}),this}}),ThriveOvation.views.BreadcrumbsItem=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("dashboard/breadcrumb-item"),className:"tvd-breadcrumb",tagName:"li",render:function(a){return this.$el.html(this.template({url:a.url,title:a.title})),this}}),ThriveOvation.views.SocialMediaImport=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("social-media/social-media-import"),events:{"click .tvo-import":"importTestimonial","click #tvo-upload-testimonial-image":"openUploadImage","keydown .tvo-url":"captureKeyImport","keydown .tvo-social-field":"captureKeySave","click .tvo-save-testimonial":"saveTestimonial"},render:function(){var a=this.template;return ThriveOvation.social_connections.facebook||ThriveOvation.social_connections.twitter||(a=TVE_Dash.tpl("social-media/no-social-media")),this.$el.html(a()),this.renderTestimonialEditor(),this},populateFieldWithValues:function(a){if(this.$el.find(".tvo-testimonial-area").removeClass("tvd-hide"),this.$el.find("#tvo-author-name").val(a.name),this.$el.find("#tvo-author-email").val(a.email),this.$el.find("#tvo-author-website").val(a.website_url),this.$el.find(".tvo-testimonial-author-image img").attr("src",a.profile_image_url),TVE_Dash.materialize(this.$el),ThriveOvation.util.getTestimonialContent(this.$el)||this.renderTestimonialEditor(),ThriveOvation.util.hasTinymce()?tinyMCE.get("tvo-testimonial-content-tinymce").setContent(a.testimonial):this.$el.find("#tvo-testimonial-content-tinymce").val(a.testimonial),a.source){var b=this.$el.find(".tvo-author-email label");"twitter"==a.source?(b.attr("data-error",b.attr("data-error-twitter")),b.html(b.attr("data-content-twitter"))):"facebook"==a.source&&(b.attr("data-error",b.attr("data-error-facebook")),b.html(b.attr("data-content-facebook")))}this.renderSelectTags()},renderTestimonialEditor:function(){var b=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-testimonial-content-tinymce");b&&(tinyMCEPreInit.mceInit=a.extend(tinyMCEPreInit.mceInit,b.mce_init),tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"].setup=function(a){a.on("change",function(){a.save()})},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"]),window.wpActiveEditor="tvo-testimonial-content-tinymce")},renderSelectTags:function(){var a=this.$el.find("#tvo-social-media-new-tag-modal"),b=this;a.data("select2")&&(a.select2("destroy"),a.val(null),a.unbind("select2:select")),a.select2({tags:!0,multiple:!0,data:ThriveOvation.availableTags,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",function(a){ThriveOvation.util.addNewTagInTheSystem(a.params.data,b)}).on("select2:unselect",function(a){a.params.originalEvent&&a.params.originalEvent.stopPropagation()})},openUploadImage:function(){if(a)return void a.open();var a=wp.media({title:ThriveOvation.translations.choose_testimonial_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),b=this;a.on("select",function(){var c=a.state().get("selection").first().toJSON();b.$el.find(".tvo-testimonial-author-image img").attr("src",c.url)}),a.open()},captureKeyImport:function(a){13!=a.which&&13!=a.keyCode||this.$el.find(".tvo-import").click()},captureKeySave:function(a){13!=a.which&&13!=a.keyCode||this.$el.find(".tvo-save-testimonial").click()},importTestimonial:function(b){var c=ThriveOvation.util.validateURL(this.$el.find(".tvo-url")),d=this.$el.find(".tvo-url").val(),e=jQuery(b.currentTarget),f=this;if(c){if(e.hasClass("tvd-disabled"))return;ThriveOvation.util.setLoading(e),a.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},cache:!1,url:ThriveOvation.routes.socialmedia+"/import_testimonial",type:"POST",data:{social_media_url:d}}).done(function(a){switch(a.code){case 0:TVE_Dash.err(a.message);break;case 1:TVE_Dash.success(a.message),f.populateFieldWithValues(a.result)}}).error(function(){TVE_Dash.err(ThriveOvation.translations.invalid_social_request)}).always(function(){ThriveOvation.util.removeLoading(e),TVE_Dash.hideLoader()})}else TVE_Dash.err(ThriveOvation.translations.invalid_url)},validateModel:function(){var a=!0;return this.$el.find("#tvo-author-website").val()&&!ThriveOvation.util.validateURL(this.$el.find("#tvo-author-website"))&&(a=!1),ThriveOvation.util.validateInput(this.$el.find("#tvo-author-name"),ThriveOvation.translations.isRequired)||(a=!1),ThriveOvation.util.validateInput(ThriveOvation.util.getTestimonialContent(this.$el),ThriveOvation.translations.testimonial_content_missing,!0)?this.$el.find(".tvo-testimonial-content").removeClass("tvo-tiny-mce-error"):(a=!1,this.$el.find(".tvo-testimonial-content").addClass("tvo-tiny-mce-error")),a},clearAreaAfterSave:function(){this.$el.find(".tvo-url").val(""),this.$el.find(".tvo-testimonial-area").addClass("tvd-hide")},saveTestimonial:function(a){var b=jQuery(a.currentTarget),c=new ThriveOvation.models.Testimonial,d={},e=this;if(this.validateModel()){if(b.hasClass("tvd-disabled"))return;ThriveOvation.util.setLoading(b),d={title:this.$el.find("#tvo-title").val(),name:this.$el.find("#tvo-author-name").val(),email:this.$el.find("#tvo-author-email").val(),role:this.$el.find("#tvo-author-role").val(),website_url:this.$el.find("#tvo-author-website").val(),content:ThriveOvation.util.getTestimonialContent(this.$el),tags:this.$el.find("#tvo-social-media-new-tag-modal").val(),source:ThriveOvation["const"].source.social_media,picture_url:this.$el.find(".tvo-testimonial-author-image img").prop("src"),comment_url:this.$el.find(".tvo-url").val()},c.save(d,{success:function(a,c){TVE_Dash.success(ThriveOvation.translations.testimonial_saved_success_toast),ThriveOvation.util.removeLoading(b),e.clearAreaAfterSave()},error:function(a,c){TVE_Dash.err(ThriveOvation.translations.testimonial_saved_error_toast),ThriveOvation.util.removeLoading(b)}})}}}),ThriveOvation.views.Testimonials=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/list"),events:{"change .tvo-testimonials-select-all":"checkUncheckTestimonials","change .tvo-checkbox-testimonial-item":"showHideCheckboxActions","click .tvo-filter":"applyFilters","change .tvo-dropdown-filter":"applyDropDownFilters","change .tvo-filter-content":"filterContent","click .tvo-detele-testimonial-action":"deleteTestimonial","click .tvo-delete-multiple-testimonials-modal":"deleteTestimonialsModal","click .tvo-detele-multiple-testimonials-action":"deleteMultipleTestimonials","click .tvo-add-new-testimonial":"newTestimonialModal","click .tvo-show-hide":"showHideElements","click .tvo-add-tags-to-multiple-testimonials":"addTagsToMultipleTestimonials","click .tvo-new-dropdown-button":"showTagDropdown","keyup .tvo-multiple-tag-search":"searchMultipleTags","change .tvo-add-multiple-tags-checkbox":"checkMultipleTestimonialsCheckboxForParticularClass","keydown .tvo-delete-testimonial-modal":"capturekey","keydown .tvo-delete-multiple-testimonials-modal":"capturekey","click .tvo-testimonial-duplicate":"duplicate"},testimonialsPagination:null,filter_status:[],filter_untagged:0,filter_nopicture:0,initialize:function(){var a=this,b=jQuery(document);this.render(),b.off("filterReset"),b.on("filterReset",function(){a.resetFilters()})},showHideElements:function(a){var b=jQuery(a.currentTarget),c=b.attr("id");b.is(":checked")?(jQuery("."+c+"-container").removeClass("tvd-hide"),ThriveOvation.util.incrementDecrementShowHideSpace(c,-1)):(jQuery("."+c+"-container").addClass("tvd-hide"),ThriveOvation.util.incrementDecrementShowHideSpace(c,1)),this.saveFilters()},capturekey:function(a){13!=a.which&&13!=a.keyCode||(this.$el.find("#tvo-delete-testimonial-modal").is(":visible")&&this.$el.find(".tvo-detele-testimonial-action").focus().click(),this.$el.find("#tvo-delete-multiple-testimonials-modal").is(":visible")&&this.$el.find(".tvo-detele-multiple-testimonials-action").focus().click())},showHideMassActions:function(){var a=this.$(".tvo-checkbox-testimonial-item");a.filter(":checkbox:checked").length?this.$(".tvo-testimonials-select-all-actions").removeClass("tvd-hide"):this.$(".tvo-testimonials-select-all-actions").addClass("tvd-hide"),this.$(".tvo-testimonials-select-all").prop("checked",!a.not(":checked").length)},resetTheParticularTags:function(){this.$el.find(".tvo-multiple-tag-search").val("").trigger("change"),this.$el.find(".tvo_multiple_tag_container").removeClass("tvd-hide"),this.$el.find(".tvo-add-multiple-tags-checkbox").removeAttr("checked")},resetView:function(){this.$el.find(".tvo-testimonials-select-all-actions").addClass("tvd-hide"),this.$el.find(".tvo-testimonials-select-all").prop("checked",!1).trigger("change"),this.resetTheParticularTags()},showHideCheckboxActions:function(b){var c=a(b.currentTarget);this.adjustTagsCheckboxes(),c.is(":checked")?c.parents(".tvo-gray-box").addClass("tvo-highlight-row"):c.parents(".tvo-gray-box").removeClass("tvo-highlight-row"),this.showHideMassActions()},checkUncheckTestimonials:function(b){var c=jQuery(b.currentTarget);this.$(".tvo-checkbox-testimonial-item").prop("checked",a(c).is(":checked")).trigger("change")},adjustTagsCheckboxes:function(){var a=[];this.resetTheParticularTags(),jQuery(".tvo-checkbox-testimonial-item:checked").each(function(){for(var b=jQuery(this).attr("data-id"),c=ThriveOvation.objects.Testimonials.get(b),d=c.get("tags"),e=0;e<d.length;e++)-1===jQuery.inArray(d[e].id,a)&&a.push(d[e].id)}),this.$el.find(".tvo-add-multiple-tags-checkbox").each(function(){var b=jQuery(this).attr("data-id"),c=this;jQuery(c).removeClass("tvo-multiple-tags-particular"),jQuery.inArray(parseInt(b),a)>-1&&jQuery(c).addClass("tvo-multiple-tags-particular")})},searchMultipleTags:function(a){var b=jQuery(a.currentTarget),c=jQuery(b).val().toLowerCase();this.$el.find(".tvo_multiple_tag_container").each(function(){var a=jQuery(this).attr("data-label");-1===a.indexOf(c)?jQuery(this).addClass("tvd-hide"):jQuery(this).removeClass("tvd-hide")});var d=this.$el.find(".tvo_multiple_tag_container").not(".tvd-hide").length;0==d?(this.$el.find(".tvo-no-tags-to-display").removeClass("tvd-hide"),this.$el.find(".tvo-add-tags-to-multiple-testimonials").attr("disabled","disabled")):(this.$el.find(".tvo-no-tags-to-display").addClass("tvd-hide"),this.$el.find(".tvo-add-tags-to-multiple-testimonials").removeAttr("disabled"))},filterContent:function(a){var b=jQuery(a.currentTarget);"summary"==jQuery(b).val()?jQuery(".tvo-testimonial-content-full").addClass("tvd-hide"):jQuery(".tvo-testimonial-content-summary").addClass("tvd-hide"),jQuery(".tvo-testimonial-content-"+jQuery(b).val()).removeClass("tvd-hide"),this.saveFilters()},saveFilters:function(){var a=new ThriveOvation.models.Filters({show_hide_tags:Number(this.$el.find("#tvo-show-hide-tags")[0].checked),show_hide_type:Number(this.$el.find("#tvo-show-hide-type")[0].checked),show_hide_status:Number(this.$el.find("#tvo-show-hide-status")[0].checked),testimonial_content:this.$el.find(".tvo-filter-content").val()});a.save(null,{success:function(a,b){},error:function(a,b){}})},deleteTestimonial:function(a){var b=jQuery(a.currentTarget),c=jQuery(b).attr("data-id"),d=ThriveOvation.objects.Testimonials.get(c),e=this;d.destroy({success:function(a,b){jQuery(".testimonial-row-"+b).slideUp("normal",function(){jQuery(this).remove()}),ThriveOvation.util.decrementIncrementListCounters(a,-1),e.resetView(),e.testimonialsPagination.changePage(),TVE_Dash.success(ThriveOvation.translations.testimonial_deleted_success_toast)},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.testimonial_deleted_fail_toast)}})},duplicate:function(b){var c=jQuery(b.currentTarget),d=jQuery(c).attr("data-id"),e=ThriveOvation.objects.Testimonials.get(d),f=e;f=new ThriveOvation.models.copyTestimonial(e.toJSON()),f.save().done(function(b){TVE_Dash.success(b.message);var c=new ThriveOvation.models.Testimonial(b),d=new ThriveOvation.views.TestimonialsItem({model:c}),e=d.render().$el;ThriveOvation.util.decrementIncrementListCounters(c,1),ThriveOvation.objects.Testimonials.push(c),ThriveOvation.objects.TestimonialsList.$el.prepend(e);var f=new ThriveOvation.views.TestimonialPagination({collection:ThriveOvation.objects.Testimonials,view:ThriveOvation.objects.TestimonialsList,el:jQuery(".tvo-top-pagination"),type:"static"});f.changePage(),a(".tvd-material-tooltip").hide()}).error(function(a){a=JSON.parse(a.responseText),TVE_Dash.err(a.message+": "+a.code)})},newTestimonialModal:function(){return this.modal(ThriveOvation.views.ModalNewTestimonial,{model:new ThriveOvation.models.Testimonial}),this},checkMultipleTestimonialsCheckboxForParticularClass:function(a){var b=jQuery(a.currentTarget);b.removeClass("tvo-multiple-tags-particular")},addTagsToMultipleTestimonials:function(b){var c=[],d=[],e=[],f=this;TVE_Dash.showLoader(),this.$el.find(".tvo-add-multiple-tags-checkbox").each(function(){var a=jQuery(this);if(a.attr("checked")){var b=a.attr("data-id");d.push(b)}else if(!a.hasClass("tvo-multiple-tags-particular")){var c=a.attr("data-id");e.push(c)}}),this.$el.find(".tvo-checkbox-testimonial-item:checked").each(function(){var a=jQuery(this).attr("data-id");c.push(a)}),a.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},cache:!1,url:ThriveOvation.routes.tags+"/add_multiple_tags_to_multiple_testimonials",type:"POST",data:{tvo_testimonial_ids:c,tvo_tags_ids:d,tvo_delete_tags_ids:e}}).done(function(a){a.length>0&&(f.resetView(),f.fetchTestimonialListData()),f.$el.find(".tvo-close-modal-add-tags-to-multiple-testimonials").click()}).always(function(){setTimeout(function(){TVE_Dash.hideLoader()},500)})},deleteTestimonialsModal:function(a){var b=jQuery("#tvo-delete-multiple-testimonials-modal");b.openModal({})},deleteMultipleTestimonials:function(b){var c=[],d=[],e=this;this.$el.find(".tvo-checkbox-testimonial-item:checked").each(function(){var a=jQuery(this).attr("data-id"),b=ThriveOvation.objects.Testimonials.get(a);c.push(a),d.push(b)}),a.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},cache:!1,url:ThriveOvation.objects.Testimonials.url(),type:"DELETE",data:{tvo_testimonial_elements:c}}).done(function(a){for(var b=0;b<a.length;b++)jQuery(".testimonial-row-"+a[b]).remove();jQuery(d).each(function(a,b){ThriveOvation.util.decrementIncrementListCounters(b,-1),ThriveOvation.objects.Testimonials.remove(b)}),e.resetView(),e.testimonialsPagination.changePage(),TVE_Dash.success(ThriveOvation.translations.multiple_testimonials_deleted_success_toast)}).error(function(){TVE_Dash.err(ThriveOvation.translations.multiple_testimonials_deleted_fail_toast)}).always(function(){TVE_Dash.hideLoader()})},applyFilters:function(a){var b=jQuery(a.currentTarget),c=this;TVE_Dash.showLoader(),this.$el.find(".tvo-testimonials-select-all").prop("checked",!1).trigger("change"),this.adjustTagsCheckboxes(),b.hasClass("tvo-filter-status")?(c.filter_status=[],jQuery("input:checkbox.tvo-filter-status").each(function(){this.checked&&c.filter_status.push(jQuery(this).val())})):b.hasClass("tvo-filter-tag")?b.is(":checked")?c.filter_untagged=1:c.filter_untagged=0:b.hasClass("tvo-filter-picture")&&(b.is(":checked")?c.filter_nopicture=1:c.filter_nopicture=0),this.testimonialsPagination.changePage(null,{status:c.filter_status,untagged:c.filter_untagged,nopicture:c.filter_nopicture})},applyDropDownFilters:function(a){var b=jQuery(a.currentTarget),c=this,d=b.attr("class").split(" ").shift();switch(TVE_Dash.showLoader(),this.$el.find(".tvo-testimonials-select-all").prop("checked",!1).trigger("change"),this.adjustTagsCheckboxes(),d){case"tvo-image-filter":c.image_filter=b.val(),"any"==b.val()&&b.val("select-title");break;case"tvo-title-filter":c.title_filter=b.val(),"any"==b.val()&&b.val("select-image")}this.testimonialsPagination.changePage(null,{titleFilter:c.title_filter,imageFilter:c.image_filter})},resetFilters:function(){var a=this.$el.find(".tvo-image-filter"),b=this.$el.find(".tvo-title-filter"),c=this.$el.find("#tvo-dashboard-filter-tags");c.select2("val",""),this.testimonialsPagination.changePage(null,{tagsFilter:""}),b.val("select-title").trigger("change"),a.val("select-image").trigger("change")},showTagDropdown:function(b){var c=this.$el,d=this,e=jQuery(b.target),f=e.parents(".tvo-new-dropdown"),g=f.find(".tvo-new-dropdown-content");f.toggleClass("tvd-active"),g.slideToggle(),b.stopPropagation(),c.parents("body").off("click.clearDropdown").on("click.clearDropdown",function(b){if(!a(b.target).parents().is(f)){var e=c.find(".tvo-new-dropdown"),g=c.find(".tvo-new-dropdown-content");e.hasClass("tvd-active")&&(g.slideUp(),e.removeClass("tvd-active"),d.resetTheParticularTags())}})},render:function(){return this.$el.html(this.template()),TVE_Dash.materialize(this.$el),ThriveOvation.objects.Testimonials=new ThriveOvation.collections.Testimonials,ThriveOvation.objects.TestimonialsList=new ThriveOvation.views.TestimonialsList({collection:ThriveOvation.objects.Testimonials,el:this.$el.find("#tvo-testimonials-list")}),this.testimonialsPagination=new ThriveOvation.views.TestimonialPagination({collection:ThriveOvation.objects.Testimonials,view:ThriveOvation.objects.TestimonialsList,el:this.$el.find(".tvo-top-pagination"),type:"static"}),this.renderFilterTags(),this.fetchTestimonialListData(),setTimeout(function(){jQuery(".tvd-dropdown-button").tvd_dropdown()},500),TVE_Dash.hideLoader(),this},fetchTestimonialListData:function(){var a=this;ThriveOvation.objects.Testimonials.fetch({success:function(){a.testimonialsPagination.changePage()}})},renderFilterTags:function(){var a=this,b=this.$el.find("#tvo-dashboard-filter-tags");b.data("select2")&&b.select2("destroy"),b.select2({tags:!0,multiple:!0,data:ThriveOvation.availableTags,placeholder:ThriveOvation.translations.select_filter_tags}).on("select2:select",function(c){a.testimonialsPagination.changePage(null,{tagsFilter:b.val()})}).on("select2:unselect",function(c){c.params.originalEvent&&(a.testimonialsPagination.changePage(null,{tagsFilter:b.val()}),c.params.originalEvent.stopPropagation())})}}),ThriveOvation.views.TestimonialsList=ThriveOvation.views.Base.extend({events:{},initialize:function(){},renderOne:function(a){var b=new ThriveOvation.views.TestimonialsItem({model:a}),c=b.render().$el;this.$el.append(c)},render:function(a){this.$el.empty();var b=this.collection;return"undefined"!=typeof a&&(b=new ThriveOvation.collections.Testimonials(a)),b.each(this.renderOne,this),this}}),ThriveOvation.views.TestimonialsItem=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/item"),events:{"change .tvo-testimonial-status-change":"updateTestimonialStatus","click .tvo-delete-testimonial-modal":"deleteTestimonialModal","click .tvo-remove-testimonial-tag":"deleteTestimonialTag","click .tvo-add-new-tag":"addNewTag","click .tvo-add-new-tag-action":"addNewTagAction"},attributes:function(){return{"class":"tvd-row tvo-gray-box testimonial-row-"+this.model.get("id")}},initialize:function(a){},addNewTag:function(a){this.$el.find(".tvo-testimonial-"+this.model.get("id")+"-tag-display-area").addClass("tvd-hide"),
this.$el.find(".tvo-testimonial-"+this.model.get("id")+"-tag-add-area").removeClass("tvd-hide"),this.$el.find("#tvo-testimonial-"+this.model.get("id")+"-new-tag").select2("open")},addNewTagAction:function(a){var b=jQuery(a.currentTarget),c=this.$el.find("#tvo-testimonial-"+this.model.get("id")+"-new-tag").select2("data"),d=this,e=this.model.get("tags").length;b.hasClass("tvd-disabled")||(ThriveOvation.util.setLoading(b),this.model.set("tags",this.$el.find("#tvo-testimonial-"+this.model.get("id")+"-new-tag").val()),this.model.save(null,{success:function(a,b){var f="";c.length>0?jQuery.each(c,function(b,c){var d={id:c.id,text:c.text,model_id:a.get("id")};f+=TVE_Dash.tpl("testimonials/tag-item",{object:d})}):f+='<i class="tvd-small-text tvo-gray-text">'+ThriveOvation.translations.untagged_testimonial+"</i>",d.$el.find(".tvo-testimonial-"+a.get("id")+"-tag-display-area > div.tvd-clearfix").html(f),d.$el.find(".tvo-testimonial-"+a.get("id")+"-tag-display-area").removeClass("tvd-hide"),d.$el.find(".tvo-testimonial-"+a.get("id")+"-tag-add-area").addClass("tvd-hide"),0===e&&a.get("tags").length>0?ThriveOvation.util.incrementDecrementTagCounters(-1):e>0&&0===a.get("tags").length&&ThriveOvation.util.incrementDecrementTagCounters(1),TVE_Dash.success(ThriveOvation.translations.testimonial_tag_added_success_toast)},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_added_fail_toast)},complete:function(){ThriveOvation.util.removeLoading(b)}}))},renderSelectTags:function(){var a=this,b=this.$el.find("#tvo-testimonial-"+this.model.get("id")+"-new-tag");b.data("select2")&&b.select2("destroy"),null==a.$el.find("#tvo-testimonial-"+a.model.get("id")+"-new-tag").val()&&a.$el.find(".tvo-add-new-tag-action").html(ThriveOvation.translations.update_tags),b.select2({tags:!0,multiple:!0,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",function(b){a.$el.find(".tvo-add-new-tag-action").html(ThriveOvation.translations.save),ThriveOvation.util.addNewTagInTheSystem(b.params.data,a)}).on("select2:unselect",function(b){b.params.originalEvent&&(null==a.$el.find("#tvo-testimonial-"+a.model.get("id")+"-new-tag").val()&&a.$el.find(".tvo-add-new-tag-action").html(ThriveOvation.translations.update_tags),b.params.originalEvent.stopPropagation())}).on("select2:open",function(b){var c=a.$el.find(".tvo-testimonial-"+a.model.get("id")+"-tag-add-area").find(".select2-search__field"),d=a.$el.find("#tvo-testimonial-"+a.model.get("id")+"-new-tag");c.unbind(),c.keyup(function(b){13===b.which&&""==c.val()&&(d.select2("close"),a.$el.find(".tvo-testimonial-"+a.model.get("id")+"-tag-add-area").find(".tvo-add-new-tag-action").click())})})},renderTags:function(a){var b=this;b.$el.find("#tvo-testimonial-"+b.model.get("id")+"-new-tag").empty(),ThriveOvation.availableTags.forEach(function(c){var d="";ThriveOvation.util.containsObject(c,a)&&(d='selected="selected"');var e='<option value="'+c.id+'" '+d+">"+c.text+"</option>";b.$el.find("#tvo-testimonial-"+b.model.get("id")+"-new-tag").append(e)}),b.renderSelectTags()},deleteTestimonialModal:function(a){var b=jQuery("#tvo-delete-testimonial-modal"),c=a.currentTarget.attributes["data-id"].value,d=a.currentTarget.attributes["data-title"].value;b.find(".tvo-delete-content-title").html(d),b.openModal({ready:function(){b.find(".tvo-detele-testimonial-action").attr("data-id",c)}})},updateTestimonialStatus:function(a){var b=jQuery(a.currentTarget),c=jQuery(b).val(),d=jQuery(b).attr("data-value");if(c!=d){this.model.set({status:c});var e=new ThriveOvation.models.PostMeta({key:this.model.get("id"),meta_key:ThriveOvation["const"].meta_key.status,meta_value:c});e.save(null,{success:function(a,e){jQuery(b).attr("data-value",c).removeClass("tvo-testimonial-status-"+d).addClass("tvo-testimonial-status-"+c),ThriveOvation.util.incrementDecrementStatusCounters(d,c),TVE_Dash.success(ThriveOvation.translations.status_changed_success_toast)},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.status_changed_fail_toast)}})}},deleteTestimonialTag:function(a){for(var b=jQuery(a.currentTarget),c=b.attr("data-testimonial-id"),d=b.attr("data-tag-id"),e=this.model.get("tags"),f=[],g=this.$el,h=this,i=0;i<e.length;i++)if(e[i].id==d){f.name=e[i].text,f.post_id=e[i].post_id,f.term_id=e[i].id;break}var j=new ThriveOvation.models.Tag(f);j.destroy({data:{post_id:f.post_id,id:f.term_id},processData:!0,success:function(a,b){if(g.find(".tvo-testimonial-custom-tag-"+c+"-"+d).remove(),0===g.find(".tvo-testimonial-custom-tag").length){var e='<i class="tvd-small-text tvo-gray-text">'+ThriveOvation.translations.untagged_testimonial+"</i>";g.find("div.tvo-testimonial-"+c+"-tag-display-area > div.tvd-clearfix").html(e),ThriveOvation.util.incrementDecrementTagCounters(1)}TVE_Dash.success(ThriveOvation.translations.testimonial_tag_removed_success_toast),g.find("div.tvo-testimonial-"+c+"-tag-display-area > div.tvd-clearfix").html(e),h.deleteTagFromSelect(f.term_id)},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.testimonial_tag_removed_fail_toast)}})},deleteTagFromSelect:function(b){var c=this.model.get("tags"),d=a.grep(c,function(a){return a.id!=b});this.model.set("tags",d),this.renderTags(d)},render:function(){this.$el.html(this.template({testimonial:this.model})),TVE_Dash.materialize(this.$el);var a=this.model.get("tags");return this.renderTags(a),this}}),ThriveOvation.views.TestimonialPagination=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("pagination/post-view"),events:{"click a.page":"setLoaderBeforeChangingThePage","change .tvo-items-per-page":"changeItemPerPage"},currentPage:1,pageCount:1,itemsPerPage:10,total_items:0,collection:null,params:null,type:"",view:null,initialize:function(a){this.collection=a.collection,this.view=a.view,this.type=a.type},changeItemPerPage:function(a){var b=this;TVE_Dash.showLoader(),this.itemsPerPage=jQuery(a.target).val(),setTimeout(function(){b.changePage(null,{page:1})},10)},setLoaderBeforeChangingThePage:function(a,b){var c=this;TVE_Dash.showLoader(),setTimeout(function(){c.changePage(a,b)},10)},changePage:function(b,c){TVE_Dash.showLoader();var d=this,e={itemsPerPage:this.itemsPerPage},f={readyForDisplay:0,awaitingReview:0,awaitingApproval:0,rejected:0,untagged:0,noPicture:0};if(b&&"undefined"!=typeof b.currentTarget?e.page=jQuery(b.currentTarget).attr("value"):c&&"undefined"!=typeof c.page?e.page=parseInt(c.page):e.page=this.currentPage,e.page<1&&(e.page=1),"undefined"!=typeof c&&("undefined"!=typeof c.search_by&&(this.search_by=c.search_by),"undefined"!=typeof c.status&&(this.status=c.status),"undefined"!=typeof c.untagged&&(this.untagged=c.untagged),"undefined"!=typeof c.nopicture&&(this.nopicture=c.nopicture),"undefined"!=typeof c.titleFilter&&(this.titleFilter=c.titleFilter),"undefined"!=typeof c.imageFilter&&(this.imageFilter=c.imageFilter),"undefined"!=typeof c.tagsFilter&&(this.tagsFilter=c.tagsFilter)),e.search_by=this.search_by?this.search_by:"",e.exclude=this.exclude?this.exclude:[],e.status=this.status?this.status:[],e.untagged=this.untagged?this.untagged:0,e.nopicture=this.nopicture?this.nopicture:0,e.titleFilter=this.titleFilter?this.titleFilter:"",e.imageFilter=this.imageFilter?this.imageFilter:"",e.tagsFilter=this.tagsFilter?this.tagsFilter:[],"dynamic"==this.type)this.collection.fetch({reset:!0,data:a.param(e),success:function(){return 0==d.collection.length&&d.collection.total_count>0&&1!=d.currentPage?void d.changePage(null,{page:d.currentPage-1}):(d.updateParams(e.page,d.collection.total_count),void d.render())}});else if("static"==this.type&&"undefined"!=typeof this.view&&null!=this.view){this.updateParams(e.page,this.collection.length);var g,h=this.collection.clone(),i=(this.currentPage-1)*this.itemsPerPage,j=[];"undefined"!=typeof h.comparator&&h.sort(),h.each(function(a){switch(a.get("status")){case ThriveOvation["const"].status.ready_for_display:f.readyForDisplay++;break;case ThriveOvation["const"].status.awaiting_approval:f.awaitingApproval++;break;case ThriveOvation["const"].status.awaiting_review:f.awaitingReview++;break;case ThriveOvation["const"].status.rejected:f.rejected++}if(e.status.length>0&&-1===jQuery.inArray(a.get("status"),e.status)&&j.push(a),a.get("tags").length>0?0!=e.untagged&&j.push(a):f.untagged++,-1==a.get("picture_url").indexOf(ThriveOvation.testimonial_image_placeholder)?0!=e.nopicture&&j.push(a):f.noPicture++,e.tagsFilter.length>0){for(var b=!0,c=a.get("tags").map(function(a){return a.id}),d=0;d<e.tagsFilter.length;d++)-1!==c.indexOf(parseInt(e.tagsFilter[d]))&&(b=!1);b&&j.push(a)}if(""!=e.titleFilter){var g=e.titleFilter,h=a.get("title")||"";switch(g){case"with-title":""==h&&j.push(a);break;case"without-title":""!=h&&j.push(a)}}if(""!=e.imageFilter){var i=e.imageFilter;switch(i){case"with-image":0==a.get("has_picture")&&j.push(a);break;case"without-image":1==a.get("has_picture")&&j.push(a)}}}),d.setCountersToLabels(f);for(var k in j)h.remove(j[k]);if(this.updateParams(e.page,h.length),g=h.chain().rest(i).first(this.itemsPerPage).value(),this.view.render(g),0==g.length){if(d.collection.length>0&&1!=d.currentPage)return void d.changePage(null,{page:d.currentPage-1});jQuery("#tvo-testimonials-list").html(TVE_Dash.tpl("pagination/no-results"))}this.checkFieldsDisplay(),this.render()}return!1},setCountersToLabels:function(a){jQuery(".tvo-ready-for-display-c").html(a.readyForDisplay),jQuery(".tvo-awaiting-approval-c").html(a.awaitingApproval),jQuery(".tvo-awaiting-review-c").html(a.awaitingReview),jQuery(".tvo-rejected-c").html(a.rejected),jQuery(".tvo-untagged-c").html(a.untagged),jQuery(".tvo-no-picture-c").html(a.noPicture)},checkFieldsDisplay:function(){jQuery("#tvo-show-hide-tags").is(":checked")?(jQuery(".tvo-show-hide-tags-container").removeClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-tags",-1)):(jQuery(".tvo-show-hide-tags-container").addClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-tags",1)),jQuery("#tvo-show-hide-status").is(":checked")?(jQuery(".tvo-show-hide-status-container").removeClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-status",-1)):(jQuery(".tvo-show-hide-status-container").addClass("tvd-hide").trigger("change"),ThriveOvation.util.incrementDecrementShowHideSpace("tvo-show-hide-status",1)),jQuery("#tvo-show-hide-type").is(":checked")?jQuery(".tvo-show-hide-type-container").removeClass("tvd-hide").trigger("change"):jQuery(".tvo-show-hide-type-container").addClass("tvd-hide").trigger("change"),"full"==jQuery(".tvo-filter-content").val()?(jQuery(".tvo-testimonial-content-summary").addClass("tvd-hide"),jQuery(".tvo-testimonial-content-full").removeClass("tvd-hide")):(jQuery(".tvo-testimonial-content-summary").removeClass("tvd-hide"),jQuery(".tvo-testimonial-content-full").addClass("tvd-hide"))},updateParams:function(a,b){this.currentPage=a,this.total_items=b,this.pageCount=Math.ceil(this.total_items/this.itemsPerPage)},setupParams:function(a){this.currentPage=a,this.total_items=this.collection.length,this.pageCount=Math.ceil(this.total_items/this.itemsPerPage)},render:function(){return this.$el.html(this.template({currentPage:parseInt(this.currentPage),pageCount:parseInt(this.pageCount),total_items:parseInt(this.total_items),itemsPerPage:parseInt(this.itemsPerPage)})),TVE_Dash.hideLoader(),TVE_Dash.materialize(this.$el),this}}),ThriveOvation.views.ModalNewTestimonial=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("testimonials/testimonial/modal"),type:"",events:{"click .tvo-save-new-testimonial":"save","click .tvo-upload-testimonial-image":"openUploadImage","click #tvo-remove-testimonial-image":"removeImage","keydown .tvo-testimonial-input":"enterPress"},afterRender:function(){return this.$el.html(this.template({testimonial:this.model})),this.renderTestimonialEditor(),this.$el.addClass("tvo-big-modal"),this},afterMaterialize:function(){return this.renderSelectTags(),this},enterPress:function(a){13!=a.which&&13!=a.keyCode||this.save()},renderSelectTags:function(){var a=this.$el.find("#tvo-author-new-tag-modal"),b=this;a.data("select2")&&a.select2("destroy"),a.select2({tags:!0,multiple:!0,data:ThriveOvation.availableTags,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",function(a){ThriveOvation.util.addNewTagInTheSystem(a.params.data,b)}).on("select2:unselect",function(a){a.params.originalEvent&&a.params.originalEvent.stopPropagation()})},renderTestimonialEditor:function(){var b=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-testimonial-content-tinymce");b&&(tinyMCEPreInit.mceInit=a.extend(tinyMCEPreInit.mceInit,b.mce_init),tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"].setup=function(a){a.on("change",function(){a.save()})},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"]),window.wpActiveEditor="tvo-testimonial-content-tinymce")},validateModel:function(){var a=!0;return ThriveOvation.util.validateInput(this.$el.find("#tvo-author-name"),ThriveOvation.translations.author_name_required,!0)||(a=!1),this.$el.find("#tvo-author-email").val()&&!ThriveOvation.util.validateEmail(this.$el.find("#tvo-author-email"))&&(a=!1),this.$el.find("#tvo-author-website").val()&&!ThriveOvation.util.validateURL(this.$el.find("#tvo-author-website"))&&(a=!1),ThriveOvation.util.validateInput(ThriveOvation.util.getTestimonialContent(this.$el),ThriveOvation.translations.testimonial_content_missing,!0)?this.$el.find(".tvo-testimonial-content").removeClass("tvo-tiny-mce-error"):(a=!1,this.$el.find(".tvo-testimonial-content").addClass("tvo-tiny-mce-error")),a},save:function(){TVE_Dash.showLoader();var a=this,b={title:this.$el.find("#tvo-title").val(),name:this.$el.find("#tvo-author-name").val(),email:this.$el.find("#tvo-author-email").val(),role:this.$el.find("#tvo-author-role").val(),website_url:this.$el.find("#tvo-author-website").val(),content:ThriveOvation.util.getTestimonialContent(this.$el),tags:this.$el.find("#tvo-author-new-tag-modal").val(),picture_url:1==this.$el.find("input[name='tvo-is-placeholder']").val()?"":this.$el.find(".tvo-testimonial-author-image img").attr("src"),source:ThriveOvation["const"].source.plugin},c=this.$el.find(".tvo-save-new-testimonial");if(this.validateModel()){if(c.hasClass("tvd-disabled"))return;ThriveOvation.util.setLoading(c),this.model.save(b).done(function(b){TVE_Dash.success(b.message);var c=new ThriveOvation.models.Testimonial(b),d=new ThriveOvation.views.TestimonialsItem({model:c}),e=d.render().$el;ThriveOvation.util.decrementIncrementListCounters(c,1),ThriveOvation.objects.Testimonials.push(c),ThriveOvation.objects.TestimonialsList.$el.prepend(e);var f=new ThriveOvation.views.TestimonialPagination({collection:ThriveOvation.objects.Testimonials,view:ThriveOvation.objects.TestimonialsList,el:jQuery(".tvo-top-pagination"),type:"static"});f.changePage(),jQuery("body").trigger("filterReset"),a.close()}).error(function(a){a=JSON.parse(a.responseText),TVE_Dash.err(a.message+": "+a.code)}).always(function(){ThriveOvation.util.removeLoading(c),TVE_Dash.hideLoader()})}else TVE_Dash.hideLoader();return!0},openUploadImage:function(){if(a)return void a.open();var a=wp.media({title:ThriveOvation.translations.choose_testimonial_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),b=this;a.on("select",function(){var c=a.state().get("selection").first().toJSON();b.$el.find("input[name='tvo-is-placeholder']").val(0),b.$el.find(".tvo-testimonial-author-image img").attr("src",c.url),b.$el.find("#tvo-upload-testimonial-image").hide(),b.$el.find(".tvo-image-uploaded").show()}),a.open()},removeImage:function(){var a=this.$el.find("#tvo-remove-testimonial-image").attr("data-default");this.$el.find(".tvo-testimonial-author-image img").attr("src",a),this.$el.find("#tvo-upload-testimonial-image").show(),this.$el.find(".tvo-image-uploaded").hide()},beforeClose:function(){ThriveOvation.util.clearMCEEditor()}}),ThriveOvation.views.Testimonial=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/testimonial"),events:{"click .tvo-update-testimonial":"updateTestimonial","change #tvo-testimonial-status-change":"updateTestimonialStatus","click .tvo-upload-testimonial-image":"openUploadImage","click #tvo-remove-testimonial-image":"removeImage","click .tvo-send-approval-email":"openEmailModal","keydown .tvo-testimonial-input":"enterPress","keyup .tvo-testimonial-input":"updateTestimonialModel","click .tvo-open-testimonial-webpage":function(){if(ThriveOvation.util.validateInput(this.$el.find("#tvo-author-website"))&&ThriveOvation.util.validateURL(this.$el.find("#tvo-author-website"))){var a=this.$el.find("#tvo-author-website").val();"http"!==a.substring(0,4)&&(a="//"+a),window.open(a,"_blank")}},"click .tvo-open-testimonial-email":function(){window.location.href="mailto:"+this.$el.find("#tvo-author-email").val()}},className:"tvd-testimonial-page",tagName:"div",initialize:function(){return this.listenTo(this.model,"sync",this.render),ThriveOvation.objects.EmailConfig=new ThriveOvation.models.EmailConfig,this},render:function(){this.$el.html(this.template({testimonial:this.model})),this.renderTestimonialEditor(),this.renderAcivitylog();var a=this.model.get("tags");return TVE_Dash.materialize(this.$el),this.renderTags(a),this},renderAcivitylog:function(){var a=this.model.get("activityLog");ThriveOvation.objects.ActivityLogEntriesCollection=new ThriveOvation.collections.ActivityLog(a),ThriveOvation.objects.ActivityLogViews instanceof ThriveOvation.views.ActivityLogView&&ThriveOvation.objects.ActivityLogViews.undelegateEvents(),ThriveOvation.objects.ActivityLogViews=new ThriveOvation.views.ActivityLogView({collection:ThriveOvation.objects.ActivityLogEntriesCollection,el:this.$el.find("#tvo-activity-log-entries")}),ThriveOvation.objects.Testimonial.set("activityLogCount",parseInt(this.model.get("activityLogCount"))),ThriveOvation.objects.ActivityLogViews.render()},renderSelectTags:function(){var a=this,b=this.$el.find("#tvo-author-new-tag-"+this.model.get("id"));b.select2({tags:!0,multiple:!0,placeholder:ThriveOvation.translations.tags_select2_placeholder}).on("select2:select",function(b){ThriveOvation.util.addNewTagInTheSystem(b.params.data,a)}).on("select2:unselect",function(a){a.params.originalEvent&&a.params.originalEvent.stopPropagation()})},enterPress:function(a){13!=a.which&&13!=a.keyCode||this.updateTestimonial()},renderTags:function(a){var b=this,c="";ThriveOvation.availableTags.forEach(function(d){c=ThriveOvation.util.containsObject(d,a)?'selected="selected"':"";var e='<option value="'+d.id+'" '+c+">"+d.text+"</option>";b.$el.find("#tvo-author-new-tag-"+b.model.get("id")).append(e)}),this.renderSelectTags()},renderTestimonialEditor:function(){var b=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-testimonial-content-tinymce");b&&(tinyMCEPreInit.mceInit=a.extend(tinyMCEPreInit.mceInit,b.mce_init),tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"].setup=function(a){a.on("change",function(){a.save()})},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-testimonial-content-tinymce"]),window.wpActiveEditor="tvo-testimonial-content-tinymce",tinyMCE.get("tvo-testimonial-content-tinymce").setContent(this.model.get("content")))},validateModel:function(){var a=!0,b=this.$el.find("#tvo-author-email");return ThriveOvation.util.validateInput(this.$el.find("#tvo-author-name"),ThriveOvation.translations.isRequired)||(a=!1),"twitter"!==this.model.get("media_source")&&"facebook"!==this.model.get("media_source")&&""!=b.val()&&(ThriveOvation.util.validateEmail(b)||(a=!1)),this.$el.find("#tvo-author-website").val()&&!ThriveOvation.util.validateURL(this.$el.find("#tvo-author-website"))&&(a=!1),ThriveOvation.util.validateInput(ThriveOvation.util.getTestimonialContent(this.$el),ThriveOvation.translations.testimonial_content_missing,!0)?this.$el.find(".tvo-testimonial-content").removeClass("tvo-tiny-mce-error"):(a=!1,this.$el.find(".tvo-testimonial-content").addClass("tvo-tiny-mce-error")),a},updateTestimonialModel:function(a){var b=jQuery(a.currentTarget);ThriveOvation.util.setModelWithKeyValue(b,this.model)},updateTestimonial:function(){TVE_Dash.showLoader();var a=this;return this.model.set("tags",a.$el.find("#tvo-author-new-tag-"+a.model.get("id")).val()),this.model.set("content",ThriveOvation.util.getTestimonialContent(this.$el)),this.validateModel()?(ThriveOvation.util.clearMCEEditor(),this.model.save().done(function(b){a.model.set("tags",b.tags),a.model.set("activityLog",b.activityLog),a.model.set("activityLogCount",b.activityLogCount),a.renderAcivitylog(),TVE_Dash.success(ThriveOvation.translations.testimonial_successfully_saved)}).error(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader()})):TVE_Dash.hideLoader(),!0},updateTestimonialStatus:function(a){var b=jQuery(a.currentTarget),c=jQuery(b).val(),d=jQuery(b).attr("data-value"),e=this;if(c!=d){this.model.set({status:this.$el.find("#tvo-testimonial-status-change").val()});var f=new ThriveOvation.models.PostMeta({key:this.model.get("id"),meta_key:ThriveOvation["const"].meta_key.status,meta_value:this.$el.find("#tvo-testimonial-status-change").val()});f.save(null,{success:function(a,f){jQuery(b).attr("data-value",c).removeClass("tvo-testimonial-status-"+d).addClass("tvo-testimonial-status-"+c),TVE_Dash.success(ThriveOvation.translations.status_changed_success_toast),e.model.set("activityLog",f.activityLog),e.model.set("activityLogCount",f.activityLogCount),e.renderAcivitylog()},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.status_changed_fail_toast)}})}},openEmailModal:function(){this.modal(ThriveOvation.views.ConfigureEmailModal,{model:ThriveOvation.objects.EmailConfig,testimonial:ThriveOvation.objects.Testimonial,preview:!0})},openConfirmModal:function(){this.modal(ThriveOvation.views.ConfirmSendingEmailModal,{model:new ThriveOvation.models.ConfirmEmailSend})},sendApprovalEmail:function(){TVE_Dash.showLoader();var a=this.model.get("id"),b=this;jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.testimonials+"/email/approval",type:"POST",data:{testimonial:a}}).done(function(a){b.model.set("activityLog",a.activityLog),b.model.set("activityLogCount",a.activityLogCount),b.model.set("status",a.status),b.model.set("sent_emails",a.sent_emails),b.$el.find("#tvo-testimonial-status-change").val(a.status).trigger("change"),b.renderAcivitylog(),TVE_Dash.success(ThriveOvation.translations.confirmation_email_sent)}).error(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader()})},openUploadImage:function(){if(a)return void a.open();var a=wp.media({title:ThriveOvation.translations.choose_testimonial_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),b=this;a.on("select",function(){var c=a.state().get("selection").first().toJSON();b.model.set("picture_url",c.url),b.$el.find(".tvo-profile-picture").css("background-image","url("+c.url+")"),b.$el.find("#tvo-upload-testimonial-image").hide(),b.$el.find(".tvo-image-uploaded").show()}),a.open()},removeImage:function(){var a=this.$el.find("#tvo-remove-testimonial-image").attr("data-default");this.model.set("picture_url",a),this.$el.find(".tvo-profile-picture").css("background-image","url("+a+")"),this.$el.find("#tvo-upload-testimonial-image").show(),this.$el.find(".tvo-image-uploaded").hide()}}),ThriveOvation.views.Setting=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("settings"),events:{"click .tvo-save-settings":"saveSettings","click .tvo-add-new-connection":"openConnectionModal","click .tvo-configure-email-template":"openEmailConfigureModal","click .tvo-configure-landing-page":"openLandingPageConfigureModal","click .tvo-new-image":"selectDefaultImage","click .tvo-default-image":"setDefaultImage"},initialize:function(){this.listenTo(this.model,"sync",this.render)},init:function(){var a=this.model;jQuery(".tvo-setting-input-select").each(function(){var b=jQuery(this).data("key");jQuery(this).val(a.get(b))}),ThriveOvation.objects.EmailConfig=new ThriveOvation.models.EmailConfig},render:function(){return this.$el.html(this.template({settings:this.model})),ThriveOvation.util.bind_wistia(),this.init(),this.renderApiConnections(),TVE_Dash.materialize(this.$el),TVE_Dash.hideLoader(),this},renderApiConnections:function(){var a=new ThriveOvation.views.AssetConnections({collection:ThriveOvation.objects.AssetConnection,el:this.$el.find("#tvo-email-connection-wrap")});return a.render(),this},openConnectionModal:function(){TVE_Dash.modal(ThriveOvation.views.ConnectionModal,{"max-width":"35%",model:new ThriveOvation.models.NewConnection({connected_apis:ThriveOvation.objects.AssetConnection})})},openLandingPageConfigureModal:function(){this.modal(ThriveOvation.views.ConfigureLandingPageModal,{model:new ThriveOvation.models.LandingPageConfig,"max-width":"45%"})},openEmailConfigureModal:function(){this.modal(ThriveOvation.views.ConfigureEmailModal,{model:ThriveOvation.objects.EmailConfig})},saveSettings:function(a){var b=jQuery(a.currentTarget),c=this.model;b.hasClass("tvd-disabled")||(ThriveOvation.util.setLoading(b),jQuery(".tvo-setting-input-checkbox").each(function(){var a=jQuery(this),b=a.data("key"),d=Number(a[0].checked),e={};e[b]=d,c.set(e)}),c.save(null,{success:function(a,c){TVE_Dash.success(ThriveOvation.translations.settings_saved_success_toast),ThriveOvation.util.removeLoading(b)},error:function(a,c){TVE_Dash.err(ThriveOvation.translations.settings_saved_fail_toast),ThriveOvation.util.removeLoading(b)}}))},selectDefaultImage:function(){if(a)return void a.open();var a=wp.media({title:ThriveOvation.translations.choose_default_image,button:{text:ThriveOvation.translations.choose_testimonial_image_button},library:{type:"image"},multiple:!1,frame:"select"}),b=this;a.on("select",function(){var c=a.state().get("selection").first().toJSON();b.$el.find(".tvo-default-picture").css("background-image","url("+c.url+")"),b.$el.find(".tvo-default-image").attr("disabled",!1),b.saveDefaultImage(c.url)}),a.open()},setDefaultImage:function(a){var b=a.currentTarget.getAttribute("data-default");a.currentTarget.setAttribute("disabled",!0),this.$el.find(".tvo-default-picture").css("background-image","url("+b+")"),this.saveDefaultImage(b)},saveDefaultImage:function(a){a||(a=this.$el.find(".tvo-default-picture").css("background-image")),TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},type:"POST",url:ThriveOvation.routes.settings+"/default-placeholder",data:{image:a}}).done(function(){TVE_Dash.success(ThriveOvation.translations.success_image_set)}).fail(function(){TVE_Dash.error(ThriveOvation.translations.error_image_set)}).always(function(){TVE_Dash.hideLoader()})}}),ThriveOvation.views.ActivityLogEntryView=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("testimonials/activity/log/entry"),tagName:"li",className:"tvd-collection-item tvo-activity-log-entry",events:{},initialize:function(a){},render:function(){return this.$el.html(this.template({logEntry:this.model})),this}}),ThriveOvation.views.ActivityLogView=ThriveOvation.views.Base.extend({events:{"click .tvo-extend-activity-log":"extend"},initialize:function(){},renderOne:function(a){var b=new ThriveOvation.views.ActivityLogEntryView({model:a}),c=b.render().$el;this.$el.append(c)},render:function(a){this.$el.empty();var b=this.collection;return"undefined"!=typeof a&&(b=new ThriveOvation.collections.ActivityLog(a)),b.each(this.renderOne,this),this.removeExtension(),this.renderExtension(),this},removeExtension:function(){this.$el.find(".tvo-activity-log-extension").remove()},extend:function(){var b=this;TVE_Dash.showLoader(),a.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:b.collection.url()+ThriveOvation.objects.Testimonial.get("id")+"/"+b.collection.length,type:"GET"}).done(function(a){a.activity_log.length&&(b.removeExtension(),a.activity_log.forEach(function(a){var c=new ThriveOvation.models.ActivityLogEntry(a);b.collection.push(c),b.renderOne(c)}),b.renderExtension())}).error(function(){}).always(function(){TVE_Dash.hideLoader()})},renderExtension:function(){if(this.collection.length<ThriveOvation.objects.Testimonial.get("activityLogCount")){var a=TVE_Dash.tpl("testimonials/activity/log/extension");this.$el.append(a)}}}),ThriveOvation.views.Shortcodes=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("shortcodes/list"),type:"",events:{"click .tvo-add-new-shortcode":"new"},initialize:function(a){this.type=a.type},render:function(){return this.$el.html(this.template({type:this.type})),0===this.collection.length?this.$el.find(".tvo-shortcodes-notice").show():this.collection.each(this.renderShortcode,this),TVE_Dash.materialize(this.$el),this},renderShortcode:function(a){var b=new ThriveOvation.views.Shortcode({model:a});this.$el.find(".tvo-shortcodes-container .tvo-add-new-shortcode").before(b.render().$el)},"new":function(){this.modal(ThriveOvation.views.ModalNewShortcode,{model:new ThriveOvation.models.Shortcode,view:this})}}),ThriveOvation.views.Shortcode=ThriveOvation.views.Base.extend({className:"tvd-col tvd-s6 tvd-ms6 tvd-m4 tvd-l3 tvo-shortcode-item",template:TVE_Dash.tpl("shortcodes/shortcode"),events:{"click .tvo-edit-shortcode-title":"editTitle","click .tvo-shortcode-icon-delete":"deleteShortcode"},initialize:function(){this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:state",this.renderState),this.renderState()},renderState:function(){var a;if("delete"==this.model.get("state")){var b=new ThriveOvation.views.ShortcodeDeleteState({model:this.model});a=b.render().$el,this.$el.html(a)}else a=this.template({shortcode:this.model}),this.$el.html(a),this.$shortcodeName=this.$el.find(".tvo-shortcode-title"),ThriveOvation.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),TVE_Dash.materialize(this.$el);return this},deleteShortcode:function(){return this.model.set("state","delete"),this.renderState(),this},editTitle:function(){var a=this,b=(this.$el.find(".tvo-edit-shortcode-title"),new Backbone.Model({value:this.model.get("title"),label:ThriveOvation.translations.shortcode_name,required:!0}));b.on("change:value",function(){a.model.set("name",arguments[1]),a.model.save(),a.$shortcodeName.html(a.model.get("name")).show(),c.remove()}),b.on("tvo_no_change",function(){a.$shortcodeName.html(a.model.get("name")).show(),c.remove()});var c=new ThriveOvation.views.TextEdit({model:b,tagName:"div"});this.$shortcodeName.hide().after(c.render().$el),c.focus()}}),ThriveOvation.views.ShortcodeDeleteState=ThriveOvation.views.Base.extend({template:TVE_Dash.tpl("shortcodes/delete/shortcode"),events:{"click .tvo-delete-no":function(){this.model.set("state","normal")},"click .tvo-delete-yes":"yes",keydown:"keyAction"},initialize:function(){this.listenTo(this.collection,"remove",this.remove)},render:function(){this.$el.html(this.template({item:this.model}));var a=this;return _.defer(function(){a.$(".tvo-delete-shortcode-card").focus()}),this},keyAction:function(a){var b=a.which;13==b?this.yes():27==b&&this.model.set("state","normal")},yes:function(){TVE_Dash.cardLoader(this.$el),this.model.destroy({wait:!0,success:function(){TVE_Dash.hideLoader(),TVE_Dash.success(ThriveOvation.translations.delete_shortcode)},error:function(a,b){b=JSON.parse(b.responseText),TVE_Dash.err(b.message+": "+b.code),TVE_Dash.hideLoader()}})}}),ThriveOvation.views.ModalNewShortcode=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("shortcodes/shortcode/modal"),events:{"click .tvo-save-new-shortcode":"save","keydown #tvo-shortcode-name":"toSave"},afterRender:function(){return this.$el.html(this.template()),
this},validateModel:function(){return ThriveOvation.util.validateInput(this.$el.find("#tvo-shortcode-name"),ThriveOvation.translations.isRequired)},toSave:function(a){var b=a.keyCode||a.which;13==b&&this.save()},save:function(){if(this.validateModel()){var a=this,b={name:this.$el.find("#tvo-shortcode-name").val(),type:this.view.type};TVE_Dash.showLoader(),this.model.save(b,{success:function(b,c){b.set({url:c.url,id:c.id}),a.view.collection.add(b),a.view.collection.sort(),a.view.render(),a.close(),TVE_Dash.hideLoader()}})}return!0}}),ThriveOvation.views.TextEdit=ThriveOvation.views.Base.extend({className:"tvd-input-field tvo-inline-edit",template:TVE_Dash.tpl("textedit"),events:{"keyup input":"keyup","change input":function(b){return a.trim(this.input.val())?(this.model.set("value",this.input.val()),!1):(this.input.addClass("tvd-invalid"),!1)},"blur input":function(){this.model.trigger("tvo_no_change")}},keyup:function(a){27===a.which&&this.model.trigger("tvo_no_change")},render:function(){return this.$el.html(this.template({item:this.model})),this.input=this.$el.find("input"),this},focus:function(){this.input.focus().select()}}),ThriveOvation.views.AssetConnections=ThriveOvation.views.Base.extend({events:{"click .tvo-connection-setting-change":"saveConnection"},initialize:function(){this.listenTo(this.collection,"change",this.render)},render:function(){return this.$el.find("#tvo-email-api-connections").empty(),this.collection.each(this.renderOne,this),this},renderOne:function(a){var b=new ThriveOvation.views.AssetConnection({model:a,wrapper:this.$el}),c=b.render().$el;this.$el.find("#tvo-email-api-connections").append(c)},saveConnection:function(a){var b=jQuery(a.currentTarget).attr("data"),c=this;TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},type:"POST",url:ThriveOvation.routes.settings+"/api/activate",data:{connection:b}}).done(function(){c.collection.each(function(a,c){a.set("active",b)}),TVE_Dash.hideLoader()})}}),ThriveOvation.views.AssetConnection=ThriveOvation.views.Base.extend({tagName:"li",template:TVE_Dash.tpl("api/connections/connections"),events:{"click .tve-asset-group-test":"testConnection","click .tvo-connection-edit":"openEditModal"},initialize:function(a){_.extend(this,_.pick(a,"wrapper"))},render:function(){return this.model.get("connection")?(this.$el.html(this.template(this.model.toJSON())),this.wrapper.find(".tvo-no-email-connection-setup").hide(),this.wrapper.find("#tvo-add-new-connection-upper").show()):(this.wrapper.find(".tvo-no-email-connection-setup").show(),this.wrapper.find("#tvo-add-new-connection-upper").hide()),this},openEditModal:function(b){var c=a(b.currentTarget).attr("id").replace("tvo-delivery-","").replace("-edit","");this.modal(ThriveOvation.views.ConnectionModal,{model:new ThriveOvation.models.NewConnection({connected_apis:ThriveOvation.objects.AssetConnection}),edit:c})},testConnection:function(a){var b=jQuery(a.currentTarget).attr("data"),c=this.$el.find(".tvo-test-connection-"+b+" .tve-asset-group-test-result"),d=this.$el.find(".tvo-test-response");TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},type:"POST",url:ThriveOvation.routes.settings+"/api/testconnection",data:{connection:b}}).success(function(a){d.empty();var b=JSON.parse(a);d.prepend(b),c.empty(),b.indexOf("updated")>-1?c.append('<span class="tvd-text-green"><i class="tvd-icon-check"></i>Success</span>'):c.append('<span class="tvd-text-red"><i class="tvd-icon-remove"></i>Error</span>'),TVE_Dash.hideLoader()})}}),ThriveOvation.views.ConfigureLandingPageModal=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("email/configure-landing-page"),events:{"click .tvo-save-landing-page-settings":"save","change .tvo-change-landing-setting":"changeSettings"},getPostNameById:function(b,c){a("#tvu-leads-posts").val(""),a("#tvu-leads-posts-not").val("");var d=ThriveOvation.routes.settings+"/get_post_name_by_id";jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:d,type:"POST",data:{postId:b}}).done(function(b){"approve"==c&&(a("#tvu-leads-posts").val(b),a("#tvu-leads-posts").removeClass("ui-autocomplete-loading")),"not_approve"==c&&(a("#tvu-leads-posts-not").val(b),a("#tvu-leads-posts-not").removeClass("ui-autocomplete-loading"))}).error(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader()})},testimonialAutocomplete:function(b){var c=this,d=ThriveOvation.routes.settings+"/landing_testimonial_autocomplete";a(".tvu-leads-autocomplete").autocomplete({delay:50,select:function(a,b){c.model.set({approve_post_id:b.item.id}),c.model.set({approve_post_val:b.item.value})},source:function(b,c){a.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:d,dataType:"json",data:{q:b.term},type:"POST"}).done(function(a){c(a)}).error(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)})}}),a(".tvu-not-leads-autocomplete").autocomplete({delay:50,select:function(a,b){c.model.set({not_approve_post_id:b.item.id}),c.model.set({not_approve_post_val:b.item.value})},source:function(b,c){a.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:d,dataType:"json",data:{q:b.term},type:"POST"}).done(function(a){c(a)}).error(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)})}})},afterRender:function(){var b=this;console.log(this.model.get("approve")),this.model.fetch({success:function(c,d,e){c.get("approve")&&b.$el.find("#approve").val(c.get("approve")).trigger("change"),c.get("not_approve")&&b.$el.find("#not_approve").val(c.get("not_approve")).trigger("change"),"tvo_custom_url"==c.get("approve")&&b.$el.find("#approve_url").val(c.get("approve_url")),"tvo_existing_content"==c.get("not_approve")?b.$el.find("#not_approve_post_id").val(c.get("not_approve_post_id")).trigger("change"):"tvo_custom_url"==c.get("not_approve")&&b.$el.find("#not_approve_url").val(c.get("not_approve_url")),b.model.get("approve_post_val")&&a("#tvu-leads-posts").val(b.model.get("approve_post_val")),b.model.get("approve_post_val")&&a("#tvu-leads-posts-not").val(b.model.get("not_approve_post_val")),TVE_Dash.materialize(b.$el),b.testimonialAutocomplete(),b.getPostNameById(c.get("approve_post_id"),"approve"),b.getPostNameById(c.get("not_approve_post_id"),"not_approve")}})},changeSettings:function(a){var b=jQuery(a.currentTarget),c=b.attr("data-action"),d=b.val();this.$el.find("."+c).addClass("tvd-hide"),this.$el.find("."+c+"."+d).removeClass("tvd-hide"),this.$el.find("."+c+"_tvo_existing_content").val(null).trigger("change"),this.$el.find("."+c+"_tvo_custom_url").val(null).trigger("change")},save:function(a){var b=jQuery(a.currentTarget),c=this,d=this.$el.find("#approve").val(),e=this.$el.find("#approve_url").val(),f=this.model.get("approve_post_id"),g=this.model.get("approve_post_val"),h=this.$el.find("#not_approve").val(),i=this.$el.find("#not_approve_url").val(),j=this.model.get("not_approve_post_id"),k=this.model.get("not_approve_post_val");if(!b.hasClass("tvd-disabled")){if(ThriveOvation.util.setLoading(b),""==d||""==e&&""==f||""==h||""==i&&""==j)return TVE_Dash.err(ThriveOvation.translations.complete_all_the_fields),void ThriveOvation.util.removeLoading(b);if(""!=e&&!ThriveOvation.util.validateURL(this.$el.find("#approve_url"))||""!=i&&!ThriveOvation.util.validateURL(this.$el.find("#not_approve_url")))return TVE_Dash.err(ThriveOvation.translations.invalid_url),void ThriveOvation.util.removeLoading(b);var l={approve:d,approve_url:e,approve_post_id:f,approve_post_val:g,not_approve:h,not_approve_url:i,not_approve_post_id:j,not_approve_post_val:k};this.model.save(l,{success:function(a,b){TVE_Dash.success(ThriveOvation.translations.landing_settings_success_toast),jQuery(".tvo_icon_landing_page").addClass("tvo-settings-step-success"),jQuery(".tvo-configure-landing-page").text(ThriveOvation.translations.settings_step_completed),c.close()},error:function(a,b){TVE_Dash.err(ThriveOvation.translations.landing_settings_fail_toast)},complete:function(){ThriveOvation.util.removeLoading(b)}})}}}),ThriveOvation.views.ConfirmSendingEmailModal=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("email/confirm/send/email"),events:{"click .tvo-send-approval-email":"sendEmail"},afterRender:function(){this.$el.html(this.template({testimonial:this.model}))},sendEmail:function(){ThriveOvation.objects.TestimonialView.sendApprovalEmail(),this.close()}}),ThriveOvation.views.ConfigureEmailModal=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("email/configure/email"),events:{"click .tvo-save-email-template":"saveEmailTemplate","click .tvo-preview-email":"previewEmail","click .tvo-back-to-email-template":"configEmail","click .tvo-test-approval-email":"sendTestEmail","click .tvo-send-email":"checkIfAlreadySent","click .tl-toggle-tab-display":"toggleTabDisplay","keydown .tvo-email-test":"enterPressOnTest"},afterRender:function(){return this.$el.addClass("tve-assed-email-modal"),ThriveOvation.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),ThriveOvation.objects.EmailConfig.get("template")&&ThriveOvation.objects.EmailConfig.get("subject")&&(this.$el.find("#tvo-email-template").val(ThriveOvation.objects.EmailConfig.get("template")),this.$el.find("#tvo-email-subject").val(ThriveOvation.objects.EmailConfig.get("subject"))),this.renderTestimonialEditor(),this.preview&&(this.previewEmail(),this.$el.find(".tvo-settings-footer-buttons").hide(),this.$el.find(".tvo-preview-footer-buttons").show()),this},configEmail:function(){this.$el.find(".tvo-preview-email-content").hide(),this.$el.find(".tvo-config-email-content").show()},renderTestimonialEditor:function(){var b=ThriveOvation.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["tvo-tinymce-tpl"],qt:window.tinyMCEPreInit.qtInit["tvo-tinymce-tpl"]},"tvo-email-template");b&&(tinyMCEPreInit.mceInit=a.extend(tinyMCEPreInit.mceInit,b.mce_init),tinyMCEPreInit.mceInit["tvo-email-template"].setup=function(a){a.on("change",function(){a.save()})},tinyMCE.init(tinyMCEPreInit.mceInit["tvo-email-template"]),window.wpActiveEditor="tvo-email-template")},sendTestEmail:function(){if(ThriveOvation.util.validateInput(this.$el.find(".tvo-email-test"))&&ThriveOvation.util.validateEmail(this.$el.find(".tvo-email-test"))){var a=this.$el.find(".tvo-email-test").val();TVE_Dash.showLoader();var b=this.$el.find(".tvo-preview-email-text").html(),c=this.$el.find(".tvo-preview-email-subject").html();jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.settings+"/email/test",type:"POST",data:{template:b,subject:c,email:a}}).done(function(a){TVE_Dash.success(ThriveOvation.translations.confirmation_test_email_sent)}).error(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader()})}},checkIfAlreadySent:function(){parseInt(ThriveOvation.objects.Testimonial.get("sent_emails"))>0?(this.close(),ThriveOvation.objects.TestimonialView.openConfirmModal()):this.sendApprovalEmail()},sendApprovalEmail:function(){ThriveOvation.objects.TestimonialView.sendApprovalEmail(),this.close()},previewEmail:function(){var a=this;TVE_Dash.showLoader();var b={};this.preview&&(b.name=this.testimonial.get("name"),b.content=this.testimonial.get("content"));var c=tinyMCE.get("tvo-email-template").getContent(),d=this.$el.find("#tvo-email-subject").val();jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.settings+"/email/process",type:"POST",data:{template:c,subject:d,data:b}}).done(function(b){a.$el.find(".tvo-preview-email-text").html(b.template),a.$el.find(".tvo-preview-email-subject").html(b.subject),a.$el.find(".tvo-config-email-content").hide(),a.$el.find(".tvo-preview-email-content").show()}).error(function(a){TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader()})},saveEmailTemplate:function(){var a=ThriveOvation.util.hasTinymce()?tinyMCE.get("tvo-email-template").getContent():this.$el.find("#tvo-email-template").val(),b=this.$el.find(".tvo-email-subject").val(),c=this,d=this.model.get("template"),e=this.$el.find(".tvo-save-email-template");this.model.set({template:a,subject:b}),TVE_Dash.showLoader(),e.hasClass("tvd-disabled")||(ThriveOvation.util.setLoading(e),this.model.save().done(function(){jQuery(".tvo_icon_email_config").addClass("tvo-settings-step-success"),jQuery(".tvo-configure-email-template").text(ThriveOvation.translations.settings_step_completed),TVE_Dash.success(ThriveOvation.translations.settings_saved_success_toast),c.close()}).error(function(a){c.$el.find(".tvo-email-template").val(d),TVE_Dash.err(JSON.parse(a.responseText).message)}).always(function(){TVE_Dash.hideLoader(),ThriveOvation.util.removeLoading(e)}))},toggleTabDisplay:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed"),d=jQuery(b.data("target"));c?d.hide(0).removeClass("tvd-not-visible").slideDown(200):d.slideUp(200,function(){d.addClass("tvd-not-visible")}),b.toggleClass("collapsed"),b.toggleClass("hover")},enterPressOnTest:function(a){13!=a.which&&13!=a.keyCode||this.sendTestEmail()},beforeClose:function(){ThriveOvation.util.clearMCEEditor("tvo-testimonial-content-tinymce")}}),ThriveOvation.views.ConnectionModal=TVE_Dash.views.ModalSteps.extend({template:TVE_Dash.tpl("api/connections/add-api-connection"),events:{"click .tvd-modal-next-step":"next","click .tvd-modal-prev-step":"prev","click .tve-asset-delivery-conection":"openConnection","click .tve-leads-connection-edit":"openConnection","click .tvd-api-connect":"submitConnection","click .tvd-api-cancel":"closeConnection","click .tvo-asset-close":function(){this.close()}},onOpen:function(){ThriveOvation.objects.Apis.each(this.populateFields,this)},afterRender:function(){var a=this;if(ThriveOvation.objects.AssetConnection.forEach(function(b){var c=a.$el.find(".tvo-"+b.get("connection")+"-api");c.addClass("tvo-api-selected").next(".tvo-connection-name").addClass("tvo-connected-message").append('<span class="tvo-asset-connected">(connected)</span>');var d=b.get("connection_instance");for(var e in d)d[e]&&a.$el.find("#tvo-"+e+"-"+b.get("connection")).val(d[e])}),ThriveOvation.objects.Apis.each(this.renderSelector,this),this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this.edit){var b=this.$el.find(".tvo-connection-form[data-key="+this.edit+"]");b.find(".tvd-api-cancel").addClass("tvo-close-connection"),this.$el.find(".tvo-connection-form").hide(),b.show(),this.gotoStep(1)}return this},populateFields:function(a){var b=a.get("connection"),c=a.get("connection_instance"),d=this.$el.find(".tvo-connection-form[data-key="+b+"] form");c&&_.each(c,function(a,b){var c=d.find(':input[name="connection['+b+']"]');(c.is("input")||c.is("textarea")||c.is("select"))&&c.val(a)})},renderSelector:function(a){var b=new ThriveOvation.views.AssetSelector({model:a}),c=b.render().$el;this.$el.find("#tvo-connections-list").append(c)},openConnection:function(b){b.stopPropagation();var c=a(b.target),d=c.attr("data-key"),e=this.$el.find(".tvo-connection-form[data-key="+d+"]");this.$el.find(".tvo-connection-form").hide(),e.show(),this.gotoStep(1)},closeConnection:function(b){return a(b.target).hasClass("tvo-close-connection")?(a(b.target).removeClass("tvo-close-connection"),void this.close()):void this.gotoStep(0)},submitConnection:function(b){var c=this,d=(this.model,a(b.target).closest(".tvo-connection-form").find("form")),e=d.serializeArray(),f=this.mapProprieties(e),g=!1;_.each(f.connection_instance,function(a,b){g=ThriveOvation.util.validateInput(d.find(':input[name="connection['+b+']"]'))}),g&&(TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveOvation.nonce},url:ThriveOvation.routes.settings+"/api",type:"post",data:e}).done(function(b){if(TVE_Dash.hideLoader(),"true"===b){var d=new ThriveOvation.models.AssetWizardConnection;d.set(f);var e=ThriveOvation.objects.Apis.findWhere({connection:f.connection});e.get("connected")||(e.set({connected:!0}),ThriveOvation.objects.AssetConnection.add(d)),e.set({connection_instance:f.connection_instance}),ThriveOvation.objects.AssetConnection.find(function(a){return a.get("connection")===f.connection})||ThriveOvation.objects.AssetConnection.add(d),ThriveOvation.objects.AssetConnection.each(function(a,b){a.set("active",f.connection)});var g=new ThriveOvation.views.AssetConnections({collection:ThriveOvation.objects.AssetConnection,el:a("#tvo-email-connection-wrap")});g.render(),c.$el.find(".tvo-connection-name-success").text(f.connection),c.gotoStep(2)}else a(".tvo-delivery-connection").find(".error").remove(),TVE_Dash.err(JSON.parse(b),2e3)}))},mapProprieties:function(a){var b={connection:{},connection_instance:{}};return a.map(function(a){if("api"==a.name)b.connection=a.value;else{var c=a.name.match(/\[(.*?)\]/)[1];b.connection_instance[c]=a.value}}),b}}),ThriveOvation.views.AssetSelector=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("api/connections/selector"),className:"tvd-col tvd-s3 tvd-center-align",render:function(){return this.$el.html(this.template({item:this.model.toJSON()})),this}})})}(jQuery);var ThriveOvation=ThriveOvation||{};ThriveOvation.objects=ThriveOvation.objects||{},function(a){var b=Backbone.Router.extend({view:null,$el:a("#tvo-dashboard-wrapper"),routes:{testimonials:"testimonials",settings:"settings","testimonials(/:id)":"testimonial",socialimport:"social_media_import","shortcodes/(:type)":"short_codes"},params:{},initialize:function(){this.breadcrumbs=new ThriveOvation.views.Breadcrumbs({el:a(".tvo-breadcrumbs")})},route:function(a,b,c){var d=this;c||(c=this[b]);var e=function(){ThriveOvation.util.clearMCEEditor(),c.apply(d,arguments)};return Backbone.Router.prototype.route.call(this,a,b,e)},social_media_import:function(){this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"socialimport")),this.view&&this.view.remove(),this.view=new ThriveOvation.views.SocialMediaImport,this.$el.html(this.view.render().$el)},testimonials:function(){TVE_Dash.showLoader(),this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"testimonials")),this.view&&this.view.remove(),this.view=new ThriveOvation.views.Testimonials,this.$el.html(this.view.$el)},testimonial:function(a){this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"testimonial")),this.view&&(this.view.remove(),jQuery(".tvd-material-tooltip").hide()),ThriveOvation.objects.Testimonial=new ThriveOvation.models.Testimonial({id:a}),ThriveOvation.objects.Testimonial.fetch(),ThriveOvation.objects.TestimonialView=new ThriveOvation.views.Testimonial({model:ThriveOvation.objects.Testimonial}),this.$el.html(ThriveOvation.objects.TestimonialView.$el)},short_codes:function(a){if("capture"!==a&&"display"!==a)return void this.testimonials();this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,a+"-shortcodes")),this.view&&this.view.remove(),ThriveOvation.objects.Shortcodes=new ThriveOvation.collections.Shortcodes;var b=new ThriveOvation.views.Shortcodes({type:a,collection:ThriveOvation.objects.Shortcodes});ThriveOvation.objects.Shortcodes.fetch({data:{type:a},success:function(){b.render(),ThriveOvation.util.bind_wistia()}}),this.$el.html(b.$el)},settings:function(){TVE_Dash.showLoader(),this.breadcrumbs.render(ThriveOvation.util.Breadcrumbs(ThriveOvation.breadcrumbs,"settings")),this.view&&this.view.remove(),ThriveOvation.objects.Settings=new ThriveOvation.models.Settings,ThriveOvation.objects.Settings.fetch(),this.view=new ThriveOvation.views.Setting({model:ThriveOvation.objects.Settings}),this.$el.html(this.view.$el)}});a(function(){ThriveOvation.router=new b,Backbone.history.start({hashchange:!0}),Backbone.history.fragment||ThriveOvation.router.navigate("#testimonials",{trigger:!0})})}(jQuery);