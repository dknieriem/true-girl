/*! Thrive Content Builder - 2017-02-15
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};!function(a){function b(b,c){function d(){var f=!0;a.each(c,function(a,b){return e[b]()?void 0:(setTimeout(d,100),f=!1,!1)}),f&&b.call()}a.ajaxSetup({cache:!0}),"undefined"==typeof c?c=["fb","google","twitter","linkedin","pinterest","xing"]:"string"==typeof c&&(c=[c]);var e={fb:function(){return window.FB},google:function(){return window.gapi},twitter:function(){return window.twttr},linkedin:function(){return window.IN&&window.IN.parse},pinterest:function(){return window.parsePins},xing:function(){return!0}},f={fb:function(){window.FB||a.getScript("//connect.facebook.com/en_US/sdk.js",function(){FB.init({appId:"",xfbml:!1,version:"v2.3"})})},google:function(){window.gapi||(window.___gcfg={parsetags:"explicit"},a.getScript("//apis.google.com/js/platform.js"))},twitter:function(){window.twttr||a.getScript("https://platform.twitter.com/widgets.js")},linkedin:function(){window.IN||a.getScript("https://platform.linkedin.com/in.js")},pinterest:function(){!function(){if(window.PinIt=window.PinIt||{loaded:!1},!window.PinIt.loaded){window.PinIt.loaded=!0;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://assets.pinterest.com/js/pinit.js",a["data-pin-build"]="parsePins";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}}()},xing:function(){a.getScript("https://www.xing-share.com/plugins/share.js")}};a.each(c,function(a,b){f[b].call()}),d()}function c(a){FB.XFBML.parse(a.find(".tve_s_fb_share")[0]),FB.XFBML.parse(a.find(".tve_s_fb_like")[0]),gapi.plus.go(a.find(".tve_s_g_share")[0]),gapi.plusone.go(a.find(".tve_s_g_plus")[0]),setTimeout(function(){twttr.widgets.load(a.find(".tve_s_t_share")[0]),twttr.widgets.load(a.find(".tve_s_t_follow")[0])}),IN.parse(a.find(".tve_s_in_share")[0]);try{window.parsePins(a.find(".tve_s_pin_share")[0])}catch(b){console.log(b)}}var d,e=function(){};b(e,"fb"),TVE_Content_Builder.social={onMenuShow:function(a,b){var c=TVE_Content_Builder.$social.getConfig(),d=TVE_Content_Builder.$social.$el;if(c.global&&c.global.counts&&(a.find("#tve-share-show-counts").prop("checked",!0),c.global.min_shares&&a.find("#tve-share-min-shares").val(c.global.min_shares)),"default"==b&&tve_set_selected_dropdown(a.find("li#tve_social_"+(c.btn_type||"none"))),"custom"==b){var e=tve_handle_integer_or_float(d.find(".tve_social_items").css("font-size"));a.find(".tve_font_size").val(e),tve_set_selected_dropdown(a.find("li#tve_social_"+TVE_Content_Builder.$social.getSize())),tve_set_selected_dropdown(a.find("li#"+TVE_Content_Builder.$social.getType())),tve_set_selected_dropdown(a.find("li#"+TVE_Content_Builder.$social.getStyle()))}},syncValue:function(b,c,d){var e=b.data("update-selector"),f=a(e);e&&f.length&&f.val(b.val())},onDefaultInsert:function(a){TVE_Editor_Page.overlay(),b(function(){setTimeout(function(){c(a.find(".tve_social_items"))}),TVE_Editor_Page.overlay(!0)})},onDefaultDrop:function(a){a.tve_social_default().render()},openOptions:function(b,c){d=a("#tve_lightbox_content"),d.parent().find(".tve_lightbox_buttons").hide(),TVE_Editor_Page.overlay();var e=this,f={social_fb_app_id:tve_path_params.social_fb_app_id,ajax_load:"lb_social",action:"tve_ajax_load",config:TVE_Content_Builder.$social.getConfig(),element:c.attr("class")};tve_path_params.custom_post_data&&a.each(tve_path_params.custom_post_data,function(a,b){f[a]=b}),a.ajax({type:"post",xhrFields:{withCredentials:!0},url:tve_path_params.ajax_url,data:f}).done(function(a){load_lightbox_content(a,!1),show_lightbox(),TVE_Editor_Page.overlay(!0),d.find(".tve_scT li:visible").first().click(),d.find("#ts-url").trigger("keyup"),e.positionTabs()})},add_class:function(a,b){TVE_Content_Builder.$socialElement=b.find(".tve_social_custom");var c=a.attr("data-cls")?a.attr("data-cls"):a.attr("id");if(a.attr("data-layout")?TVE_Content_Builder.$socialElement.removeClass("tve_social_ib tve_social_itb tve_social_cb"):TVE_Content_Builder.$socialElement.removeClass("tve_style_1 tve_style_2 tve_style_3 tve_style_4 tve_style_5"),TVE_Content_Builder.$socialElement.addClass(c),a.attr("data-size")){var d=tve_handle_integer_or_float(b.find(".tve_social_items").css("font-size"));a.parents().find(".tve_font_size").val(d)}tve_set_selected_dropdown(a)},save:function(){var a=this.readLightboxConfig(),b=TVE_Content_Builder.$social.getValidationErrors(a);this.showErrors(b),b.length||(TVE_Content_Builder.$social.render(a),TVE_Content_Builder.controls.lb_close())},showErrors:function(b){var c=d.find(".tve_scT > ul > li").removeClass("tve_tab_err"),e=d.find("input,select,textarea").removeClass("tve_input_err");e.each(function(){a(this).next("span.tve_span_err").remove()}),b.length&&a.each(b,function(a,b){0===a&&c.filter(".tve_tab_"+b.tab).click(),c.filter(".tve_tab_"+b.tab).addClass("tve_tab_err");var e=d.find(".tve_tc_"+b.tab+' [name="'+b.field+'"]').addClass("tve_input_err").after('<span class="tve_span_err">'+b.message+"</span>");0===a&&e.first().focus()})},readLightboxConfig:function(){var b=TVE_Content_Builder.$social.getConfig();return b.selected=this.getSelected(),b.order&&b.order.length&&b.selected.sort(function(a,c){var d=b.order.indexOf(a),e=b.order.indexOf(c);return e>d||-1===d||-1===e?-1:d==e?0:1}),d.find(".social-config-text").each(function(){var c=a(this),d=c.parents(".tve_social_config_container"),e=d.attr("data-config");return b[e]||(b[e]={}),c.is('input[type="checkbox"]')?void(c.is(":checked")?b[e][c.attr("name")]=c.val():delete b[e][c.attr("name")]):(b[e][c.attr("name")]=c.val(),void(!b[e][c.attr("name")]&&c.attr("data-value-if-empty")&&(b[e][c.attr("name")]=c.attr("data-value-if-empty"))))}),a.each(b.selected,function(a,c){b[c].href&&"{tcb_post_url}"!==b[c].href?b[c].href=TVE_Content_Builder.link_compliant(b[c].href):b[c].href="{tcb_post_url}"}),b},getSelected:function(){var a=[];return d.find(".config-enabled:checked").each(function(){a.push(this.value)}),a},shareCount:function(b){var c=TVE_Content_Builder.$social.getConfig();if(b.is("input[type=checkbox]")){if(b.is(":checked")&&"custom"===c.type&&a.isArray(c.selected)&&1===c.selected.length&&"t_share"===c.selected[0])return tve_add_notification(tve_path_params.translations.TwitterShareCountDisabled,!0,8e3),void b.prop("checked",!1);var d=a("#tve-share-min-shares");d.prop("disabled",!b.is(":checked")),c.global=c.global||{},c.global.counts=b.is(":checked")?1:0}else{var e=parseInt(b.val());(isNaN(e)||0>e)&&(e=0),b.val(e),c.global=c.global||{},c.global.min_shares=e}TVE_Content_Builder.$social.setConfig(c),TVE_Content_Builder.$social.totalShareCount()},defaultButtonType:function(a){var b=TVE_Content_Builder.$social.getConfig();b.btn_type=a.attr("data-type"),TVE_Content_Builder.$social.render(b),tve_set_selected_dropdown(a)},configTabClick:function(a){var b=a.index();a.parents(".tve_scT").find(".tve_scTC").hide().eq(b).show(),a.addClass("tve_tS").siblings().removeClass("tve_scTS")},enabledChange:function(a){var b=d.find("#tve-social-custom-config");b.length&&(a.is(":checked")?(b.find("li.tve_tab_"+a.val()).show(),b.show()):(b.find("li.tve_tab_"+a.val()).hide(),b.find("li.tve_tc_"+a.val()).hide(),b.find(".tve_scT li:visible").length||b.hide()),b.find("li.tve_tS:visible").length||b.find(".tve_scT li:visible").first().click(),this.positionTabs())},positionTabs:function(){var a=d.find("#tve-social-custom-config");a.find(".tve_scTC").css("min-height",a.find(".tve_scT ul").outerHeight(!0)+20+"px")},toggleDisplay:function(b){a(b.attr("data-target")).toggle()},copyLink:function(a){var b=a.parent().find("input[name=href]").val();a.parents("#tve-lb-form").first().find("input[name=href]").val(b)},setupButtonsOverlay:function(b){var c=a('<div class="tve_s_overlay"></div>').css({width:"100%",height:"100%",position:"absolute",top:"0px",left:"0px",cursor:"move"});b.is(".tve_s_item")?b.css({position:"relative"}).append(c):b.find(".tve_s_item").css({position:"relative"}).append(c)},enableSortable:function(c,d,f){a(".edit_mode").removeClass("edit_mode"),d.find(".tve_social_items").addClass("edit_mode"),d.find(".tve_social_overlay").css("display","none"),hide_control_panel_menu(),TVE_Editor_Page.disable();var g=a("#tve_social_sort"),h=d.offset(),i=h.top,j=this;g.css({left:h.left+"px",width:d.outerWidth()});var k=jQuery("body").offset().top;isNaN(k)&&(k=0),a.when(g.show(0)).done(function(){g.css("top",i-k+d.outerHeight()+10+"px")}),this.setupButtonsOverlay(d),d.find(".tve_social_items").sortable({tolerance:"pointer",update:function(c,f){if("default"==TVE_Content_Builder.$social.type&&f.item.hasClass("tve_s_xing_share")){var g=a(TVE_Content_Builder.$social.getNetworkHtml("xing_share"));f.item.after(g),f.item.remove(),b(e,"xing"),j.setupButtonsOverlay(g),d.find(".tve_social_items").sortable("refresh")}}}),a("html,body").tve_css("overflow-x","visible","important")},saveSortable:function(b,c,d){var e=TVE_Content_Builder.$social.getConfig();e.order=[],c.find(".tve_s_item").each(function(){var b=a(this);e.order.push(b.attr("data-s"))}),e.order.length&&(e.selected=e.order),TVE_Content_Builder.$social.setConfig(e),this.closeSortable(null,c,null)},closeSortable:function(b,c,d){a("html,body").css("overflow-x",""),a("#tve_social_sort").hide(),c.removeClass("edit_mode"),c.find(".tve_s_overlay").remove(),c.sortable("destroy"),c.parents(".thrv_social").first().find(".tve_social_overlay").css("display","block"),a(TVE_Editor_Page).unbind("editor.onenable"),TVE_Editor_Page.CPANEL_OPEN=!1,TVE_Editor_Page.enable(),TVE_Content_Builder.$social.render()},openMedia:function(b){var c=b.parent().find("img.tve-s-custom-image"),d=a("body").addClass("mce_open");thrive_open_media(null,"load","simple_image",c,function(a){b.parent().find("input.tve-image-value").val(a.original_url),d.removeClass("mce_open"),a.url&&b.parent().find(".tve-s-remove-img").show()})},removeMedia:function(a){a.hide(),a.parent().find("img.tve-s-custom-image").attr("src","").hide(),a.parent().find("input.tve-image-value").val("")}},TVE_Content_Builder.networks={default_html:function(b){var c=this,d=a();return jQuery.each(b.selected,function(e,f){var g=a(tve_path_params.social_default_html[f]);g.wrap('<div class="tve_s_item tve_s_'+f+'" data-s="'+f+'"></div>'),b[f]=b[f]||{},c[f].setConfig(g,b),d=d.add(g.parent())}),d.wrapAll("<div></div>").parent().html()},custom_html:function(b){var c=this,d=a();return a.each(b.selected,function(e,f){var g=a("#tve-elem-social-custom").find(".tve_s_"+f).clone();c[f].decorateCustom&&c[f].decorateCustom(g,b),d=d.add(g)}),d},fb_share:{sdk:"fb",setConfig:function(a,b){"btn_count"==b.btn_type&&a.attr("data-layout","button_count"),a.attr("data-href","{tcb_post_url}"===b.fb_share.href?window.tve_path_params.post_url:b.fb_share.href)},customRequiresSDK:function(a){return!(a.fb_share&&"share"==a.fb_share.type)},validateAppID:function(b){function c(){d.find("[name=app_id]").val(f).prop("readonly",!0),d.find(".tve_fb_id_invalid").hide(),d.find(".tve_fb_id_valid").show()}function e(){TVE_Content_Builder.social.showErrors([{tab:b.parents(".tve_social_config_container").first().attr("data-config"),field:"app_id",message:tve_path_params.translations.ErrorValidatingID}])}var f=b.prop("disabled",!0).addClass("tve-disabled").siblings("input[name=app_id]").first().val();TVE_Content_Builder.social.showErrors([]),a.ajax({url:"https://graph.facebook.com/"+f,dataType:"json",xhrFields:{withCredentials:!1},crossDomain:!0}).done(function(a){a.id&&a.id==f?(tve_path_params.social_fb_app_id=f,c(),jQuery.post(tve_path_params.ajax_url,{action:"tve_ajax_update_option",option_name:"tve_social_fb_app_id",option_value:f,security:tve_path_params.tve_ajax_nonce})):e()}).error(function(){e()}).always(function(){b.removeClass("tve-disabled").prop("disabled",!1)})},changeAppID:function(a){a.siblings("input[name=app_id]").prop("readonly",!1).focus().select(),d.find(".tve_fb_id_invalid").show(),d.find(".tve_fb_id_valid").hide()},setup:{type:function(a){var b=a.attr("data-type");d.find("#fb-feed-options")["feed"===b?"show":"hide"](),a.addClass("tve_selected").siblings().removeClass("tve_selected"),d.find("#social-config-fb_share-type").val(b)}},validate_custom:function(a){return"feed"!=a.type||tve_path_params.social_fb_app_id?void 0:[{tab:"fb_share",message:tve_path_params.translations.PleaseSetCorrectAppID,field:"app_id"}]}},fb_like:{sdk:"fb",setConfig:function(a,b){"btn_count"==b.btn_type&&a.attr("data-layout","button_count"),a.attr("data-href","{tcb_post_url}"===b.fb_like.href?window.tve_path_params.post_url:b.fb_like.href)}},g_share:{sdk:"google",setConfig:function(a,b){"btn_count"==b.btn_type&&a.attr("data-annotation","bubble"),a.attr("data-href","{tcb_post_url}"===b.g_share.href?window.tve_path_params.post_url:b.g_share.href)}},g_plus:{sdk:"google",setConfig:function(a,b){"btn_count"==b.btn_type&&(a.attr("data-annotation","bubble"),a.parent().addClass("tve_s_g_plus_count")),a.attr("data-href","{tcb_post_url}"===b.g_plus.href?window.tve_path_params.post_url:b.g_plus.href)}},t_share:{sdk:"twitter",setConfig:function(a,b){"btn_count"==b.btn_type&&a.removeAttr("data-count"),a.attr("data-url","{tcb_post_url}"===b.t_share.href?window.tve_path_params.post_url:b.t_share.href)},setup:{tweetLength:function(){var b=140,c=d.find("#ts-via").val(),e=d.find("#ts-tweet").val(),f=d.find("#ts-url").val()||location.href;return b-=f.match(/^https/)?23:22,b-=e.length+1,b-=c?6+c.replace("@","").length:0,a("#tve-s-t-counter").css("color",0>=b?"red":"").find(".c-cnt").html(b),b}},validate:function(a){return this.setup.tweetLength()<0?[{tab:"t_share",message:tve_path_params.translations.TweetContainsTooManyCharacters,field:"tweet"}]:void 0}},t_follow:{sdk:"twitter",setConfig:function(a,b){"btn_count"==b.btn_type&&a.removeAttr("data-show-count"),b.t_follow.username&&a.attr("href","https://twitter.com/"+b.t_follow.username),b.t_follow.hide_username&&a.attr("data-show-screen-name","false")},validate_default:function(b){return b&&a.trim(b.username)?void(b.username="@"+b.username.replace(/@/g,"")):[{tab:"t_follow",message:tve_path_params.translations.UsernameRequired,field:"username"}]}},in_share:{sdk:"linkedin",setConfig:function(a,b){"btn_count"==b.btn_type&&a.attr("data-counter","right"),a.attr("data-url","{tcb_post_url}"===b.in_share.href?window.tve_path_params.post_url:b.in_share.href)}},pin_share:{sdk:"pinterest",setConfig:function(a,b){"btn_count"==b.btn_type&&(a.attr("data-pin-config","beside"),a.attr("data-pin-zero","true"),a.parent().addClass("tve_s_pin_share_count"));var c=encodeURIComponent("{tcb_post_url}"===b.pin_share.href?window.tve_path_params.post_url:b.pin_share.href),d=encodeURIComponent(b.pin_share.media?b.pin_share.media:""),e=encodeURIComponent(b.pin_share.description?b.pin_share.description:"");a.attr("href","//www.pinterest.com/pin/create/button/?url="+c+"&media="+d+"&description="+e)},decorateCustom:function(a,b){b.pin_share.label="Pin"}},xing_share:{sdk:"xing",setConfig:function(a,b){"btn_count"==b.btn_type&&a.attr("data-counter","right"),a.attr("data-url","{tcb_post_url}"===b.xing_share.href?window.tve_path_params.post_url:b.xing_share.href)}}},a.fn.tve_social=function(){var b=this.hasClass("thrv_social_default")?"default":"custom",c=this["tve_social_"+b]();return a.extend(c,{getValidationErrors:function(c){var d=[];return a.each(c.selected,function(e,f){var g=TVE_Content_Builder.networks[f];if(g&&(g["validate_"+b]||g.validate)){var h=g.validate?g.validate:g["validate_"+b],i=h.call(g,c[f]);a.isArray(i)&&(d=d.concat(i))}}),d}}),c.type=b,c},a.fn.tve_social_default=function(){var b=this,c=TVE_Editor_Page.thriveShrtcodeConfig(b.find(".thrive-shortcode-config"),"social_default");return{$el:b,getConfig:function(){return this.config||(this.config=c.get()),this.config},setConfig:function(a){this.config=a,c.save(a)},render:function(a){"undefined"==typeof a?a=this.getConfig():this.setConfig(a);var c=TVE_Content_Builder.networks.default_html(a),d=b.find(".tve_social_items");d.html(c),"default"==a.type&&TVE_Content_Builder.social.onDefaultInsert(d.parent())},getNetworkHtml:function(b){var c={};return a.extend(!0,c,this.config),c.selected=[b],TVE_Content_Builder.networks.default_html(c)},getRequiredSDKs:function(){var b=[];return a.each(this.getConfig().selected,function(a,c){b.push(TVE_Content_Builder.networks[c].sdk)}),b}}},a.fn.tve_social_custom=function(){var b=this,c=b.find(".tve_social_custom");return{$el:b,getConfig:function(){return this.config||this.readConfig(),this.config},setConfig:function(c){this.config=c,a.each(c.selected,function(d,e){if(c[e]){var f=b.find(".tve_s_"+e);a.each(c[e],function(a,b){b?f.attr("data-"+a,b):f.removeAttr("data-"+a)})}}),c.global=c.global||{},a.each(c.global,function(a,c){c?b.attr("data-"+a,c):b.removeAttr("data-"+a)})},readConfig:function(){this.config={type:"custom"},this.config.selected=[],this.config.order=[];var c=this;b.find(".tve_s_item").each(function(){var b=a(this),d=b.attr("data-s");c.config.selected.push(d),c.config.order.push(d),c.config[d]=a.extend({},b.data())}),this.config.global=a.extend({},b.data())},render:function(c){"undefined"==typeof c&&(c=this.getConfig()),b.find(".tve_social_items").empty().append(TVE_Content_Builder.networks.custom_html(c)),a.each(c.selected,function(a,d){"undefined"!=typeof c[d].label&&b.find(".tve_s_"+d+" .tve_s_text").html(c[d]&&c[d].label?c[d].label:"")}),this.setConfig(c),TCB_Front.getShareCounts(b,{post_id:tve_path_params.post_id})},getRequiredSDKs:function(){var b=[],c=this.getConfig();return a.each(c.selected,function(a,d){var e=TVE_Content_Builder.networks[d];e.customRequiresSDK&&e.customRequiresSDK(c)&&b.push(e.sdk)}),b},totalShareCount:function(){if(!this.config.global||!this.config.global.counts)return void b.find(".tve_s_share_count").remove();var c=b.find(".tve_s_share_count");c.length||(c=a("#tve-elem-social-custom .tve_s_share_count").clone().prependTo(b)),TCB_Front.getShareCounts(b,{post_id:tve_path_params.post_id})},getSize:function(){return c.hasClass("tve_social_small")?"small":c.hasClass("tve_social_medium")?"medium":c.hasClass("tve_social_big")?"big":void 0},getType:function(){return c.hasClass("tve_social_ib")?"tve_social_ib":c.hasClass("tve_social_cb")?"tve_social_cb":c.hasClass("tve_social_itb")?"tve_social_itb":void 0},getStyle:function(){for(var a=1;5>=a;a++)if(c.hasClass("tve_style_"+a))return"tve_style_"+a}}},a(TVE_Content_Builder).on("menu_show_social_default",function(b,c,d){TVE_Content_Builder.$social=a(c).tve_social(),TVE_Content_Builder.social.onMenuShow(d,"default")}),a(TVE_Content_Builder).on("menu_show_social_custom",function(b,c,d){TVE_Content_Builder.$social=a(c).tve_social(),TVE_Content_Builder.social.onMenuShow(d,"custom")})}(jQuery);