/*! Thrive Quiz Builder - 2017-02-15
* http://www.thrivethemes.com/
* Copyright (c) 2017 Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};TVE_Content_Builder.ext=TVE_Content_Builder.ext||{};var TQB_Editor=TQB_Editor||{};!function(a){a(function(){tqb_page_data.allow_tqb_advanced&&(a('[data-toggle="tooltip"]').tooltip(),TQB_Editor.popover(),TVE_Content_Builder.add_filter("element_remove",function(b){b.hasClass("tqb-social-share-badge-container")&&a(parent.document).find('li[data-elem="sc_tqb_social_share_badge_container"]').css("display","block")}),TVE_Content_Builder.add_filter("allow_drop",function(b,c){var d=c[0],e=c[1];return d.hasClass("tqb-social-share-badge-container")&&a(e.data("tt")[0].parentElement).closest(".tqb-dynamic-content-container").length?(tve_add_notification("Social share element can not be dropped inside dynamic content element!",2,5e3),!1):!0}),TVE_Content_Builder.add_filter("allow_remove",function(b,c){var d=c[0];return d.hasClass("tqb-dynamic-content-container")?(a("#tqb_delete_dynamic_content").click(),!1):!0}),TVE_Content_Builder.add_filter("element_drop",function(b){b.hasClass("tqb-dynamic-content-container")&&(b.removeClass("tve-dropped"),tqb_page_data.is_personality_type?TVE_Content_Builder.ext.tqb.state.generate_personality_child_variations():tve_open_lightbox(a(parent.document).find('li[data-elem="sc_tqb_dynamic_content"] a')),a(parent.document).find('li[data-elem="sc_tqb_dynamic_content"]').css("display","none"),TVE_Editor_Page.overlay("close")),b.hasClass("tqb-social-share-badge-container")&&(b.closest(".tqb-dynamic-content-container").length?(b.remove(),tve_add_notification("Social share element can not be dropped inside dynamic content element!",2,5e3)):(TVE_Content_Builder.ext.tqb.social_share_badge.change_template(),a(parent.document).find('li[data-elem="sc_tqb_social_share_badge_container"]').css("display","none")))}),TQB_Editor.click_first_state(),TQB_Editor.hover_numeric_range_preview(),a(TVE_Content_Builder).on("menu_show_social_share_badge_settings",function(b,c,d){TVE_Content_Builder.$social=a(c).tve_social(),TVE_Content_Builder.social.onMenuShow(d,"custom")}),a("#tve_lightbox_frame").on("lb-close",function(b,c){this.getElementsByClassName("tqb-social-share-badge-template-action").length>0&&0===a(".tqb-social-share-badge-container").html().length&&(a("#tqb-editor-replace").find(".tqb-social-share-badge-container").remove(),a(parent.document).find('li[data-elem="sc_tqb_social_share_badge_container"]').css("display","block")),this.getElementsByClassName("tqb-result-intervals-action").length>0&&(a("#tqb-editor-replace").find(".tqb-dynamic-content-container").attr("tqb-saved")||(a("#tqb-editor-replace").find(".tqb-dynamic-content-container").remove(),a(parent.document).find('li[data-elem="sc_tqb_dynamic_content"]').css("display","block")))})),TVE_Content_Builder.add_filter("validate_saved_content",function(b){if("splash"===tqb_page_data.variation_type||"optin"===tqb_page_data.variation_type){if(a(".tqb-shortcode-submit-action").length>0)return!0;if(a(".thrv_lead_generation form").length>0)return!0;var c=!1;if(a(".tve_evt_manager_listen").each(function(b){for(var d=a(this).attr("data-tcb-events"),e=ThriveGlobal.$j.parseJSON(d.replace("__TCB_EVENT_","").replace("_TNEVE_BCT__","")),f=0,g=e.length;g>f;f++)"thrive_quiz_next_step"===e[f].a&&(c=!0)}),c)return!0;var d=a("#tqb-leanmodal-element");return a("#tqb-leanmodal-action-button",d).html(tqb_page_data.L.missing_step_error_continue).focus(),a("#tqb-leanmodal-description-text",d).html(tqb_page_data.L.missing_step_error+' <a class="tqb-open-external-link" href="'+tqb_page_data.kb_next_step_article+'" target="_blank">'+tqb_page_data.L.missing_step_error_link+"</a>"),a("#tqb-leanmodal-title-text",d).html(tqb_page_data.L.missing_step_error_title),a(".tqb-open-external-link").on("click",function(a){a.stopPropagation()}),d.openModal(),!1}return!0}),TVE_Content_Builder.add_filter("menu_show",TQB_Editor.on_menu_show),tqb_page_data.has_content||(TQB_Editor.open_template_chooser(),TVE_Content_Builder.add_filter("main_ajax_callback",TQB_Editor.open_template_chooser)),TVE_Content_Builder.add_filter("tcb_media_selected",TQB_Editor.media_selected),a(TVE_Content_Builder).on("tve.tve_save_post",function(b){a(".thrv_lead_generation form").each(function(b,c){if(!a(c).hasClass("tqb-form")){a(c).addClass("tqb-form");var d=({page_id:tqb_page_data.page_id,variation_id:tqb_page_data.variation_id},'<input type="hidden" name="tqb-variation-page_id" class="tqb-hidden-form-info" value="'+tqb_page_data.page_id+'" >');d+='<input type="hidden" name="tqb-variation-variation_id" class="tqb-hidden-form-info" value="'+tqb_page_data.variation_id+'" >',d+='<input type="hidden" name="tqb-variation-user_unique" class="tqb-hidden-form-info tqb-hidden-user-unique" value="" >',a(c).prepend(d)}})})}),TQB_Editor.popover=function(){var b=a(".tqb-tcb-intervals-item");b.data("bs.popover")&&b.popover("destroy"),b.popover({}),b.on("click",function(a){b.not(this).popover("hide")})},TQB_Editor.popover_position=function(){var b=a(".tqb-tcb-intervals-item").position();a(".popover").css("top",b.top-150)},TQB_Editor.show_hide_popover=function(b){a('.tqb-tcb-intervals-item[data-id="'+b+'"]').popover("toggle")},TQB_Editor.click_first_state=function(){var b=a(".tqb-tcb-intervals-item");b.length&&(TVE_Content_Builder.ext.tqb.state.state_click(b.first()),TQB_Editor.show_hide_popover(b.first().attr("data-id")))},TQB_Editor.hover_numeric_range_preview=function(){a(".tqb-tcb-intervals-item").hover(function(){var b=a(this);b.hasClass("tqb-tcb-intervals-item-active")||a('.tqb-tcb-numeric-range-preview[data-id="'+b.attr("data-id")+'"]').css("visibility","visible")},function(){var b=a(this);b.hasClass("tqb-tcb-intervals-item-active")||a('.tqb-tcb-numeric-range-preview[data-id="'+b.attr("data-id")+'"]').css("visibility","hidden")})},TQB_Editor.on_menu_show=function(a){return a.hasClass("tve-tqb-page-type")?(load_control_panel_menu(a,"tqb_page"),!0):a.hasClass("tqb-social-share-badge-container")?(load_control_panel_menu(a,"social_share_badge_settings"),!0):!1},TQB_Editor.media_selected=function(a,b,c){switch(b){case"tqb_variation_bg":a.tqb_variation().bgImage(c)}},TQB_Editor.open_template_chooser=function(){TVE_Editor_Page.overlay(),TCB_Main.trigger("trigger_action","#tqb-tpl-chooser","click"),setTimeout(function(){a("#tve_lightbox_frame").find(".tve-lightbox-close").hide(),hide_sub_menu()},0)};var b={tpl_ajax:function(a,b,c){var d={type:"post",dataType:"json",url:tqb_page_data.ajaxurl};if("undefined"!=typeof c&&c||TVE_Editor_Page.overlay(),a.action=tqb_page_data.tpl_action,a.variation_id=a.variation_id||tqb_page_data.variation_id,a.page_id=tqb_page_data.page_id,a.security=tqb_page_data.security,a.tqb_key=!0,d.data=a,b)for(var e in b)d[e]=b[e];return jQuery.ajax(d,a)},state_ajax:function(a,b){var c={type:"post",dataType:"json",url:tqb_page_data.ajaxurl};if(TVE_Editor_Page.overlay(),a.action=tqb_page_data.state_action,a.variation_id=a.variation_id||tqb_page_data.variation_id,a.page_id=tqb_page_data.page_id,a.security=tqb_page_data.security,a.tqb_key=!0,c.data=a,b)for(var d in b)c[d]=b[d];return jQuery.ajax(c,a)},is_integer_number:function(b){return Math.floor(b)==b&&a.isNumeric(b)}};TVE_Content_Builder.ext.tqb={open_page_settings:function(b,c,d){hide_sub_menu();var e=a(".tve-tqb-page-type");d.target=e,d.currentTarget=e,tve_editor_init(d,e)},open_bg_media:function(a,b){thrive_open_media(null,"load","tqb_variation_bg",b)},template:{choose:function(c){var d=a("#tqb-tpl").find(".tve_cell_selected:visible");return d.length?tqb_page_data.has_content&&"1"===d.find(".multi_step").val()&&!confirm(tqb_page_data.L.confirm_multi_step)?!1:(b.tpl_ajax({custom:"choose",tpl:d.find(".lp_code").val()}).done(TVE_Content_Builder.ext.tqb.state.insertResponse),TVE_Content_Builder.controls.lb_close(),void a("#tve_lightbox_frame").find(".tve-lightbox-close").show()):(tve_add_notification(tqb_page_data.L.alert_choose_tpl,!0),!1)},reset:function(a){b.tpl_ajax({custom:"reset"}).done(TVE_Content_Builder.ext.tqb.state.insertResponse),TVE_Content_Builder.controls.lb_close()},save:function(c){var d=c.parent().find("input#tve_landing_page_name").val();return d?void b.tpl_ajax({custom:"save",name:c.parent().find("input#tve_landing_page_name").val()}).done(function(b){a("#tve_landing_page_msg").removeClass("tve_warning").addClass("tve_success").html(b.message),a("#tqb-saved-templates").html(b.list),TVE_Editor_Page.overlay("close")}):void tve_add_notification(tqb_page_data.L.tpl_name_required,!0,5e3)},get_saved:function(){a("#tqb-saved-templates").html('<p class="tqb-tpl-loading">'+tqb_page_data.L.fetching_saved_templates+"</p>");var c=a("#tqb-user-current-templates:checked").length;return b.tpl_ajax({custom:"get_saved",current_template:c},{dataType:"html"},!0).done(function(b){TVE_Editor_Page.overlay("close"),a("#tqb-saved-templates").html(b)}),!1},user_tab_clicked:function(){a("#tqb-saved-templates").find(".tqb-tpl-loading").length&&setTimeout(this.get_saved,150)},delete_saved:function(){var a=jQuery("#tqb-saved-templates").find(".tve_cell_selected:visible");return a.length?confirm(tqb_page_data.L.tpl_confirm_delete)?void b.tpl_ajax({custom:"delete",tpl:a.find(".lp_code").val()},{dataType:"html"}).done(function(a){jQuery("#tqb-saved-templates").html(a),TVE_Editor_Page.overlay("close"),tve_add_notification(tqb_page_data.L.template_deleted,!1,5e3)}):!1:(alert(tqb_page_data.L.alert_choose_tpl),!1)}},state:{lightbox_state_choose:function(c){var d=a(c),e=d.val(),f="",g=a("#tqb-intervals-preview"),h=parseInt(a("#tqb_result_intervals").attr("max"));if(!b.is_integer_number(e))return tve_add_notification("The input must be an integer number",2,5e3),void g.html("");if(e>h||1>e)return tve_add_notification("The input must be between 1 and "+h,2,5e3),void g.html("");f+='<div class="tqb-tcb-intervals-preview-row">';for(var i=0;e>i;i++)f+='<div class="tqb-tcb-intervals-preview-column"></div>';f+="</div>",f+='<div class="tqb-tcb-number-preview"><div class="tve_left">'+tqb_page_data.quiz_config.absolute_min_value+'</div><div class="tve_right">'+tqb_page_data.quiz_config.absolute_max_value+"</div></div>",g.html(f)},lightbox_save_states_number:function(c){var d=a("#tqb_result_intervals").val(),e=parseInt(a("#tqb_result_intervals").attr("max"));return b.is_integer_number(d)?d>e||0>d?void tve_add_notification("The input must be between 0 and "+e,2,5e3):void b.state_ajax({custom:"set_result_intervals",result_interval:d}).done(function(a){TVE_Content_Builder.ext.tqb.state.insertStateResponse(a),TQB_Editor.click_first_state()}):void tve_add_notification("The input must be an integer number",2,5e3)},lightbox_delete_all_states:function(c){b.state_ajax({custom:"delete_dynamic_content"}).done(function(b){a("#tqb-editor-replace").find(".tqb-dynamic-content-container").remove(),a("#tqb-form-states").html(""),a(parent.document).find('li[data-elem="sc_tqb_dynamic_content"]').css("display","block"),tve_path_params.custom_post_data.tqb_child_variation_id=null,tve_save_post("true")})},lightbox_copy_states_from_prev_page:function(a){b.state_ajax({custom:"copy_similar_dynamic_content"}).done(function(a){TVE_Content_Builder.ext.tqb.state.insertStateResponse(a),TQB_Editor.click_first_state()})},redirect:function(a){a.attr("data-href")&&(top.location.href=a.attr("data-href"))},update_intervals:function(){var c=a("#tqb-range-min").val(),d=a("#tqb-range-max").val(),e=parseInt(a("#tqb-prev-min").val()),f=parseInt(a("#tqb-next-max").val()),g=a("#tqb-child-id").val(),h=a("#tqb-child-prev-id").val(),i=a("#tqb-child-next-id").val();return b.is_integer_number(d)&&b.is_integer_number(c)?b.is_integer_number(e)||c==tqb_page_data.quiz_config.absolute_min_value?b.is_integer_number(f)||d==tqb_page_data.quiz_config.absolute_max_value?e+1>c?void tve_add_notification(tqb_page_data.L.min_value_limit+(e+1),2,5e3):d>f-1?void tve_add_notification(tqb_page_data.L.max_value_limit+(f-1),2,5e3):parseInt(d)<parseInt(c)?void tve_add_notification("ERROR: Max value can not be greater than min value",2):void(g?b.state_ajax({custom:"update",min:c,max:d,child_id:g,child_prev_id:h,child_next_id:i,quiz_min:tqb_page_data.quiz_config.absolute_min_value,quiz_max:tqb_page_data.quiz_config.absolute_max_value}).done(function(b){TVE_Content_Builder.ext.tqb.state.insertStateResponse(b),a('.tqb-tcb-intervals-item[data-id="'+g+'"]').trigger("click")}):tve_add_notification("Something is wrong! Please contact Thrive Support!")):void tve_add_notification(tqb_page_data.L.intervals_max_val_cannot_be_changed,2,5e3):void tve_add_notification(tqb_page_data.L.intervals_min_val_cannot_be_changed,2,5e3):void tve_add_notification("The input must be an integer number",2,5e3)},generate_personality_child_variations:function(){b.state_ajax({custom:"generate_personality_child_variations"}).done(function(a){TVE_Content_Builder.ext.tqb.state.insertStateResponse(a),TQB_Editor.click_first_state()})},state_click:function(c){tve_path_params.custom_post_data.tqb_child_variation_id=a(".tqb-tcb-intervals-item-active").attr("data-id");var d=a(".tqb-tcb-intervals-item");tve_save_post("true",function(){b.state_ajax({custom:"get_child_variation",child_variation:c.attr("data-id")}).done(function(b){d.removeClass("tqb-tcb-intervals-item-active"),c.addClass("tqb-tcb-intervals-item-active"),b&&(a(".tqb-dynamic-content-container").html(b.content),tve_path_params.custom_post_data.tqb_child_variation_id=b.id,TQB_Editor.popover_position()),TVE_Editor_Page.overlay("close")})})},state_split:function(){var c=a("#tqb-child-id").val();return b.is_integer_number(c)?void b.state_ajax({custom:"split",child_id:c}).done(function(b){TVE_Content_Builder.ext.tqb.state.insertStateResponse(b),a('.tqb-tcb-intervals-item[data-id="'+c+'"]').trigger("click")}):!1},state_equalize:function(){b.state_ajax({custom:"equalize"}).done(function(a){TVE_Content_Builder.ext.tqb.state.insertStateResponse(a),TQB_Editor.click_first_state()})},state_reset:function(){tve_open_lightbox(a(parent.document).find('li[data-elem="sc_tqb_dynamic_content"] a'))},import_content_lightbox:function(){tve_open_lightbox(a("#tqb_import_state_content"))},import_content:function(c){var d=c.attr("data-tqb-import-to"),e=a("#tqb-import-from").val();return b.is_integer_number(d)&&b.is_integer_number(e)?void b.state_ajax({custom:"import",import_to:d,import_from:e}).done(function(b){a(".tqb-dynamic-content-container").html(b),TQB_Editor.popover_position(),TVE_Content_Builder.controls.lb_close(),TVE_Editor_Page.overlay("close")}):!1},remove_state:function(c){var d=a("#tqb-child-id").val(),e=a("#tqb-child-prev-id").val(),f=a("#tqb-child-next-id").val(),g=f?f:e;return b.is_integer_number(d)?void b.state_ajax({custom:"remove",child_id:d,child_prev_id:e,child_next_id:f}).done(function(b){TVE_Content_Builder.ext.tqb.state.insertStateResponse(b),a('.tqb-tcb-intervals-item[data-id="'+g+'"]').trigger("click")}):!1},insertStateResponse:function(b){a("#tqb-editor-replace").find(".tqb-dynamic-content-container").attr("tqb-saved","true"),TVE_Content_Builder.controls.lb_close(),tqb_page_data=jQuery.extend(tqb_page_data,b.tqb_page_data,!0),b.state_bar&&a("#tqb-form-states").html(b.state_bar),TQB_Editor.popover(),TQB_Editor.hover_numeric_range_preview(),TVE_Editor_Page.overlay("close")},insertResponse:function(b){function c(){TVE_Content_Builder.controls.lb_close(),TVE_Editor_Page.initEditorActions();try{tve_init_sliders()}catch(a){console.log(a)}setTimeout(function(){TVE_Editor_Page.overlay("close")},1)}function d(a,b){var c=!0;window.tqb_loaded_count=window.tqb_loaded_count||1,window.tqb_loaded_count++,a.each(function(){try{if(!this[e]||!this[e][f]||!this[e][f].length)return c=!1,!1}catch(a){return c=!1,!1}}),c||window.tqb_loaded_count>40?b():setTimeout(function(){d(a,b)},500)}if(!b||b.error)return tve_add_notification("Something went wrong"+(b&&b.error?": "+b.error:""),!0),void setTimeout(function(){TVE_Editor_Page.overlay("close")},1);var e,f,g=document.createElement("link");if("sheet"in g?(e="sheet",f="cssRules"):(e="styleSheet",f="rules"),a(".tve_custom_style,.tve_user_custom_style").remove(),TVE_Content_Builder.CSS_Rule_Cache.clear(),b.custom_css.length&&a("head").append(b.custom_css),b.css.thrive_events||a("#thrive_events-css,#tve_lightbox_post-css").remove(),tqb_page_data=jQuery.extend(tqb_page_data,b.tqb_page_data,!0),a("#tqb-editor-replace").replaceWith(a(b.main_page_content)),tqb_page_data.allow_tqb_advanced)top.location.reload();else{var h=!1,i=a();jQuery.each(b.css,function(b,c){if(!a("link#"+b+"-css").length){h=!0;var d=a("<link />",{rel:"stylesheet",type:"text/css",id:b+"-css",href:c}).appendTo("head");-1===c.indexOf("fonts.googleapis")&&(i=i.add(d))}}),h?d(i,c):c(),TVE_Editor_Page.overlay("close")}}},social_share_badge:{choose_template:function(){var c=a("#tqb-social-share-badge-tpl").find(".tve_cell_selected:visible");if(!c.length)return tve_add_notification(tqb_page_data.L.alert_choose_tpl,!0),!1;TVE_Editor_Page.overlay();var d=c.find(".tqb-social-share-badge-file").val();b.state_ajax({custom:"get_social_share_badge_template",template:d}).done(function(b){a(".tqb-social-share-badge-container").html(b);var c=a("#tqb-editor-replace .tqb-social-share-badge-container").find(".tve_social_items");c.attr("data-value",d),TVE_Content_Builder.controls.lb_close(),TVE_Editor_Page.overlay("close")})},change_template:function(){tve_path_params.custom_post_data.tqb_social_sharing_badge_template=a("#tqb-editor-replace .tqb-social-share-badge-container").find(".tve_social_items").attr("data-value"),tve_open_lightbox(a("#tqb_social_share_badge_template"))},menu_clear_font_size:function(a,b){b.find(".tve_social_items").css("font-size","");var c=tve_handle_integer_or_float(b.find(".tve_social_custom").css("font-size"));a.parents(".tve_menu").first().find(".tve_font_size").val(c)},menu_font_size:function(a,b){var c=tve_handle_integer_or_float(a.val());b.find(".tve_social_items").css("font-size",c+"px")}},custom_buttons:{add_result_shortcode:function(b){b.attr("data-shortcode")&&a(".edit_mode").append(" "+b.attr("data-shortcode"))},lean_modal_trigger:function(b){var c=a("#tqb-leanmodal-element");a("#tqb-leanmodal-action-button",c).attr("data-ctrl",b.attr("data-modal-action")).html(b.attr("data-modal-button-text")).focus(),b.attr("data-modal-text")&&a("#tqb-leanmodal-description-text",c).html(b.attr("data-modal-text")),b.attr("data-modal-title")&&a("#tqb-leanmodal-title-text",c).html(b.attr("data-modal-title")),c.is(":visible")||c.openModal()}}},a.fn.tqb_variation=function(){var a=this;return{bgPattern:function(b){this.clearBgImage().clearBgColor(),a.css({"background-image":"url('"+b.find("input[data-image]").attr("data-image")+"')","background-repeat":"repeat","background-position":""})},clearBgImage:function(){return a.css({"background-image":"none","background-repeat":"","background-size":"","background-position":""}),this},clearBgColor:function(){return a.tve_color_selector()&&tve_remove_css_rule(a.tve_color_selector(),"background-color"),a.css("background-color",""),this},bgImage:function(b){this.clearBgImage(),a.css({"background-image":"url('"+b.url+"')","background-repeat":"","background-size":"cover","background-position":"center center"})}}}}(jQuery);