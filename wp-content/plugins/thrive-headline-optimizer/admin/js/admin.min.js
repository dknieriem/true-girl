/*! Thrive Headline Optimizer - 2016-09-28
* http://www.thrivethemes.com/
* Copyright (c) 2016 Thrive Themes */
var ThriveHead=ThriveHead||{};ThriveHead.util=ThriveHead.util||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},function(a){ThriveHead.util.upperFirst=function(a){return a?a.toLowerCase().charAt(0).toUpperCase()+a.slice(1):""},ThriveHead.util.validateInput=function(a,b,c,d){var e=a.val(),f=!0;return(isNaN(e)||""==e)&&(d=ThriveHead.translations.isNaN,f=!1,a.removeClass("tvd-valid"),a.addClass("tvd-invalid")),b!==!1&&!isNaN(b)&&f&&b>=e&&(a.removeClass("tvd-valid"),a.addClass("tvd-invalid"),f=!1),c!==!1&&!isNaN(c)&&f&&e>c&&(a.removeClass("tvd-valid"),a.addClass("tvd-invalid"),f=!1),d&&d.length>0&&f===!1&&TVE_Dash.err(d,ThriveHead["const"].toast_timeout),f},ThriveHead.util.setLoading=function(a){a.addClass("tvd-disabled"),a.prepend('<i style="font-size: 14px;" class="tvd-icon-spinner mdi-pulse">&nbsp;</i>')},a.fn.serializeObject=function(){var b={},c=this.serializeArray();return a.each(c,function(){void 0!==b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""}),b},ThriveHead.util.removeLoading=function(a){a.removeClass("tvd-disabled"),a.find(".tvd-icon-spinner").remove()},ThriveHead.util.setElementValid=function(a){a.removeClass(" tvd-invalid "),a.addClass(" tvd-valid ")},ThriveHead.util.setElementInvalid=function(a){a.removeClass(" tvd-valid "),a.addClass(" tvd-invalid ")},ThriveHead.util.Notification=function(a){Materialize.toast(a,ThriveHead["const"].toast_timeout)},ThriveHead.util.Breadcrumbs=function(a,b,c){for(var d in a){var e={title:a[d].title,url:a[d].url},f=[];if(a[d].key==b)return e.url+="undefined"==typeof c?"":"/"+c,[e];if(f=ThriveHead.util.Breadcrumbs(a[d].kids,b,c),f.length>0)return f.unshift(e),f}return"undefined"==typeof f?[]:f},ThriveHead.util.addslashes=function(a){return(a+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},ThriveHead.util.minmax=function(a,b,c){return parseInt(a)<b||isNaN(a)?!1:parseInt(a)>c?!1:a}}(jQuery);var ThriveHead=ThriveHead||{};ThriveHead.models=ThriveHead.models||{},ThriveHead.collections=ThriveHead.collections||{},function(a){Backbone.emulateHTTP=!0,ThriveHead.models.Base=Backbone.Model.extend({idAttribute:"id",sync:function(a,b,c){var d;return c=c||{},c.cache=!1,_.isUndefined(ThriveHead.nonce)||_.isNull(ThriveHead.nonce)||(d=c.beforeSend,c.beforeSend=function(a){return a.setRequestHeader("X-WP-Nonce",ThriveHead.nonce),d?d.apply(this,arguments):void 0}),Backbone.sync(a,b,c)}}),ThriveHead.collections.Base=Backbone.Collection.extend({sync:function(a,b,c){var d;return c=c||{},c.cache=!1,c.url=this.url(),_.isUndefined(ThriveHead.nonce)||_.isNull(ThriveHead.nonce)||(d=c.beforeSend,c.beforeSend=function(a){return a.setRequestHeader("X-WP-Nonce",ThriveHead.nonce),d?d.apply(this,arguments):void 0}),Backbone.sync(a,b,c)}}),ThriveHead.models.Test=ThriveHead.models.Base.extend({defaults:{id:0,post_id:0,data_started:"",data_completed:"",chance_to_beat_original:0,click_through:0,enable_automatic_winner:0,minimum_engagements:0,scrolling_signal:0,scrolling_signal_value:0,time_on_content_signal:0,time_on_content_signal_value:0,status:""},urlRoot:ThriveHead.routes.tests,url:function(){var a=this.urlRoot;return this.get("id")&&(a+="/"+this.get("id")),a}}),ThriveHead.models.Variation=ThriveHead.models.Base.extend({defaults:{id:0,test_id:0,variation_title:"",is_control:0,is_winner:0,views:0,engagements:0,active:1,stopped_date:null},urlRoot:ThriveHead.routes.variation,url:function(){var a=this.urlRoot;return this.get("id")&&(a+="/"+this.get("id")),a}}),ThriveHead.collections.Tests=ThriveHead.collections.Base.extend({model:ThriveHead.models.Base,comparator:function(a){return-a.get("id")}}),ThriveHead.models.Settings=ThriveHead.models.Base.extend({defaults:{click_through:1,scrolling_signal:1,scrolling_signal_value:"30",time_on_content_signal:1,time_on_content_signal_value:"78",enable_automatic_winner:1,minimum_engagements:"200",minimum_duration:"14",chance_to_beat_original:"97.5",use_default_engagement_settings:1},url:ThriveHead.routes.settings}),ThriveHead.models.TestPostItem=ThriveHead.models.Base.extend({defaults:{id:"",title:"",variations:[],test_criteria:{}}}),ThriveHead.collections.TestPosts=ThriveHead.collections.Base.extend({model:ThriveHead.models.TestPostItem,url:function(){return ThriveHead.routes.tests},comparator:function(a){return-a.get("id")}}),ThriveHead.collections.Posts=ThriveHead.collections.Base.extend({model:ThriveHead.models.TestPostItem,url:function(){return ThriveHead.routes.posts},comparator:function(a){return-a.get("id")},parse:function(a){return this.total_count=a.total_count,a.items}}),ThriveHead.models.TestChart=ThriveHead.models.Base.extend({defaults:{id:"",title:"",data:[],x_axis:"",y_axis:""},url:function(){return ThriveHead.routes.tests+"/"+this.get("id")+"?onlyChart=1"}})}(jQuery);var ThriveHead=ThriveHead||{};ThriveHead.models=ThriveHead.models||{},ThriveHead.collections=ThriveHead.collections||{},ThriveHead.objects=ThriveHead.objects||{},function(){ThriveHead.models.EngagementRateReport=ThriveHead.models.Base.extend({defaults:function(){return{post_id:"0",date:"",rate:"0",name:"",post_type:""}}}),ThriveHead.collections.EngagementRateReport=ThriveHead.collections.Base.extend({urlBase:ThriveHead.routes.logs,model:ThriveHead.models.EngagementRateReport,url:function(){return this.urlBase+"/table"},parse:function(a){return this.total_count=a.total_count,a.items}}),ThriveHead.objects.EngagementRateReport=new ThriveHead.collections.EngagementRateReport,ThriveHead.models.CumulativeEngagementReport=ThriveHead.models.Base.extend({defaults:function(){return{post_id:"0",date:"",engagements:"0",engagement_type:"",name:"",post_type:""}}}),ThriveHead.collections.CumulativeEngagementReport=ThriveHead.collections.Base.extend({urlBase:ThriveHead.routes.logs,model:ThriveHead.models.CumulativeEngagementReport,url:function(){return this.urlBase+"/table"},parse:function(a){return this.total_count=a.total_count,a.items}}),ThriveHead.objects.CumulativeEngagementReport=new ThriveHead.collections.CumulativeEngagementReport,ThriveHead.models.EngagementReport=ThriveHead.models.Base.extend({defaults:function(){return{post_id:"0",date:"",engagements:"0",engagement_type:"",name:"",post_type:""}}}),ThriveHead.collections.EngagementReport=ThriveHead.collections.Base.extend({urlBase:ThriveHead.routes.logs,model:ThriveHead.models.EngagementReport,url:function(){return this.urlBase+"/table"},parse:function(a){return this.total_count=a.total_count,a.items}}),ThriveHead.objects.EngagementReport=new ThriveHead.collections.EngagementReport,ThriveHead.models.PageTitle=Backbone.Model.extend({defaults:function(){return{parts:[],separator:" â€¹ ",default_title:""}},initialize:function(){this.set("parts",this.get("default_title").split(this.get("separator")))},prepend:function(a,b,c){"undefined"!=typeof b&&b&&this.get("parts").length>1&&this.get("parts").shift(),"undefined"!=typeof c&&c&&this.set("parts",this.get("default_title").split(this.get("separator"))),this.get("parts").unshift(a),this.trigger("title_change",this.getTitle())},replaceFirst:function(a){return this.prepend(a,!0)},getTitle:function(){return this.get("parts").join(this.get("separator"))}})}();var ThriveHead=ThriveHead||{};ThriveHead.views=ThriveHead.views||{},ThriveHead.objects=ThriveHead.objects||{},ThriveHead.notifications=ThriveHead.notifications||{},function(a){a(function(){ThriveHead.objects.SettingModel||(ThriveHead.objects.SettingModel=new ThriveHead.models.Settings,ThriveHead.objects.SettingModel.fetch()),jQuery("body").on("click",".tho-toggle-display",function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");jQuery(b.data("target"))[c?"slideDown":"slideUp"](200),b.toggleClass("collapsed"),b.toggleClass("hover")}),jQuery("body").on("click",".tho-toggle-settings",function(a){TVE_Dash.modal(ThriveHead.views.modals.ViewSettings,{model:ThriveHead.objects.SettingModel,"max-width":"50%"})}),jQuery(document).keypress(function(a){13!=a.which&&13!=a.keyCode||(a.preventDefault(),jQuery(".tho-stop-test-variation-modal-action").is(":visible")&&jQuery(".tho-stop-test-variation-modal-action").focus().click())}),jQuery(document).on("click","a",function(a){var b,c=a.currentTarget.href;"undefined"!=typeof c&&-1!==c.indexOf("#")&&(b=c.split("#").pop(),-1!==ThriveHead.router.force_fetch_views.indexOf(b)&&(ThriveHead.router.force_fetch=!0))}),ThriveHead.views.Base=Backbone.View.extend({modal:function(a,b){return TVE_Dash.modal(a,b)}}),ThriveHead.views.Breadcrumbs=ThriveHead.views.Base.extend({render:function(a){var b=this;return this.$el.empty(),_.each(a,function(a){var c=new ThriveHead.views.BreadcrumbsItem;b.$el.append(c.render(a).el)}),this}}),ThriveHead.views.BreadcrumbsItem=ThriveHead.views.Base.extend({template:TVE_Dash.tpl("dashboard/breadcrumb-item"),className:"tvd-breadcrumb",tagName:"li",render:function(a){return this.$el.html(this.template({url:a.url,title:a.title})),this}}),ThriveHead.views.Dashboard=ThriveHead.views.Base.extend({className:"tho-container",template:TVE_Dash.tpl("dashboard"),no_test_template:TVE_Dash.tpl("test/no_test"),runningPostsPagination:null,completedPostsPagination:null,highlight_tests:[],events:{"click .tho-set-another-test":"setNewTest","click .tho-delete-tests-modal":"deleteTestModal","click .tho-detele-tests-action":"deleteTestAction","keyup .tho-running-search-input":"searchTests","keyup .tho-completed-search-input":"searchTests"},initialize:function(a){this.highlight_tests=a.highlight_tests},render:function(a){return 0==a.active.length&&0==a.completed.length?(this.$el.html(this.no_test_template()),window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes(),void TVE_Dash.hideLoader()):(this.$el.html(this.template({views:a.daily.views,engagements:a.daily.engagements,engagement_rate:a.daily.engagement_rate})),ThriveHead.objects.runningTests=new ThriveHead.collections.Tests(a.active),ThriveHead.objects.completedTests=new ThriveHead.collections.Tests(a.completed),ThriveHead.objects.RunningTestsView=new ThriveHead.views.TestList({singleItemTemplate:"dashboard/running-test-item",collection:ThriveHead.objects.runningTests,el:this.$el.find("#tho-running-test-list"),highlight_tests:this.highlight_tests}),this.runningPostsPagination=new ThriveHead.views.PostPagination({collection:ThriveHead.objects.runningTests,view:ThriveHead.objects.RunningTestsView,el:this.$el.find(".tho-top-pagination"),type:"static"}),this.runningPostsPagination.changePage(),ThriveHead.objects.CompletedTestsView=new ThriveHead.views.TestList({singleItemTemplate:"dashboard/completed-test-item",collection:ThriveHead.objects.completedTests,el:this.$el.find("#tho-completed-test-list")}),this.completedPostsPagination=new ThriveHead.views.PostPagination({collection:ThriveHead.objects.completedTests,view:ThriveHead.objects.CompletedTestsView,el:this.$el.find(".tho-bottom-pagination"),type:"static"}),this.completedPostsPagination.changePage(),this.$el.find("#no-form-overlay").hide(),this)},setNewTest:function(a){var b={id:a.currentTarget.attributes["data-id"].value,title:a.currentTarget.attributes["data-title"].value,variations:[],test_criteria:{}};ThriveHead.objects.PostsCollection=new ThriveHead.collections.TestPosts,ThriveHead.objects.PostsCollection.add(new ThriveHead.models.TestPostItem(b)),ThriveHead.router.navigate("#createTest/addVariations",{trigger:!0})},deleteTestModal:function(a){var b=a.currentTarget.attributes["data-id"].value,c=a.currentTarget.attributes["data-test"].value,d=a.currentTarget.attributes["data-title"].value,e=this.$el.find("#tho-delete-tests-modal");e.find(".tho-delete-content-title").html(d),e.openModal({ready:function(){e.find(".tho-detele-tests-action").attr("data-id",b),e.find(".tho-detele-tests-action").attr("data-test",c)}})},deleteTestAction:function(a){var b=a.currentTarget.attributes["data-id"].value,c=a.currentTarget.attributes["data-test"].value,d=this;TVE_Dash.showLoader(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveHead.nonce},cache:!1,url:ThriveHead.routes.tests+"/"+b,method:"delete",dataType:"json"}).done(function(){var a=ThriveHead.objects.completedTests.get(c);ThriveHead.objects.completedTests.remove(a),d.completedPostsPagination.changePage(),TVE_Dash.success(ThriveHead.translations.successfulDeleteTest)}).fail(function(){TVE_Dash.err(ThriveHead.translations.failDeleteTest)}).always(function(){TVE_Dash.hideLoader()})},searchTests:function(a){var b,c=jQuery(a.target).val();if(-1!==a.currentTarget.className.indexOf("running"))b=this.runningPostsPagination;else{if(-1===a.currentTarget.className.indexOf("completed"))return;b=this.completedPostsPagination}b.changePage(null,{page:1,search_by:c})}}),ThriveHead.views.TestList=ThriveHead.views.Base.extend({singleItemTemplate:"",highlight_tests:[],initialize:function(a){this.singleItemTemplate=a.singleItemTemplate,this.highlight_tests="undefined"==typeof a.highlight_tests?[]:a.highlight_tests},renderOne:function(a){var b=new ThriveHead.views.TestItem({itemTemplate:this.singleItemTemplate,model:a}),c=b.render().$el;-1!==this.highlight_tests.indexOf(parseInt(a.get("id")))&&(c.addClass("tho-highlight"),setTimeout(function(){c.removeClass("tho-highlight")},3e3)),this.$el.append(c)},render:function(a){var b=this.collection;if(this.$el.empty(),"undefined"!=typeof a&&(b=new ThriveHead.collections.TestPosts(a)),b.sort(),"undefined"==typeof b.length||b.length>0)b.each(this.renderOne,this);else switch(this.singleItemTemplate){case"dashboard/running-test-item":this.$el.append("<tr class='tvd-collection-item'>"+ThriveHead.translations.no_running_tests+"</tr>");break;case"dashboard/completed-test-item":this.$el.append("<tr class='tvd-collection-item'>"+ThriveHead.translations.no_completed_tests+"</tr>")}return TVE_Dash.hideLoader(),this}}),ThriveHead.views.TestItem=ThriveHead.views.Base.extend({className:"tvd-collection-item",tagName:"tr",template:"",initialize:function(a){this.template=TVE_Dash.tpl(a.itemTemplate,{test:this.model})},render:function(){return this.$el.html(this.template),this}}),ThriveHead.views.CreateTest=ThriveHead.views.Base.extend({leftColPagination:{},rightColPagination:{},template:TVE_Dash.tpl("create-test/step-1/create_test"),events:{"click .tho-post-type-checkbox":"updatePostList","keyup .tho-search-input":"updatePostList","keyup .tho-search-sel-input":"updateSelPostList","click .tht-add-all-posts":"addRemoveAllPostsModal","click .tht-remove-all-posts":"addRemoveAllPostsModal","click .tho-add-remove-posts":"addRemoveAllPostsAction","click .tht-step1-continue":"addVariations","click #tho-post-list .tho-post-item .tho-moving-item-span":"addPostItem","click #tho-selected-post-list .tho-post-item .tho-moving-item-span":"removePostItem"},typeTime:0,lastSearchValue:"",initialize:function(){this.render(),this.$el.find(".tho-overflowing-box").scroll(this.postListScroll)},render:function(){return this.$el.html(this.template()),this.postList=new ThriveHead.views.PostList({collection:ThriveHead.objects.Posts,el:this.$el.find("#tho-post-list"),pagination:this.leftColPagination}),this.leftColPagination=new ThriveHead.views.PostPagination({collection:ThriveHead.objects.Posts,el:this.$el.find(".tvd-left-col-pagination"),view:this.postList,type:"dynamic"}),this.leftColPagination.changePage(null,{page:1,exclude:ThriveHead.objects.PostsCollection,post_types:this.getSelectedPostTypes()}),this.selectedPostList=new ThriveHead.views.SelectedPostList({collection:ThriveHead.objects.PostsCollection,el:this.$el.find("#tho-selected-post-list"),pagination:this.rightColPagination}),this.rightColPagination=new ThriveHead.views.PostPagination({collection:ThriveHead.objects.PostsCollection,view:this.selectedPostList,el:this.$el.find(".tvd-right-col-pagination"),type:"static"}),ThriveHead.objects.PostsCollection.length>0&&this.rightColPagination.changePage(null,{page:1}),0==ThriveHead.objects.PostsCollection.length?this.hideContinueBtn():this.showContinueBtn(),TVE_Dash.hideLoader(),this},addVariations:function(){ThriveHead.router.navigate("#createTest/addVariations",{trigger:!0})},getSearchInput:function(){return this.$el.find(".tho-search-input").val()},updatePostList:function(a){var b=this.getSearchInput(),c=(new Date).getTime(),d=this,e=!1;if(a!==!0&&"tho-post-type-checkbox"===a.currentTarget.className&&(e=!0),!e){if(this.lastSearchValue==b&&a!==!0)return;if(this.lastSearchValue=b,0!==this.typeTime&&c-this.typeTime<500)return void(a!==!0&&(this.typeTime=c,setTimeout(function(){jQuery.proxy(d.updatePostList(!0),this)},600)));this.typeTime=c}TVE_Dash.showLoader(),this.leftColPagination.changePage(null,{page:1,search_by:b,post_types:this.getSelectedPostTypes()})},getSelectedPostTypes:function(){var a=[];return this.$el.find('input[name="tho-post-type-checkbox[]"]:checked').each(function(){a.push(jQuery(this).val())}),a},updateSelPostList:function(a){if(0!=ThriveHead.objects.PostsCollection.length){var b=jQuery(a.target).val();TVE_Dash.showLoader(),this.rightColPagination.changePage(null,{page:1,search_by:b,post_types:this.getSelectedPostTypes()}),TVE_Dash.hideLoader()}},postListScroll:function(a){var b=jQuery(a.currentTarget);b.scrollTop()+b.innerHeight()>=b[0].scrollHeight?b.addClass("tho-no-bottom-blur"):b.removeClass("tho-no-bottom-blur"),b.scrollTop()<50?b.addClass("tho-no-top-blur"):b.removeClass("tho-no-top-blur")},addRemoveAllPostsModal:function(a){var b="",c="",d=this,e=this.$el.find("#tho-add-remove-all");e.removeClass("tho-teal-modal tvd-red"),-1!==a.currentTarget.className.indexOf("add-all")?(e.addClass("tho-teal-modal"),b="addAllPosts",c=ThriveHead.translations.add):-1!==a.currentTarget.className.indexOf("remove-all")&&(e.addClass("tvd-red"),b="removeAllPosts",c=ThriveHead.translations.remove),this.$el.find(".tho-add-remove-all-text").html(c),this.$el.find("#tho-add-remove-all").openModal({ready:function(){d.$el.find(".tho-add-remove-posts").attr("data-action",b)}})},addRemoveAllPostsAction:function(a){var b=a.currentTarget.attributes["data-action"].value;this[b]()},addAllPosts:function(){TVE_Dash.showLoader(),this.collection.each(function(a){ThriveHead.objects.PostsCollection.add(a)}),this.leftColPagination.changePage(null,{page:this.leftColPagination.currentPage,exclude:ThriveHead.objects.PostsCollection,post_types:this.getSelectedPostTypes(),search_by:this.getSearchInput()}),this.$el.find(".tho-search-sel-input").val(""),this.rightColPagination.changePage(null,{page:this.rightColPagination.currentPage,search_by:""}),this.showContinueBtn(),TVE_Dash.hideLoader()},removeAllPosts:function(){return TVE_Dash.showLoader(),this.rightColPagination.view.currentCollection.length>0?(this.rightColPagination.view.currentCollection.each(function(a){ThriveHead.objects.PostsCollection.remove(a.get("id"))}),this.$el.find(".tho-search-input").val(""),this.leftColPagination.changePage(null,{page:this.leftColPagination.currentPage,exclude:[],post_types:this.getSelectedPostTypes(),search_by:""}),this.rightColPagination.changePage(null,{page:this.rightColPagination.currentPage-1,search_by:""}),0===ThriveHead.objects.PostsCollection.length&&this.hideContinueBtn(),void TVE_Dash.hideLoader()):(this.rightColPagination.changePage(null,{page:this.rightColPagination.currentPage-1}),void TVE_Dash.hideLoader())},addPostItem:function(a){var b=jQuery(a.currentTarget),c=b.parent().attr("data-id"),d=this.collection.get(c);ThriveHead.objects.PostsCollection.add(d),b.parent().addClass("tho-moving-animation-left"),this.leftColPagination.changePage(null,{page:this.leftColPagination.currentPage,exclude:ThriveHead.objects.PostsCollection,post_types:this.getSelectedPostTypes(),search_by:this.getSearchInput()}),this.$el.find(".tho-search-sel-input").val(""),this.rightColPagination.view.animateAddPost=c,this.rightColPagination.changePage(null,{page:this.rightColPagination.currentPage,search_by:""}),this.showContinueBtn()},removePostItem:function(a){var b=this,c=jQuery(a.currentTarget),d=c.parent().attr("data-id"),e=ThriveHead.objects.PostsCollection.get(d);c.parent().addClass("tho-moving-item-right-left"),setTimeout(function(){ThriveHead.objects.PostsCollection.remove(e),b.$el.find(".tho-search-input").val(""),b.leftColPagination.view.animateAddPost=d,b.leftColPagination.changePage(null,{page:b.leftColPagination.currentPage,exclude:ThriveHead.objects.PostsCollection,post_types:b.getSelectedPostTypes(),search_by:""}),b.rightColPagination.changePage(null,{page:b.rightColPagination.currentPage}),0==ThriveHead.objects.PostsCollection.length&&b.hideContinueBtn()},300)},showContinueBtn:function(){this.$el.find(".tho-no-selected-posts").hide(),this.$el.find(".tht-remove-all-posts").css("display","inline-block"),this.$el.find(".tht-step1-continue").show()},hideContinueBtn:function(){this.$el.find(".tho-no-selected-posts").show(),this.$el.find(".tht-remove-all-posts").hide(),this.$el.find(".tht-step1-continue").hide(),this.$el.find(".tvd-right-col-pagination").empty()}}),ThriveHead.views.PostPagination=Backbone.View.extend({template:TVE_Dash.tpl("pagination/post-view"),events:{"click a.page":"changePage","change .tho-items-per-page":"changeItemPerPage"},currentPage:1,pageCount:1,itemsPerPage:10,total_items:0,collection:null,params:null,type:"",view:null,initialize:function(a){this.collection=a.collection,this.view=a.view,this.type=a.type},changeItemPerPage:function(a){this.itemsPerPage=jQuery(a.target).val(),this.changePage(null,{page:1})},changePage:function(b,c){var d=this,e={itemsPerPage:this.itemsPerPage};if(b&&"undefined"!=typeof b.currentTarget?e.page=jQuery(b.currentTarget).attr("value"):c&&"undefined"!=typeof c.page?e.page=parseInt(c.page):e.page=this.currentPage,e.page<1&&(e.page=1),"undefined"!=typeof c&&("undefined"!=typeof c.exclude&&(c.exclude instanceof Backbone.Collection&&c.exclude.length>0?(e.exclude=[],c.exclude.each(function(a){e.exclude.push(a.id)}),this.exclude=e.exclude):this.exclude=[]),"undefined"!=typeof c.status&&(this.status=c.status),"undefined"!=typeof c.search_by&&(this.search_by=c.search_by),"undefined"!=typeof c.post_types&&(this.post_types=c.post_types)),e.post_types=this.post_types?this.post_types:[],e.search_by=this.search_by?this.search_by:"",e.exclude=this.exclude?this.exclude:[],e.status=this.status?this.status:0,"dynamic"==this.type)this.collection.fetch({reset:!0,data:a.param(e),success:function(){return 0==d.collection.length&&d.collection.total_count>0&&1!=d.currentPage?void d.changePage(null,{page:d.currentPage-1}):(d.updateParams(e.page,d.collection.total_count),void d.render())}});else if("static"==this.type&&"undefined"!=typeof this.view&&null!=this.view){this.updateParams(e.page,this.collection.length);var f,g=this.collection.clone(),h=(this.currentPage-1)*this.itemsPerPage,i=[];if("undefined"!=typeof g.comparator&&g.sort(),"undefined"!=typeof e.search_by&&""!=e.search_by){g.each(function(a){var b=a.get("title").toLowerCase();-1==b.indexOf(e.search_by)&&i.push(a)});for(var j in i)g.remove(i[j])}f=g.chain().rest(h).first(this.itemsPerPage).value(),this.view.render(f),this.render()}return!1},updateParams:function(a,b){this.currentPage=a,this.total_items=b,this.pageCount=Math.ceil(this.total_items/this.itemsPerPage)},setupParams:function(a){this.currentPage=a,this.total_items=this.collection.length,this.pageCount=Math.ceil(this.total_items/this.itemsPerPage)},render:function(){return this.$el.html(this.template({currentPage:parseInt(this.currentPage),pageCount:parseInt(this.pageCount),total_items:parseInt(this.total_items),itemsPerPage:parseInt(this.itemsPerPage)})),TVE_Dash.materialize(this.$el),this}}),ThriveHead.views.PostList=ThriveHead.views.Base.extend({pagination:{},initialize:function(a){this.listenTo(this.collection,"reset",this.render),this.pagination=a.pagination,this.pagination.pageCount=Math.ceil(this.pagination.total_items/this.pagination.itemsPerPage),this.pagination.collection=this.collection},renderOne:function(a){var b=new ThriveHead.views.PostItem({model:a,collection:this.collection,className:"tho-post-item tho-moving-item tho-moving-item-teal"});this.$el.append(b.render().el),"undefined"!=typeof this.animateAddPost&&a.get("id")==this.animateAddPost&&(this.animateAddPost=0,b.$el.addClass("tho-moving-item-to-right"),setTimeout(function(){b.$el.removeClass("tho-moving-item-to-right")},600))},render:function(){return this.$el.empty(),this.collection.sort(),this.collection.each(this.renderOne,this),0==this.collection.length?jQuery(".tho-no-search-res").show():jQuery(".tho-no-search-res").hide(),TVE_Dash.hideLoader(),this}}),ThriveHead.views.SelectedPostList=ThriveHead.views.Base.extend({pagination:{},typeTime:0,lastSearchValue:"",currentCollection:null,initialize:function(a){this.listenTo(this.collection,"reset",this.render)},renderOne:function(a){var b=new ThriveHead.views.PostItem({model:a,collection:this.collection,className:"tho-post-item tho-moving-item tho-moving-item-red"});this.$el.append(b.render().el),"undefined"!=typeof this.animateAddPost&&a.get("id")==this.animateAddPost&&(this.animateAddPost=0,b.$el.addClass("tho-moving-animation-right "),setTimeout(function(){b.$el.removeClass("tho-moving-animation-right ")},600))},render:function(a){return this.$el.empty(),this.currentCollection=this.collection,"undefined"!=typeof a&&(this.currentCollection=new ThriveHead.collections.TestPosts(a)),0!=this.currentCollection.length?(_.each(this.currentCollection.last(this.currentCollection.length).reverse(),this.renderOne,this),this):void 0}}),ThriveHead.views.PostItem=ThriveHead.views.Base.extend({template:TVE_Dash.tpl("post/item"),className:"tho-post-item",render:function(){return this.$el.html(this.template({post:this.model})).attr("data-id",this.model.get("id")),this}}),ThriveHead.views.CreateTestStep2=ThriveHead.views.Base.extend({template:TVE_Dash.tpl("create-test/step-2/add_variations"),events:{"click .tho-determine-test-criteria":"determineTestCriteria","click .tho-step1-back":"selectPosts","focus .tho-variation":"checkCardFocus"},focusedVariationCardId:null,initialize:function(){this.render()},checkCardFocus:function(a){var b=jQuery(a.currentTarget).parents(".tho-variation-card").data("id");null===this.focusedVariationCardId&&(this.focusedVariationCardId=b),this.focusedVariationCardId!=b&&(this.$el.find("[data-id='"+this.focusedVariationCardId+"']").find(".tho-variation").each(function(){""==this.value&&jQuery(this).closest(".tvd-row").find(".tho-delete-variation").click()}),this.focusedVariationCardId=b)},renderOne:function(a){var b=new ThriveHead.views.CreateTestStep2Item({model:a});this.$el.find(".tho-posts-list-variations").append(b.render().el)},render:function(){return this.$el.html(this.template()),this.collection.each(this.renderOne,this),TVE_Dash.hideLoader(),this},selectPosts:function(){ThriveHead.router.navigate("#createTest/selectPosts",{trigger:!0})},determineTestCriteria:function(){var a=!0,b=!1;return this.$el.find(".tho-variation-card").each(function(){var c=jQuery(this).attr("data-id"),d=[],e=this;d.push(ThriveHead.util.addslashes(jQuery(e).find(".tho-control").val())),jQuery(e).find("input.tho-variation").each(function(){var c=ThriveHead.util.addslashes(jQuery(this).val());jQuery(this).removeClass("tvd-invalid"),""!=c&&(jQuery(this).attr("data-value",c),-1!==jQuery.inArray(c,d)&&(b=!0,jQuery(e).find('input.tho-variation[data-value="'+ThriveHead.util.addslashes(c)+'"]').addClass("tvd-invalid")),d.push(c),a=!1)}),d.shift(),ThriveHead.objects.PostsCollection.get(c).set("variations",d)}),a?(TVE_Dash.err(ThriveHead.translations.no_variations_toast),!1):b?(TVE_Dash.err(ThriveHead.translations.unique_variations_toast),!1):void ThriveHead.router.navigate("#createTest/setCriteria",{trigger:!0})}}),ThriveHead.views.CreateTestStep2Item=ThriveHead.views.Base.extend({template:TVE_Dash.tpl("create-test/step-2/add_variations_item"),events:{"click .tho-add-variation":"addVariation","click .tho-delete-variation":"deleteVariation","blur .tho-variation":"checkForDuplicateVariations"},className:"tvd-card tvd-white tho-variation-card",focusedInput:null,bindInputEvents:function(a){var b=this;a.focus(function(a){b.focusedInput=jQuery(a.currentTarget)}).keydown(function(a){var c=a.keyCode||a.which;if(9==c){a.preventDefault();var d=b.focusedInput.parents(".tho-variation-card").next(".tho-variation-card"),e=jQuery(a.currentTarget).val();"undefined"!=typeof d&&jQuery(d).hasClass("tho-variation-card")&&(""==e&&jQuery(a.currentTarget).closest(".tvd-row").find(".tho-delete-variation").click(),d.find(".tho-variation").last().focus())}else 13==c&&b.focusedInput.parents(".tho-variation-card").find(".tho-add-variation").trigger("click")})},render:function(){return this.$el.html(this.template({test:this.model})).attr("data-id",this.model.get("id")),this.addVariation(this.model),this},checkForDuplicateVariations:function(a){var b=!1,c=[],d=this.$el;c.push(ThriveHead.util.addslashes(this.$el.find(".tho-control").val())),d.find(".tho-variation ").each(function(){var a=ThriveHead.util.addslashes(jQuery(this).val());jQuery(this).removeClass("tvd-invalid"),""!=a&&(jQuery(this).attr("data-value",a),-1!==jQuery.inArray(a,c)&&(b=!0,d.find('input.tho-variation[data-value="'+ThriveHead.util.addslashes(a)+'"]').addClass("tvd-invalid")),c.push(a))}),b&&!jQuery(a.relatedTarget).hasClass("tho-determine-test-criteria")&&TVE_Dash.err(ThriveHead.translations.unique_variations_toast)},addVariation:function(a){if(a===this.model&&a.get("variations").length>0)for(var b=0;b<a.get("variations").length;b++){var c=new ThriveHead.views.VariationItem({variation:a.get("variations")[b],el:this.$el.find(".tho-variation-items")});c.render(),this.bindInputEvents(c.$el.find(".tho-variation").last())}else{var c=new ThriveHead.views.VariationItem({variation:"",el:this.$el.find(".tho-variation-items")});c.render(),this.focusedInput=c.$el.find(".tho-variation ").last(),this.focusedInput.focus(),this.bindInputEvents(c.$el.find(".tho-variation").last())}},deleteVariation:function(a){var b=jQuery(a.currentTarget);b.closest(".tvd-row").remove()}}),ThriveHead.views.VariationItem=ThriveHead.views.Base.extend({template:TVE_Dash.tpl("create-test/step-2/variation_item"),variation:"",initialize:function(a){this.variation=a.variation},render:function(){return this.$el.append(this.template({variation:this.variation})),this}}),ThriveHead.views.CreateTestStep3=ThriveHead.views.Base.extend({template:TVE_Dash.tpl("create-test/step-3/set_test_criteria"),events:{"click .tho-setting-checkbox":"checkCheckboxValue","change .tho-setting-input":"checkInputValue","click .tho-start-test":"startTest","click .tho-add-variations-back":"addVariations","blur .tho-setting-input-number":"isNumber","blur .tho-setting-input-number-non-zero":"checkForEmptyData","keypress .tho-frequency":"checkFrequencyValue","keypress .tho-setting-input":"triggerStartTest","keypress #chance_to_beat_original":"checkFloatNumber","keyup .input-display-frequency":"checkMaxMinValues"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){return this.$el.html(this.template({settings:this.model})),TVE_Dash.materialize(this.$el),TVE_Dash.hideLoader(),this},triggerStartTest:function(a){13==a.which&&(this.$el.find(".tho-start-test").focus(),this.$el.find(".tho-start-test").click())},checkFloatNumber:function(a){return 8==a.which||0==a.which||46==a.which||!(a.which<48||a.which>57)},checkFrequencyValue:function(a){return 8==a.which||0==a.which||!(a.which<48||a.which>57)},checkMaxMinValues:function(a){var b=jQuery(a.currentTarget);if(ThriveHead.util.minmax(jQuery(b).val(),jQuery(b).attr("data-min"),jQuery(b).attr("data-max"))===!1){var c=ThriveHead.translations.valueExceedsTheParameters.replace("%s",jQuery(b).attr("data-min")).replace("%l",jQuery(b).attr("data-max"));TVE_Dash.err(c,ThriveHead["const"].toast_timeout)}},addVariations:function(){ThriveHead.router.navigate("#createTest/addVariations",{trigger:!0})},checkCheckboxValue:function(a){var b=jQuery(a.currentTarget),c={};"use_default_engagement_settings"!=b.attr("data-key")?1==b.is(":checked")?this.$el.find("."+b.attr("data-hide")).slideDown():this.$el.find("."+b.attr("data-hide")).slideUp():1==b.is(":checked")?this.$el.find("."+b.attr("data-hide")).slideUp():this.$el.find("."+b.attr("data-hide")).slideDown(),
c[b.attr("data-key")]=Number(b[0].checked),this.model.set(c)},checkInputValue:function(a){var b=jQuery(a.currentTarget),c={};this.isNumber(a)&&(c[b.attr("data-key")]=b.val(),this.model.set(c))},isNumber:function(a){var b=jQuery(a.currentTarget);return isNaN(b.val())?(ThriveHead.util.setElementInvalid(b),!1):(ThriveHead.util.setElementValid(b),!0)},checkForEmptyData:function(a){var b=jQuery(a.currentTarget);if(""==b.val()||0==b.val())return ThriveHead.util.setElementInvalid(b),!1;if(ThriveHead.util.setElementValid(b),"chance_to_beat_original"==b.attr("id")){if(isNaN(b.val()))return ThriveHead.util.setElementInvalid(b),!1;if(parseFloat(b.val())>100)return ThriveHead.util.setElementInvalid(b),!1}},validateInput:function(){return ThriveHead.util.validateInput(this.$el.find("#chance_to_beat_original"),0,100,ThriveHead.translations.chance_to_beat_original_toast)&&ThriveHead.util.validateInput(this.$el.find("#minimum_duration"),0,!1,ThriveHead.translations.minimum_duration_toast)&&ThriveHead.util.validateInput(this.$el.find("#minimum_engagements"),0,!1,ThriveHead.translations.minimum_engagements_toast)},startTest:function(a){var b=jQuery(a.currentTarget),c=this.model.attributes,d=ThriveHead.objects.PostsCollection.length;if(!(jQuery("#tho_use_default_engagement_settings").is(":checked")||jQuery("#tho_scrolling_signal").is(":checked")||jQuery("#tho_time_on_content_signal").is(":checked")||jQuery("#tho_click_through").is(":checked")))return void TVE_Dash.err(ThriveHead.translations.noEngagementSettings);if(!b.hasClass("tvd-disabled")){if(ThriveHead.util.setLoading(b),this.validateInput(),this.$el.find(".tvd-invalid:visible").length)return void ThriveHead.util.removeLoading(b);ThriveHead.objects.PostsCollection.each(function(a,b){a.set("test_criteria",c)}),ThriveHead.objects.PostsCollection.sync("create",ThriveHead.objects.PostsCollection,{success:function(a){ThriveHead.objects.PostsCollection.reset(),ThriveHead.router.force_fetch=!0;var b=1==d?ThriveHead.translations.one_tests_added:ThriveHead.translations.multiple_tests_added.replace("%s",d);ThriveHead.notifications.dashboard=[{message:b,type:"tvd-green",params:{ids:a}}],ThriveHead.router.navigate("#dashboard",{trigger:!0})},error:function(a){}})}}}),ThriveHead.views.Test=Backbone.View.extend({template:TVE_Dash.tpl("test/view"),events:{"change #tho-chart-interval":"updateChart","click .tho-stop-test":"stopTest"},currentInterval:"day",testData:null,render:function(a){return this.testData=a,this.$el.html(this.template({title:a.active_test.title,status:a.active_test.status,completed_tests:a.completed_tests.length,stopped_variations:a.stopped_variations.length})),ThriveHead.objects.TestChart?(ThriveHead.objects.TestChartView.force_redraw=!0,ThriveHead.objects.TestChart.set(a.chart_data)):ThriveHead.objects.TestChart=new ThriveHead.models.TestChart(a.chart_data),ThriveHead.objects.TestChartView||(ThriveHead.objects.TestChartView=new ThriveHead.views.TestChartView({el:this.$el,model:ThriveHead.objects.TestChart,renderTo:"tho-test-chart"})),ThriveHead.objects.TestVariationList?ThriveHead.objects.TestVariationList.setElement(this.$el.find(".tho-test-variations")):ThriveHead.objects.TestVariationList=new ThriveHead.views.TestVariationList({el:this.$el.find(".tho-test-variations")}),ThriveHead.objects.TestVariationList.render(a.variations,a.active_test.status),ThriveHead.objects.TestStoppedVariationList?ThriveHead.objects.TestStoppedVariationList.setElement(this.$el.find(".tho-test-stopped-variations")):ThriveHead.objects.TestStoppedVariationList=new ThriveHead.views.TestStoppedVariationList({el:this.$el.find(".tho-test-stopped-variations")}),ThriveHead.objects.TestStoppedVariationList.render(a.stopped_variations),ThriveHead.objects.ActiveTest=new ThriveHead.models.Test(a.active_test),a.active_test.status==ThriveHead["const"].test_status_active&&this.renderTestSettings(),this.drawCandleStick(a.variations,"tho-candle-stick-chart"),this.drawCandleStick(a.stopped_variations,"tho-stopped-candle-stick-chart"),this.displayNoDataOverlay(a.variations),this.renderCompletedTests(a.completed_tests),this.$el.find("#tho-chart-interval").select2(),TVE_Dash.hideLoader(),this},displayNoDataOverlay:function(a){var b=!0;for(var c in a)if(a[c].views>0){b=!1;break}b?this.$el.find(".tho-chart-overlay").show():this.$el.find(".tho-chart-overlay").hide()},drawCandleStick:function(a,b){a&&(this.bar_chart=new ThriveHead.BarChart({title:"",data:a,renderTo:b}))},updateChart:function(a){ThriveHead.objects.TestChartView.intervalChanged(a.currentTarget.value)},renderCompletedTests:function(a){var b=this;this.$el.find("#tho-completed-test-list .tho-completed-test").remove(),_.each(a,function(a){var c=new ThriveHead.views.CompletedTestItem({test:a});b.$el.find("#tho-completed-test-list").append(c.render().el)})},renderTestSettings:function(){var a=new ThriveHead.views.TestSettings({model:ThriveHead.objects.ActiveTest});this.$el.find(".tho-test-variations").append(a.render().el)},stopTest:function(){TVE_Dash.modal(ThriveHead.views.modals.StopTest,{title:ThriveHead.translations.StopTestTitle,variations:this.testData.variations,width:1230,"max-width":"90%"})}}),ThriveHead.views.CompletedTestItem=Backbone.View.extend({tagName:"li",className:"tvd-row tho-completed-test tvd-collection-item",template:TVE_Dash.tpl("test/completed-test-item"),test:[],initialize:function(a){this.test=a.test},render:function(){return this.$el.html(this.template({test:this.test})),this}}),ThriveHead.views.TestSettings=Backbone.View.extend({tagName:"tr",className:"tho-test-variation tvd-collection-item",template:TVE_Dash.tpl("test/test-settings"),active_test:null,events:{"click .tho-change-settings":"editSettings"},render:function(a){var b=this.model;return"undefined"!=typeof a&&(b=a),this.$el.html(this.template({model:b})),this},editSettings:function(){TVE_Dash.modal(ThriveHead.views.modals.EditTestSettings,{title:ThriveHead.translations.EditSettingsTitle,model:ThriveHead.objects.ActiveTest,settingView:this})}}),ThriveHead.views.TestVariationList=Backbone.View.extend({status:null,render:function(a,b){this.status=b,this.emptyList(),_.each(a,this.renderOne,this)},renderOne:function(a,b){var c=ThriveHead["const"].CHART_COLORS[a.key%ThriveHead["const"].CHART_COLORS.length],d=this.status;a.show_graph=!0,a.index=b,a.color=c;var e=new ThriveHead.views.TestVariationItem({variation:a,status:d});this.$el.append(e.render().el)},emptyList:function(){this.$el.find(".tho-test-variation").remove()}}),ThriveHead.views.TestStoppedVariationList=Backbone.View.extend({render:function(a){this.emptyList(),_.each(a,this.renderOne,this)},renderOne:function(a,b){var c=ThriveHead["const"].CHART_COLORS[a.key%ThriveHead["const"].CHART_COLORS.length];a.show_graph=!0,a.index=b,a.color=c;var d=new ThriveHead.views.TestStoppedVariationItem({variation:a});this.$el.append(d.render().el)},emptyList:function(){this.$el.find(".tho-test-stopped-variation").remove()}}),ThriveHead.views.TestVariationItem=Backbone.View.extend({tagName:"tr",className:"tho-test-variation tvd-collection-item",template:TVE_Dash.tpl("test/variation-item"),variation:[],status:null,events:{"click .tho-stop-test-variation-modal":"stopTestVariationModal"},initialize:function(a){this.variation=a.variation,this.status=a.status},stopTestVariationModal:function(a){TVE_Dash.modal(ThriveHead.views.modals.StopVariation,{width:450,"max-width":"60%",variation_title:decodeURI(a.currentTarget.attributes["data-title"].value),model:new ThriveHead.models.Variation({id:this.variation.id,test_id:this.variation.test_id})})},render:function(){return this.$el.html(this.template({variation:this.variation,status:this.status})),this}}),ThriveHead.views.TestStoppedVariationItem=Backbone.View.extend({tagName:"tr",className:"tho-test-variation tvd-collection-item tvd-gray tvd-tooltipped tho-tooltipped",template:TVE_Dash.tpl("test/stopped-variation-item"),variation:[],initialize:function(a){this.variation=a.variation,this.$el.attr("data-tooltip",ThriveHead.translations.stoppedVariationRowTooltip+" "+this.variation.stopped_date).attr("data-position","top")},render:function(){return this.$el.html(this.template({variation:this.variation})),this}}),ThriveHead.views.StopTestVariationItem=Backbone.View.extend({tagName:"li",className:"tvd-row tho-test-variation tvd-collection-item",template:TVE_Dash.tpl("test/stop-variation-item"),variation:[],initialize:function(a){this.variation=a.variation},render:function(){return this.$el.html(this.template({variation:this.variation})),this}}),ThriveHead.views.TestChartView=Backbone.View.extend({currentInterval:"day",renderTo:"",force_redraw:!1,initialize:function(a){this.renderTo=a.renderTo,this.listenTo(this.model,"change",this.updateChart),this.updateChart()},intervalChanged:function(a){a!=this.currentInterval&&(this.currentInterval=a,"undefined"!=typeof this.chart&&this.chart.showLoading(),this.model.fetch({data:jQuery.param({interval:a})}))},updateChart:function(){("undefined"==typeof this.chart||this.force_redraw)&&this.drawChart(this.renderTo),this.chart.set("data",this.model.get("data")),this.chart.set("title",this.model.get("title")),this.chart.set("x_axis",this.model.get("x_axis")),this.chart.set("y_axis",this.model.get("y_axis")),this.chart.redraw()},drawChart:function(a){this.chart=new ThriveHead.LineChart({title:"",type:"spline",data:[],renderTo:a}),this.chart.showLoading()}}),ThriveHead.views.modals={ViewSettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modal/general-settings"),events:{"click .tho-setting-checkbox_model":"checkCheckboxValue_model","click .tho-save-settings":"saveSettings","blur .tho-setting-input-number":"isNumber","keypress .tho-frequency":"checkFrequencyValue","keyup .tho-frequency":"checkMaxMinValues"},readyForSave:!0,checkMaxMinValues:function(a){var b=jQuery(a.currentTarget);if(ThriveHead.util.minmax(jQuery(b).val(),jQuery(b).attr("data-min"),jQuery(b).attr("data-max"))===!1){var c=ThriveHead.translations.valueExceedsTheParameters.replace("%s",jQuery(b).attr("data-min")).replace("%l",jQuery(b).attr("data-max"));TVE_Dash.err(c,ThriveHead["const"].toast_timeout),this.readyForSave=!1}else this.readyForSave=!0},checkFrequencyValue:function(a){return 13==a.which&&this.readyForSave?void this.$el.find(".tho-save-settings").click():8==a.which||0==a.which||!(a.which<48||a.which>57)},checkCheckboxValue_model:function(a){var b=jQuery(a.currentTarget);1==b.is(":checked")?this.$el.find("."+b.attr("data-hide")).slideDown():this.$el.find("."+b.attr("data-hide")).slideUp()},isNumber:function(a){var b=jQuery(a.currentTarget);return isNaN(b.val())?(ThriveHead.util.setElementInvalid(b),!1):(ThriveHead.util.setElementValid(b),!0)},saveSettings:function(a){var b=jQuery(a.currentTarget),c=ThriveHead.objects.SettingModel,d=this;if(!jQuery("#tho_scrolling_signal_model").is(":checked")&&!jQuery("#tho_time_on_content_signal_model").is(":checked")&&!jQuery("#tho_click_through_model").is(":checked"))return void TVE_Dash.err(ThriveHead.translations.noEngagementSettings);if(!b.hasClass("tvd-disabled")){if(ThriveHead.util.setLoading(b),this.$el.find(".tvd-invalid:visible").length)return void ThriveHead.util.removeLoading(b);jQuery(".tho-setting-input").each(function(){var a=jQuery(this).data("key"),b=jQuery(this).val(),d={};d[a]=b,c.set(d)}),jQuery(".tho-setting-checkbox_model").each(function(){var a={};a[jQuery(this).attr("data-key")]=Number(jQuery(this)[0].checked),c.set(a)}),c.save(null,{success:function(a,c){TVE_Dash.success(ThriveHead.translations.settings_saved_success_toast),ThriveHead.util.removeLoading(b),d.close()},error:function(a,c){TVE_Dash.err(ThriveHead.translations.settings_saved_fail_toast),ThriveHead.util.removeLoading(b)}})}}}),StopVariation:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modal/stop-variation"),events:{"click .tho-stop-test-variation-modal-action":"stopVariation"},afterInitialize:function(a){this.$el.addClass("tvd-red")},stopVariation:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),TVE_Dash.showLoader(),this.model.save({},{success:function(a,b){ThriveHead.router.viewTest(b),setTimeout(function(){TVE_Dash.success(ThriveHead.translations.successfulStopVariation)},600)},error:function(a,b){TVE_Dash.err(ThriveHead.translations.failStopVariation)},complete:function(){d.close(),TVE_Dash.hideLoader()}})}}),EditTestSettings:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modal/test-settings"),events:{"click .tho-save-test-settings":"saveSettings","keypress .tho-frequency":"checkFrequencyValue","blur .tho-setting-input-number-non-zero":"checkForEmptyData","blur #chance_to_beat_original":"checkNumber","blur #minimum_duration":"checkMiniumDuration","blur #minimum_engagements":"checkMiniumEngagements","keypress #chance_to_beat_original":"checkFloatNumber","change #tho-enable-test-settings":"toggleAutoWinSettings"},checkFrequencyValue:function(a){return 8==a.which||0==a.which||!(a.which<48||a.which>57)},checkFloatNumber:function(a){return 8==a.which||0==a.which||46==a.which||!(a.which<48||a.which>57)},checkNumber:function(a){var b=jQuery(a.currentTarget);isNaN(b.val())&&ThriveHead.util.setElementInvalid(b),parseFloat(b.val())>100?ThriveHead.util.setElementInvalid(b):parseFloat(b.val())<90?this.$el.find(".tho_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tho_beat_original_notice").addClass("tvd-hide")},checkMiniumDuration:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<7?this.$el.find(".tho_duration_notice").removeClass("tvd-hide"):this.$el.find(".tho_duration_notice").addClass("tvd-hide")},checkMiniumEngagements:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<100?this.$el.find(".tho_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tho_engagements_notice").addClass("tvd-hide")},checkForEmptyData:function(a){var b=jQuery(a.currentTarget);return""!=b.val()&&0!=b.val()?(ThriveHead.util.setElementValid(b),!0):(ThriveHead.util.setElementInvalid(b),!1)},saveSettings:function(a){var b=this.$el.find("#tho-enable-test-settings").is(":checked"),c=this.$el.find("#chance_to_beat_original"),d=this.$el.find("#minimum_duration"),e=this.$el.find("#minimum_engagements"),f=this;if(b){if(!(ThriveHead.util.validateInput(c,0,100,ThriveHead.translations.chance_to_beat_original_toast)&&ThriveHead.util.validateInput(d,0,!1,ThriveHead.translations.minimum_duration_toast)&&ThriveHead.util.validateInput(e,0,!1,ThriveHead.translations.minimum_engagements_toast)))return;this.model.set("chance_to_beat_original",c.val()),this.model.set("minimum_duration",d.val()),this.model.set("minimum_engagements",e.val()),this.model.set("enable_automatic_winner",1),TVE_Dash.showLoader(),this.model.save({},{success:function(){f.close(),f.settingView.render(f.model),TVE_Dash.hideLoader()}})}else this.model.set("enable_automatic_winner",0),TVE_Dash.showLoader(),this.model.save({},{success:function(){f.close(),f.settingView.render(f.model),TVE_Dash.hideLoader()}})},toggleAutoWinSettings:function(a){var b=jQuery(a.currentTarget);b.is(":checked")?this.$el.find(".tho-winner-settings-input").show(0):this.$el.find(".tho-winner-settings-input").hide(0),setTimeout(ThriveHead.resize_thickbox,0)}}),StopTest:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modal/stop-test"),events:{"click .tho-choose-winner":"setWinner"},afterRender:function(){this.$el.addClass("tho-modal-choose-winner"),this.emptyList(),_.each(this.variations,this.renderOne,this)},renderOne:function(a){if(1==a.active){var b=new ThriveHead.views.StopTestVariationItem({variation:a});this.$el.find(".tho-stop-test-variations").append(b.render().el)}},emptyList:function(){this.$el.find(".tho-stop-test-variation").remove()},setWinner:function(a){var b=this,c=jQuery(a.currentTarget).attr("data-variation-id"),d="",e="";for(var f in this.variations)if(this.variations[f].id==c){d=this.variations[f].variation_title,e=this.variations[f].engagement_rate;break}ThriveHead.objects.ActiveTest.set({status:ThriveHead["const"].test_status_completed,winning_variation:c,winning_title:d}),TVE_Dash.showLoader(),ThriveHead.objects.ActiveTest.save({},{success:function(a){a&&(b.close(),TVE_Dash.hideLoader(),b.winnerSelected(d,e))}})},winnerSelected:function(a,b){jQuery(".tho-stop-test").hide(),jQuery(".tho-change-settings").parents("li").hide(),TVE_Dash.modal(ThriveHead.views.modals.WinningVariation,{title:"",winner:a,percentage:b})}}),WinningVariation:TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modal/winning-variation"),afterRender:function(){this.$el.addClass("tho-winning-modal")}})}})}(jQuery);var ThriveHead=ThriveHead||{};ThriveHead.views=ThriveHead.views||{},ThriveHead.objects=ThriveHead.objects||{},jQuery(function(){ThriveHead.views.Reporting=Backbone.View.extend({template:TVE_Dash.tpl("reporting"),$chart:jQuery("#tho-report-chart"),table_data:{},events:{"change #report_type":"changeChart","click .tho-submit-report-type":"changeChart","change .tho-chart-source-select":"changeChart","change #tho-chart-interval-select":"changeChart","change #tho-engagement-type-select":"changeChart","change select.tho-chart-date-select":"changeDate","click .calendar-trigger-icon":"triggerDatepicker"},reportSourceType:0,render:function(a,b){return this.$el.html(this.template()),this.setInitialValues(a,b),this.init(),this},validateDate:function(a,b){"start"===a&&this.start_date!==b&&(this.start_date=b),"end"===a&&this.end_date!==b&&(this.end_date=b),this.changeChart()},changeDate:function(a){var b,c,d,e=new Date,f=1;switch("undefined"!=typeof a&&(f=parseInt(jQuery(a.target).val())),d=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2),this.$el.find(".tho-date-filter").hide(),f){case ThriveHead["const"].date_intervals.last_7_days:b=new Date(e.getTime()-6048e5),c=b.getFullYear()+"-"+("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2);break;case ThriveHead["const"].date_intervals.last_30_days:b=new Date(e.getTime()-2592e6),c=b.getFullYear()+"-"+("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2);break;case ThriveHead["const"].date_intervals.this_month:c=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-01";break;case ThriveHead["const"].date_intervals.last_month:c=e.getFullYear()+"-"+("0"+e.getMonth()).slice(-2)+"-01",d=e.getFullYear()+"-"+("0"+e.getMonth()).slice(-2)+"-30";break;case ThriveHead["const"].date_intervals.this_year:c=e.getFullYear()+"-01-01";break;case ThriveHead["const"].date_intervals.last_year:c=e.getFullYear()-1+"-01-01",d=e.getFullYear()-1+"-12-31";break;case ThriveHead["const"].date_intervals.last_12_months:c=e.getFullYear()-1+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2);break;case ThriveHead["const"].date_intervals.custom_date_range:return void this.$el.find(".tho-date-filter").show()}this.start_date=c,this.end_date=d,this.$el.find("#tho-report-start-date").pickadate("picker").set("select",c),this.$el.find("#tho-report-end-date").pickadate("picker").set("select",d),this.changeChart()},triggerDatepicker:function(a){var b=jQuery(a.target),c=jQuery(b.attr("data-activates"));return jQuery(c).trigger("click"),!1},init:function(){var a=this;this.$form=this.$el.find("form"),this.$el.find("#tho-report-start-date").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){a.validateDate("start",a.$el.find("#tho-report-start-date").val())}}),this.$el.find("#tho-report-end-date").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){a.validateDate("end",a.$el.find("#tho-report-end-date").val())}}),this.pagination=new ThriveHead.views.Pagination({el:this.$el.find(".tho-pagination"),total:1,collection:{}}),this.changeDate()},setInitialValues:function(a,b){this.$el.find("#report_type").val(a),this.$el.find(".tho-source-type-select").val(b),this.reportSourceType=b,ThriveHead.router.navigate("#reporting/"+a+"/"+b,{trigger:!1})},changeChart:function(){var a=this,b=this.getData(),c=this.reportSourceType,d=this.$el.find("#report_type").val();ThriveHead.router.navigate("#reporting/"+d+"/"+c,{trigger:!1}),"undefined"!=typeof this.chart&&this.chart.showLoading(),void 0!=this.chart&&this.chart.empty(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveHead.nonce},cache:!1,url:ThriveHead.routes.logs+"/"+d+"/"+c,data:b,dataType:"json",success:function(b){ThriveHead.objects.colors=b.chart_colors,("undefined"==typeof a.chartType||a.chartType&&a.chartType!==a.getChartType())&&a.drawChart(b.chart_data,b.chart_title),a.updateChart(b.chart_data,b.chart_title,b.chart_x_axis,b.chart_y_axis),a.getViewForType()}})},drawChart:function(a,b){return this.chartType=this.getChartType(),jQuery.isEmptyObject(a)||0===a.length?this.$el.find("#tho-chart-overlay").show():this.$el.find("#tho-chart-overlay").hide(),"none"===this.chartType?void this.$el.find("#tho-report-chart").hide():(this.$el.find("#tho-report-chart").show(),this.$el.find(".tho-chart-interval").show(),this.chart=new ThriveHead.LineChart({title:b,renderTo:"tho-report-chart",type:this.chartType}),this.chart.chart.legend.display=!1,void this.chart.chart.legend.group.hide())},updateChart:function(a,b,c,d){return"undefined"==typeof this.chart&&this.drawChart(a),this.displayCustomFields(a),"none"===this.chartType?(jQuery(".tho-chart-interval").hide(),void jQuery("#tho-report-chart").html("")):(this.chart.set("data",a),this.chart.set("title",b),this.chart.set("x_axis",c),this.chart.set("y_axis",d),void this.chart.redraw())},displayCustomFields:function(a){jQuery.isEmptyObject(a)||0===a.length?this.$el.find("#tho-chart-overlay").show():this.$el.find("#tho-chart-overlay").hide()},getChartType:function(){return"areaspline"},getViewForType:function(){switch(this.getReportType()){case ThriveHead["const"].reports.engagement_report:case ThriveHead["const"].reports.cumulative_engagement_report:return this.chart.set("suffix",""),ThriveHead.objects.EngagementReport=new ThriveHead.collections.EngagementReport,ThriveHead.objects.EngagementView=new ThriveHead.views.EngagementReportList({collection:ThriveHead.objects.EngagementReport,pagination:this.pagination,el:this.$el.find("#tho-report-table")}),this.pagination.collection=ThriveHead.objects.EngagementReport,this.pagination.changePage(null,1),ThriveHead.objects.EngagementView;case ThriveHead["const"].reports.engagement_rate_report:return this.chart.set("suffix","%"),ThriveHead.objects.EngagementRateReport=new ThriveHead.collections.EngagementRateReport,ThriveHead.objects.EngagementRateView=new ThriveHead.views.EngagementRateReportList({collection:ThriveHead.objects.EngagementRateReport,pagination:this.pagination,el:this.$el.find("#tho-report-table")}),this.pagination.collection=ThriveHead.objects.EngagementRateReport,this.pagination.changePage(null,1),ThriveHead.objects.EngagementRateView}},getData:function(){return this.$form.serializeObject()},getReportType:function(){return this.$el.find("#report_type").val()},getPageTitle:function(){return this.$el.find("#report_type option:selected").text()}}),ThriveHead.views.Pagination=Backbone.View.extend({template:TVE_Dash.tpl("pagination/table-view"),events:{"click a.page":"changePage"},currentPage:1,pageCount:1,pagesToDisplay:2,itemsPerPage:50,total_items:0,order_by:"",order_dir:"",collection:null,initialize:function(a){this.pageCount=Math.ceil(a.total/this.itemsPerPage),this.collection=a.collection},changePage:function(a,b){var c="undefined"==typeof b?jQuery(a.currentTarget).attr("value"):parseInt(b),d=this.getFormData(),e=this;return d+="&"+jQuery.param({page:c,itemsPerPage:this.itemsPerPage,order_by:this.order_by,order_dir:this.order_dir}),this.collection.fetch({reset:!0,data:d,success:function(){e.currentPage=c,e.total_items=e.collection.total_count,e.pageCount=Math.ceil(e.total_items/e.itemsPerPage),e.render(),TVE_Dash.hideLoader()}}),!1},getFormData:function(){return jQuery("#tho-reporting form").serialize()},render:function(){return this.$el.html(this.template({currentPage:parseInt(this.currentPage),pageCount:parseInt(this.pageCount),pagesToDisplay:parseInt(this.pagesToDisplay),total_items:parseInt(this.total_items),itemsPerPage:this.itemsPerPage})),this}}),ThriveHead.views.ReportingTableBase=Backbone.View.extend({report_count_data:0,pagination:{},itemView:"",extra_fields:{},initialize:function(a){this.listenTo(this.collection,"reset",this.render),this.pagination=a.pagination,this.$el.html(this.template({}))},changeOrder:function(a){var b=jQuery(a.currentTarget).attr("data-order-by");if(b==this.pagination.order_by)switch(this.pagination.order_dir){case"DESC":this.pagination.order_dir="ASC";break;case"ASC":this.pagination.order_dir="DESC";break;case"":this.pagination.order_dir="DESC"}else this.pagination.order_by=b,this.pagination.order_dir="DESC";this.pagination.changePage(null,1)},addOne:function(a){var b=new ThriveHead.views[this.itemView]({model:a});this.$el.find("#tho-table-items").append(b.render().el)},displayItems:function(){this.collection.each(this.addOne,this)},emptyList:function(){this.$el.find("#tho-table-items").empty()},showOrderDirIcon:function(a){var b,c;switch(this.pagination.order_dir){case"DESC":b="dashicons-arrow-up dashicons-sort",c="dashicons-arrow-down";break;case"ASC":c="dashicons-arrow-up",b="dashicons-arrow-down dashicons-sort";break;case"":}this.$el.find(".order_dir_icon").removeClass(b).addClass(c)},render:function(){return this.$el.html(this.template({})),this.$el.find(".tho-table-sortable").on("click",jQuery.proxy(this.changeOrder,this)),this.displayItems(),this.showOrderDirIcon(this.pagination.order_dir),this}}),ThriveHead.views.EngagementReportItem=ThriveHead.views.Base.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("reporting/engagement-report/item"),render:function(){return this.$el.html(this.template({model:this.model})),this}}),ThriveHead.views.EngagementReportList=ThriveHead.views.ReportingTableBase.extend({template:TVE_Dash.tpl("reporting/engagement-report/list"),itemView:"EngagementReportItem"}),ThriveHead.views.EngagementRateReportItem=ThriveHead.views.Base.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("reporting/engagement-rate-report/item"),render:function(){return this.$el.html(this.template({model:this.model})),this}}),ThriveHead.views.EngagementRateReportList=ThriveHead.views.ReportingTableBase.extend({template:TVE_Dash.tpl("reporting/engagement-rate-report/list"),itemView:"EngagementRateReportItem"}),ThriveHead.views.CumulativeEngagementReportItem=ThriveHead.views.Base.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("reporting/engagement-report/item"),render:function(){return this.$el.html(this.template({model:this.model})),this}}),ThriveHead.views.CumulativeEngagementReportList=ThriveHead.views.ReportingTableBase.extend({template:TVE_Dash.tpl("reporting/engagement-report/list"),itemView:"EngagementReportItem"})});var ThriveHead=ThriveHead||{};ThriveHead.objects=ThriveHead.objects||{},ThriveHead.notifications=ThriveHead.notifications||{},function(a){var b=Backbone.Router.extend({view:null,$el:a("#tho-dashboard-wrapper"),routes:{dashboard:"dashboard","createTest(/:step)":"createTest","test/:id":"viewTest",settings:"settings","reporting(/:chart/:id)":"reporting"},params:{},force_fetch:!1,force_fetch_views:["dashboard","test"],initialize:function(){this.breadcrumbs=new ThriveHead.views.Breadcrumbs({el:a(".tho-breadcrumbs")})},dashboard:function(){var a=[],b=this;if(TVE_Dash.showLoader(),"undefined"!=typeof ThriveHead.notifications.dashboard){for(var c in ThriveHead.notifications.dashboard)TVE_Dash.success(ThriveHead.notifications.dashboard[c].message,ThriveHead["const"].toast_timeout,ThriveHead.notifications.dashboard[c].type),"undefined"!=typeof ThriveHead.notifications.dashboard[c].params&&(a=ThriveHead.notifications.dashboard[c].params.ids);ThriveHead.notifications.dashboard=[]}this.breadcrumbs.render(ThriveHead.util.Breadcrumbs(ThriveHead.breadcrumbs,"dashboard")),this.view&&this.view.remove(),jQuery.ajax({headers:{"X-WP-Nonce":ThriveHead.nonce},cache:!1,url:ThriveHead.routes.tests,method:"get",dataType:"json"}).done(function(a){b.view.render(a)}),this.view=new ThriveHead.views.Dashboard({highlight_tests:a}),this.$el.html(this.view.$el)},createTest:function(a){a||(a="selectPosts"),this.breadcrumbs.render(ThriveHead.util.Breadcrumbs(ThriveHead.breadcrumbs,a));var b=!1;if(this.view&&this.view.remove(),("undefined"==typeof ThriveHead.objects.PostsCollection||!ThriveHead.objects.PostsCollection.length)&&"selectPosts"!=a)return void ThriveHead.router.navigate("#createTest/selectPosts",{trigger:!0});switch(TVE_Dash.showLoader(),a){case"addVariations":this.view=new ThriveHead.views.CreateTestStep2({collection:ThriveHead.objects.PostsCollection});break;case"setCriteria":ThriveHead.objects.Settings=new ThriveHead.models.Settings,ThriveHead.objects.Settings.fetch(),this.view=new ThriveHead.views.CreateTestStep3({model:ThriveHead.objects.Settings});break;case"selectPosts":default:ThriveHead.objects.PostsCollection||(ThriveHead.objects.PostsCollection=new ThriveHead.collections.TestPosts),ThriveHead.objects.Posts=new ThriveHead.collections.Posts,this.view=new ThriveHead.views.CreateTest({collection:ThriveHead.objects.Posts,forceRender:b})}this.$el.html(this.view.$el)},reporting:function(a,b){if("undefined"!=typeof b&&b>0){var c=this,d=ThriveHead.util.Breadcrumbs(ThriveHead.breadcrumbs,"postReports");jQuery.ajax({headers:{"X-WP-Nonce":ThriveHead.nonce},cache:!1,url:ThriveHead.routes.posts+"/"+b,method:"get",dataType:"json"}).done(function(a){d[d.length-1].title=a.title+" "+d[d.length-1].title,c.breadcrumbs.render(d)})}else this.breadcrumbs.render(ThriveHead.util.Breadcrumbs(ThriveHead.breadcrumbs,"reporting"));this.view&&this.view.remove(),""!=a&&null!=a||(a=ThriveHead["const"].log_type),(""==b||isNaN(b)||null==b)&&(b=ThriveHead["const"].log_source),this.view=new ThriveHead.views.Reporting,this.$el.html(this.view.render(a,b).$el),TVE_Dash.materialize(this.$el)},viewTest:function(a){if(this.breadcrumbs.render(ThriveHead.util.Breadcrumbs(ThriveHead.breadcrumbs,"test",a)),isNaN(a)||0>=a)return void ThriveHead.router.navigate("#dashboard",{trigger:!0});this.view&&this.view.remove();var b=this;jQuery.ajax({headers:{"X-WP-Nonce":ThriveHead.nonce},url:ThriveHead.routes.tests+"/"+a,method:"get",cache:!1,dataType:"json",data:{interval:"day"}}).done(function(a){b.view.render(a)}),this.view=new ThriveHead.views.Test,this.$el.html(this.view.$el)}});a(function(){ThriveHead.router=new b,Backbone.history.start({hashchange:!0}),Backbone.history.fragment||ThriveHead.router.navigate("#dashboard",{trigger:!0})})}(jQuery);var ThriveHead=ThriveHead||{};!function(){ThriveHead.LineChart=Backbone.Model.extend({defaults:function(){return{id:"",title:"",renderTo:"",type:"line",suffix:"",data:[]}},initialize:function(){var a=this.get("title"),b=this.get("type"),c=this.get("renderTo");this.chart=this.dochart(a,b,c)},empty:function(){for(;this.chart.series.length>0;)this.chart.series[0].remove(!0)},redraw:function(){var a=this.get("title"),b=this.get("data"),c=this.get("x_axis"),d=this.get("y_axis"),e=[],f=this.get("x_axis").length;for(var g in b){e.push(b[g].id);var h=this.chart.get(b[g].id);null===h?this.chart.addSeries(b[g],!1,!1):h.setData(b[g].data)}for(g=0;g<this.chart.series.length;g++)e.indexOf(this.chart.series[g].options.id)<0&&(this.chart.series[g].remove(!1),g--);this.chart.get("time_interval").setCategories(c),this.chart.xAxis[0].update({tickInterval:f>13?Math.ceil(f/13):1}),this.chart.setTitle({text:a}),this.chart.yAxis[0].axisTitle&&this.chart.yAxis[0].axisTitle.attr({text:d}),this.chart.redraw(),this.chart.hideLoading()},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},dochart:function(a,b,c){var d=this;return new Highcharts.Chart({chart:{type:b,renderTo:c,style:{fontFamily:"Open Sans,sans-serif"}},colors:ThriveHead["const"].CHART_COLORS,yAxis:{allowDecimals:!1,title:{text:"Engagements"},min:0},xAxis:{id:"time_interval"},credits:{enabled:!1},title:{text:a},tooltip:{shared:!1,useHTML:!0,
formatter:function(){return"scatter"==this.series.type?!1:this.x+"<br/>"+this.series.name+": <b>"+this.y+"</b>"+d.get("suffix")}},plotOptions:{series:{dataLabels:{shape:"callout",backgroundColor:"rgba(0, 0, 0, 0.75)",style:{color:"#FFFFFF",textShadow:"none"}},events:{legendItemClick:function(){"scatter"==this.type&&(this.visible?jQuery(".highcharts-data-labels").hide():jQuery(".highcharts-data-labels").show())}}}}})}}),ThriveHead.PieChart=Backbone.Model.extend({defaults:function(){return{id:"",title:"",data:[]}},initialize:function(){var a=this.get("title");this.get("data");this.chart=this.dopie(a)},redraw:function(){var a=this.get("title"),b=this.get("data");this.get("x_axis");this.chart.series[0].setData(b),this.chart.setTitle(a),this.chart.redraw(),this.chart.hideLoading()},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},dopie:function(a){return new Highcharts.Chart({chart:{renderTo:"tho-report-chart",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:ThriveHead["const"].CHART_COLORS,credits:{enabled:!1},title:{text:a},plotOptions:{pie:{allowPointSelect:!1,cursor:"default",showInLegend:!0,dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},tooltip:{formatter:function(){return this.key+": "+parseInt(this.y)}},series:[{type:"pie",name:a}]})}}),ThriveHead.BarChart=Backbone.Model.extend({defaults:function(){return{id:"",data:[],colors:[]}},initialize:function(){var a,b,c=this.get("renderTo"),d=this.get("data"),e=100,f=100,g=0;d=this.getCandleStickData(d),a=d.colors,b=d.items;for(var h in b)b[h][0]<f&&(f=b[h][0]),b[h][b[h].length-1]>g&&(g=b[h][b[h].length-1]),(b[h][b[h].length-1]-b[h][0])/2<e&&(e=(b[h][b[h].length-1]-b[h][0])/2);f=f>e/3?f-e/3:0,g+=e/3;for(h in b){for(var i,j=[],k=1;k<b[h].length;k++)j.push({data:[{low:b[h][k-1],high:b[h][k]}]});i=(b[h][0]+b[h][b[h].length-1])/2,this.doChart(j,i,f,g,a[h],c+"-"+h)}},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},doChart:function(a,b,c,d,e,f){return new Highcharts.Chart({chart:{renderTo:f,type:"columnrange",inverted:!0,height:50,spacing:[10,10,10,10]},colors:e,plotOptions:{columnrange:{grouping:!1}},title:{text:""},xAxis:{title:{text:""},labels:{enabled:!1},lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},yAxis:{title:{text:""},labels:{enabled:!1},plotLines:[{color:"#000000",value:b,width:1,zIndex:100}],min:c,max:d,lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},legend:{enabled:!1},credits:{enabled:!1},tooltip:{enabled:!1},series:a})},getCandleStickData:function(a){var b=[];_.each(a,function(a){var c=parseInt(a.engagement_rate),d=parseInt(a.engagements);if(isNaN(c)||isNaN(d)||0===d)b.push([0,0]);else{var e=Math.round(100*Math.sqrt(c*(100-c)/d))/100;b.push([c-e,c+e])}});var c=ThriveHead["const"].CHART_RED,d=ThriveHead["const"].CHART_GREY,e=ThriveHead["const"].CHART_GREEN,f=b[0],g=[],h=[];return _.each(b,function(a){var b=[],i=[];a[0]<f[0]?(i.push(c),b.push(a[0]),a[1]<f[0]?b.push(a[1]):a[1]<f[1]?(i.push(d),b.push(f[0]),b.push(a[1])):f[1]<a[1]&&(i.push(d),i.push(e),b.push(f[0]),b.push(f[1]),b.push(a[1]))):a[0]<f[1]?(i.push(d),b.push(a[0]),a[1]<=f[1]?b.push(a[1]):f[1]<a[1]&&(i.push(e),b.push(f[1]),b.push(a[1]))):f[1]<a[1]&&(i.push(e),b.push(a[0]),b.push(a[1])),g.push(b),h.push(i)}),{items:g,colors:h}}})}();